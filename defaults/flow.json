[
    {
      "id": "ecf7cb7a.f7b568",
      "type": "tab",
      "label": "管理コマンド",
      "disabled": false,
      "info": ""
    },
    {
      "id": "b85ebbb8.71d748",
      "type": "tab",
      "label": "起動処理",
      "disabled": false,
      "info": ""
    },
    {
      "id": "c08d8bce.292a98",
      "type": "tab",
      "label": "ユーザ管理",
      "disabled": false,
      "info": ""
    },
    {
      "id": "4caa9583.52322c",
      "type": "tab",
      "label": "ログイン",
      "disabled": false,
      "info": ""
    },
    {
      "id": "ab8060fa.504b3",
      "type": "tab",
      "label": "初期FAQデータImport",
      "disabled": false,
      "info": ""
    },
    {
      "id": "f88d33bb.e0bc5",
      "type": "tab",
      "label": "FAQデータImport/Export",
      "disabled": false,
      "info": ""
    },
    {
      "id": "e4d10f14.d558b",
      "type": "tab",
      "label": "FAQデータ編集・登録",
      "disabled": false,
      "info": ""
    },
    {
      "id": "f06e3ca3.ed0a6",
      "type": "tab",
      "label": "FBデータImport/Export",
      "disabled": false,
      "info": ""
    },
    {
      "id": "8baa0034.d9587",
      "type": "tab",
      "label": "FBデータ編集",
      "disabled": false,
      "info": ""
    },
    {
      "id": "3c319ef6.6e76e2",
      "type": "tab",
      "label": "FBデータ登録",
      "disabled": false,
      "info": ""
    },
    {
      "id": "b6daf329.b5ff58",
      "type": "tab",
      "label": "トレーニングステータス",
      "disabled": false,
      "info": ""
    },
    {
      "id": "f290c459.175828",
      "type": "tab",
      "label": "FAQ検索",
      "disabled": false,
      "info": ""
    },
    {
      "id": "a2571d82.682d6",
      "type": "tab",
      "label": "FAQフィードバック",
      "disabled": false,
      "info": ""
    },
    {
      "id": "c46ab181.bede",
      "type": "tab",
      "label": "分析",
      "disabled": false,
      "info": ""
    },
    {
      "id": "664cefa1.09a55",
      "type": "subflow",
      "name": "SemaphoreON",
      "info": "",
      "in": [
        {
          "x": 360,
          "y": 320,
          "wires": [
            {
              "id": "bd215719.d5e848"
            }
          ]
        }
      ],
      "out": []
    },
    {
      "id": "84c49712.df4df8",
      "type": "subflow",
      "name": "SemaphoreOFF",
      "info": "",
      "in": [
        {
          "x": 420,
          "y": 240,
          "wires": [
            {
              "id": "8a6e373d.4ad4e8"
            }
          ]
        }
      ],
      "out": []
    },
    {
      "id": "60894a16.3cd484",
      "type": "subflow",
      "name": "APICallCount",
      "info": "",
      "in": [
        {
          "x": 240,
          "y": 240,
          "wires": [
            {
              "id": "c7cbf8a3.466cd8"
            }
          ]
        }
      ],
      "out": []
    },
    {
      "id": "c505c6cd.aad308",
      "type": "subflow",
      "name": "Logger",
      "info": "",
      "in": [
        {
          "x": 40,
          "y": 180,
          "wires": [
            {
              "id": "3373f1ec.7eb82e"
            }
          ]
        }
      ],
      "out": []
    },
    {
      "id": "71915116.962c1",
      "type": "inject",
      "z": "b85ebbb8.71d748",
      "name": "Node-RED起動時に実行",
      "topic": "",
      "payload": "",
      "payloadType": "date",
      "repeat": "",
      "crontab": "",
      "once": true,
      "x": 150,
      "y": 60,
      "wires": [
        [
          "afa4d0a4.80a8a"
        ]
      ]
    },
    {
      "id": "bd3385e9.ce4f58",
      "type": "template",
      "z": "b85ebbb8.71d748",
      "name": "CollectionInfo",
      "field": "CollectionInfo",
      "fieldType": "msg",
      "format": "handlebars",
      "syntax": "mustache",
      "template": "{\n    \"EnvironmentId\": \"{{{environment_id}}}\"\n    \n    \n    ,\"CollectionId\": null\n    \n    ,\"ConfigurationId\": null\n\n}\n",
      "output": "json",
      "x": 420,
      "y": 402,
      "wires": [
        [
          "1ce14694.42b4b9"
        ]
      ]
    },
    {
      "id": "afa4d0a4.80a8a",
      "type": "template",
      "z": "b85ebbb8.71d748",
      "name": "CredentialInfo",
      "field": "CredentialInfo",
      "fieldType": "msg",
      "format": "handlebars",
      "syntax": "mustache",
      "template": "{\n    \"url\": \"https://gateway.watsonplatform.net/discovery/api\"\n\n    \n    ,\"username\": \"input_your_username\"\n    \n    ,\"password\": \"input_your_password\"\n    \n}\n",
      "output": "json",
      "x": 420,
      "y": 60,
      "wires": [
        [
          "d69d258e.f67bf8"
        ]
      ]
    },
    {
      "id": "65657998.84d078",
      "type": "template",
      "z": "b85ebbb8.71d748",
      "name": "Const",
      "field": "Const",
      "fieldType": "msg",
      "format": "handlebars",
      "syntax": "mustache",
      "template": "{\n    \"API_KEY\": \"input_your_apikey\"\n\n    ,\"EXPORT_FILE_FAQ\": \"faq_doc\"\n    ,\"EXPORT_FILE_FB\": \"fb_doc\"\n    \n    ,\"SEMAPHORE_PATH\": \"/home/vcap/tmp/faqdoc.lock\"\n    ,\"ADD_DOC_MULTIPLICITY\": 10\n    ,\"DEL_DOC_MULTIPLICITY\": 300\n    ,\"ADD_QUERY_MULTIPLICITY\": 200\n    }\n",
      "output": "json",
      "x": 390,
      "y": 462,
      "wires": [
        [
          "1c8b1227.c447ae"
        ]
      ]
    },
    {
      "id": "1c8b1227.c447ae",
      "type": "template",
      "z": "b85ebbb8.71d748",
      "name": "Apis",
      "field": "Apis",
      "fieldType": "msg",
      "format": "handlebars",
      "syntax": "mustache",
      "template": "{\n    \"Discovery\": {\n        \"CREATE_ENV\": \"https://gateway.watsonplatform.net/discovery/api/v1/environments?version=2017-11-07\"\n        ,\"DEL_ENV\": \"https://gateway.watsonplatform.net/discovery/api/v1/environments/{ENV_ID}?version=2017-11-07\"\n        \n        ,\"LIST_CONFIG\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/configurations?version=2017-11-07\"\n    \n        ,\"ADD_DOC\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections/{{{CollectionInfo.CollectionId}}}/documents/{DOC_ID}?version=2017-11-07\"\n        \n        ,\"LIST_DOC_DETAIL\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections/{{{CollectionInfo.CollectionId}}}/documents/{DOC_ID}?version=2017-11-07\"\n\n        ,\"DEL_DOC\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections/{{{CollectionInfo.CollectionId}}}/documents/{DOC_ID}?version=2017-11-07\"\n        \n        ,\"LIST_ENV\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}?version=2017-11-07\"\n    \n        ,\"LIST_COLLECTION\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections?version=2017-11-07\"\n\n        ,\"LIST_COLLECTION_DETAIL\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections/{{{CollectionInfo.CollectionId}}}?version=2017-11-07\"\n        \n        ,\"DEL_COLLECTION\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections/{{{CollectionInfo.CollectionId}}}?version=2017-11-07\"\n        ,\"ADD_COLLECTION\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections?version=2017-11-07\"\n\n    \n        ,\"ADD_QUERY\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections/{{{CollectionInfo.CollectionId}}}/training_data?version=2017-11-07\"\n\n        ,\"ADD_EXAMPLE\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections/{{{CollectionInfo.CollectionId}}}/training_data/{QUERY_ID}/examples?version=2017-11-07\"\n\n        ,\"DEL_ALL_QUERY\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections/{{{CollectionInfo.CollectionId}}}/training_data?version=2017-11-07\"\n\n        ,\"LIST_ALL_QUERY\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections/{{{CollectionInfo.CollectionId}}}/training_data?version=2017-11-07\"\n\n        ,\"LIST_QUERY_NOTICES\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections/{{{CollectionInfo.CollectionId}}}/notices?version=2017-11-07\"\n\n        ,\"LIST_QUERY_DETAIL\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections/{{{CollectionInfo.CollectionId}}}/training_data/{QUERY_ID}?version=2017-11-07\"\n    \n        ,\"SEARCH\": \"{{{CredentialInfo.url}}}/v1/environments/{{{CollectionInfo.EnvironmentId}}}/collections/{{{CollectionInfo.CollectionId}}}/query?version=2017-11-07&natural_language_query=\"\n    }\n    ,\"Cloudant\": {\n        \"BULK_DOC_FAQ\": \"{{{global.APIDB_url}}}/qa_doc/_bulk_docs\"\n        \n        ,\"VIEW_FAQ_MAXID\": \"{{{global.APIDB_url}}}/qa_doc/_design/qa_docDesignDocV1/_view/qa_docStats?reduce=true&group=true\"\n\n        ,\"BULK_DOC_FB\": \"{{{global.APIDB_url}}}/fb_doc/_bulk_docs\"\n\n        ,\"VIEW_FAQ_FLAGSEARCH\": \"{{{global.APIDB_url}}}/qa_doc/_design/qa_docDesignDocV1/_view/qa_docFlagSearch?reduce=false&include_docs=true&conflicts=true\"\n        ,\"ALL_DOC_FAQ\": \"{{{global.APIDB_url}}}/qa_doc/_all_docs?include_docs=true&conflicts=true\"\n        ,\"VIEW_FAQ_ALLSEARCH\": \"{{{global.APIDB_url}}}/qa_doc/_design/qa_docDesignDocV1/_view/qa_docAllSearch?reduce=false&include_docs=true&conflicts=true\"\n\n        ,\"VIEW_FB_FLAGSEARCH\": \"{{{global.APIDB_url}}}/fb_doc/_design/fb_docDesignDocV1/_view/fb_docFlagSearch?reduce=false&include_docs=true&conflicts=true\"\n        ,\"ALL_DOC_FB\": \"{{{global.APIDB_url}}}/fb_doc/_all_docs?include_docs=true&conflicts=true\"\n        \n        ,\"VIEW_FB_RANKERSEARCH\": \"{{{global.APIDB_url}}}/fb_doc/_design/fb_docDesignDocV1/_view/fb_docRankerSearch?reduce=false&include_docs=true&conflicts=true\"\n        ,\"VIEW_FB_ISANSWER\": \"{{{global.APIDB_url}}}/fb_doc/_design/fb_docDesignDocV1/_view/fb_docIsAnswer?reduce=false&include_docs=true&conflicts=true\"\n        ,\"VIEW_FB_NOANSWER\": \"{{{global.APIDB_url}}}/fb_doc/_design/fb_docDesignDocV1/_view/fb_docNoAnswer?reduce=false&include_docs=true&conflicts=true\"\n        ,\"VIEW_FB_ALLSEARCH\": \"{{{global.APIDB_url}}}/fb_doc/_design/fb_docDesignDocV1/_view/fb_docAllSearch?reduce=false&include_docs=true&conflicts=true\"\n        \n        ,\"DOC_FB\": \"{{{global.APIDB_url}}}/fb_doc\"\n        \n        ,\"DOC_FAQ\": \"{{{global.APIDB_url}}}/qa_doc\"\n        \n        ,\"DOC_API_COUNT\": \"{{{global.CNTDB_url}}}/api_counter\"\n        ,\"VIEW_API_COUNT\": \"{{{global.CNTDB_url}}}/api_counter/_design/api_counterDesignDocV1/_view/count\"\n        \n        ,\"INDEX_USER_SEARCH\": \"{{{global.APIDB_url}}}/login_user/_design/login_userDesignDocV1/_search/login_userSearch?\"\n        ,\"KEY_USER_SEARCH\": \"{{{global.APIDB_url}}}/login_user\"\n        ,\"INDEX_FAQ_SEARCH\": \"{{{global.APIDB_url}}}/qa_doc/_design/qa_docDesignDocV1/_search/qa_docSearch?\"\n        ,\"KEY_FAQ_SEARCH\": \"{{{global.APIDB_url}}}/qa_doc\"\n        ,\"INDEX_FB_SEARCH\": \"{{{global.APIDB_url}}}/fb_doc/_design/fb_docDesignDocV1/_search/fb_docSearch?\"\n        ,\"KEY_FB_SEARCH\": \"{{{global.APIDB_url}}}/fb_doc\"\n    }\n}\n",
      "output": "json",
      "x": 390,
      "y": 522,
      "wires": [
        [
          "4905ba02.6d5ce4",
          "5bf251fd.b9b48"
        ]
      ]
    },
    {
      "id": "92521d9d.06035",
      "type": "change",
      "z": "b85ebbb8.71d748",
      "name": "global 格納",
      "rules": [
        {
          "t": "set",
          "p": "CollectionInfo",
          "pt": "global",
          "to": "CollectionInfo",
          "tot": "msg"
        },
        {
          "t": "set",
          "p": "CredentialInfo",
          "pt": "global",
          "to": "CredentialInfo",
          "tot": "msg"
        },
        {
          "t": "set",
          "p": "Const",
          "pt": "global",
          "to": "Const",
          "tot": "msg"
        },
        {
          "t": "set",
          "p": "Apis",
          "pt": "global",
          "to": "Apis",
          "tot": "msg"
        },
        {
          "t": "set",
          "p": "Util",
          "pt": "global",
          "to": "Util",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 410,
      "y": 642,
      "wires": [
        [
          "ac4d3eec.ba2cf"
        ]
      ]
    },
    {
      "id": "97a7010b.54564",
      "type": "debug",
      "z": "b85ebbb8.71d748",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "payload",
      "x": 610,
      "y": 702,
      "wires": []
    },
    {
      "id": "ac4d3eec.ba2cf",
      "type": "function",
      "z": "b85ebbb8.71d748",
      "name": "global 表示用",
      "func": "\nmsg.payload = context.global;//.Util.formatTimestamp(context.global.Util.currentTimestampMili());\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 410,
      "y": 702,
      "wires": [
        [
          "97a7010b.54564"
        ]
      ]
    },
    {
      "id": "4109232e.eb34fc",
      "type": "http in",
      "z": "c08d8bce.292a98",
      "name": "登録要求",
      "url": "/api/v1/user",
      "method": "post",
      "swaggerDoc": "",
      "x": 100,
      "y": 100,
      "wires": [
        [
          "2c03b6bd.70a81a",
          "74719887.afd238"
        ]
      ]
    },
    {
      "id": "e5bdc12c.2a62e",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "共通パラメータチェック",
      "func": "/*\nvar errorFlag = true;\n\nif (errorFlag) {\n    //CHECK APIKEY\n    errorFlag = context.global.commonFunction.checkAPIKey();\n}\n\nif (errorFlag) {\n    //CHECK USER\n    errorFlag = context.global.commonFunction.checkUser();\n}\n*/\n\ncontext.global.Util.checkAPIKeyAndUser(msg);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 630,
      "y": 580,
      "wires": [
        [
          "1ebc91e9.722c1e"
        ]
      ]
    },
    {
      "id": "74e66c7b.592244",
      "type": "http in",
      "z": "c08d8bce.292a98",
      "name": "取得要求",
      "url": "/api/v1/user",
      "method": "get",
      "upload": false,
      "swaggerDoc": "",
      "x": 80,
      "y": 340,
      "wires": [
        [
          "2c03b6bd.70a81a",
          "b8bd3c95.165a2"
        ]
      ]
    },
    {
      "id": "433e3078.221cb",
      "type": "http in",
      "z": "c08d8bce.292a98",
      "name": "変更要求",
      "url": "/api/v1/user",
      "method": "put",
      "swaggerDoc": "",
      "x": 80,
      "y": 660,
      "wires": [
        [
          "2c03b6bd.70a81a",
          "54edd9db.4a9038"
        ]
      ]
    },
    {
      "id": "922a4697.0605d8",
      "type": "http in",
      "z": "c08d8bce.292a98",
      "name": "削除要求",
      "url": "/api/v1/user",
      "method": "delete",
      "swaggerDoc": "",
      "x": 80,
      "y": 900,
      "wires": [
        [
          "2c03b6bd.70a81a",
          "e292af68.41fab"
        ]
      ]
    },
    {
      "id": "1ebc91e9.722c1e",
      "type": "switch",
      "z": "c08d8bce.292a98",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "ERROR",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "GET",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "PUT",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "DELETE",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 5,
      "x": 860,
      "y": 580,
      "wires": [
        [
          "6ce8206f.a131f"
        ],
        [
          "76ff8850.e830c8"
        ],
        [
          "3615a6df.13314a"
        ],
        [
          "6ee41d61.f0b2f4"
        ],
        [
          "98e94d4d.1d5e7"
        ]
      ]
    },
    {
      "id": "6ce8206f.a131f",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "共通パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: msg.common.errorMessage };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1210,
      "y": 60,
      "wires": [
        [
          "e7d152c1.d3baa",
          "979f4d09.e5adf"
        ]
      ]
    },
    {
      "id": "76ff8850.e830c8",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "登録処理",
      "func": "if (msg.payload.id && msg.payload.password && msg.payload.group && msg.payload.user) {\n\n    msg.method = \"POST\";\n    msg.url = context.global.APIDB_url + \"/login_user\";\n    \n    var currentTimestampMili = context.global.Util.currentTimestampMili();\n    \n    // password encryption\n    var encryptedStr = context.global.Util.encrypt(msg.payload.password);\n    \n    msg.payload = {\n        // _id: currentTimestampMili+\"\",\n        // id: currentTimestampMili+\"\",\n        // _id: msg.payload.userid,\n        // userid: msg.payload.userid,\n        _id: msg.payload.id,\n        userid: msg.payload.id,\n        //password: msg.payload.password,\n        password: encryptedStr,\n        group: msg.payload.group,\n        create_date : context.global.Util.formatTimestamp(currentTimestampMili),\n        user: msg.payload.user,\n        flag : 1\n    };\n    \n} else {\n    msg.payload.error = true;\n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1140,
      "y": 200,
      "wires": [
        [
          "8138e88.c03f118"
        ]
      ]
    },
    {
      "id": "3615a6df.13314a",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "取得処理",
      "func": "if (msg.payload.id) {\n    msg.condition=\"key\";\n    msg.payload = {\n        \"_id\": msg.payload.id\n    };\n\n} else if (msg.payload.userid) {\n    \n    var query = \"\";\n    if (msg.payload.userid) {\n        query = \"userid: \"+msg.payload.userid;\n    }\n    msg.payload = {\n        \"query\": query,\n        \"limit\": 100 //リミットはどうする？\n    };\n\n} else {\n    msg.condition=\"all\";\n    msg.limit=msg.payload.limit;\n    msg.skip=msg.payload.skip;\n    \n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1140,
      "y": 460,
      "wires": [
        [
          "a0cba1ef.920b3"
        ]
      ]
    },
    {
      "id": "6ee41d61.f0b2f4",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "変更処理",
      "func": "if (msg.payload.id) {\n    // msg.url = \"https://d0c89290-0901-4a76-8a8c-4bb9c92f6fd2-bluemix:d93deef341315946577a459afa5f09e9f2c0e132f8a6ad1f5ccc3a2c2dc74752@d0c89290-0901-4a76-8a8c-4bb9c92f6fd2-bluemix.cloudant.com/login_user\";\n    msg.url = context.global.APIDB_url + \"/login_user\";\n    // msg.url += '/' + msg.payload.userid;\n    msg.url += '/' + msg.payload.id;\n    msg.tmp = msg.payload;\n} else {\n    msg.payload.error = true;\n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1120,
      "y": 680,
      "wires": [
        [
          "7f709dae.69fd44"
        ]
      ]
    },
    {
      "id": "98e94d4d.1d5e7",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "削除処理",
      "func": "if (msg.payload.id) {\n    // msg.url = \"https://d0c89290-0901-4a76-8a8c-4bb9c92f6fd2-bluemix:d93deef341315946577a459afa5f09e9f2c0e132f8a6ad1f5ccc3a2c2dc74752@d0c89290-0901-4a76-8a8c-4bb9c92f6fd2-bluemix.cloudant.com/login_user\";\n    msg.url = context.global.APIDB_url + \"/login_user\";\n    // msg.url += '/' + msg.payload.userid;\n    msg.url += '/' + msg.payload.id;\n    msg.tmp = msg.payload;\n} else {\n    msg.payload.error = true;\n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1120,
      "y": 940,
      "wires": [
        [
          "5c961306.f4e04c"
        ]
      ]
    },
    {
      "id": "8138e88.c03f118",
      "type": "switch",
      "z": "c08d8bce.292a98",
      "name": "必須チェック",
      "property": "payload.error",
      "propertyType": "msg",
      "rules": [
        {
          "t": "true"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1320,
      "y": 200,
      "wires": [
        [
          "4bb41970.b3e718"
        ],
        [
          "3184a9e0.308e36"
        ]
      ]
    },
    {
      "id": "a0cba1ef.920b3",
      "type": "switch",
      "z": "c08d8bce.292a98",
      "name": "取得分岐",
      "property": "condition",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "eq",
          "v": "all",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "key",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 3,
      "x": 1300,
      "y": 460,
      "wires": [
        [
          "ff87f299.1d5e6"
        ],
        [
          "dece6929.3e9b28"
        ],
        [
          "20aa1deb.593652"
        ]
      ]
    },
    {
      "id": "7f709dae.69fd44",
      "type": "switch",
      "z": "c08d8bce.292a98",
      "name": "必須チェック",
      "property": "payload.error",
      "propertyType": "msg",
      "rules": [
        {
          "t": "true"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1320,
      "y": 680,
      "wires": [
        [
          "c53538c3.b95b78"
        ],
        [
          "6929a91b.a35f08"
        ]
      ]
    },
    {
      "id": "5c961306.f4e04c",
      "type": "switch",
      "z": "c08d8bce.292a98",
      "name": "必須チェック",
      "property": "payload.error",
      "propertyType": "msg",
      "rules": [
        {
          "t": "true"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1300,
      "y": 940,
      "wires": [
        [
          "98679896.c52788",
          "ad534f2b.eae6c"
        ],
        [
          "64d352c0.2bb70c"
        ]
      ]
    },
    {
      "id": "6a0feac.ace5714",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "作成応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1880,
      "y": 320,
      "wires": [
        [
          "13af56ca.371159",
          "5ebe9ef8.0eeed"
        ]
      ]
    },
    {
      "id": "476a913f.a001f",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "作成エラー応答",
      "func": "msg.payload = {\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1900,
      "y": 280,
      "wires": [
        [
          "1020316f.c547af"
        ]
      ]
    },
    {
      "id": "abf24ce0.42b35",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "変更エラー応答",
      "func": "msg.payload = {\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2280,
      "y": 680,
      "wires": [
        [
          "38863c06.a06834"
        ]
      ]
    },
    {
      "id": "5dae1e0b.f74bb",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "変更応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2520,
      "y": 760,
      "wires": [
        [
          "1586af7c.be6ad1",
          "86a0e741.0c94b8"
        ]
      ]
    },
    {
      "id": "67a3fc92.588a54",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "削除応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2380,
      "y": 1040,
      "wires": [
        [
          "f1ffa575.5d1a78",
          "63dbc896.755178"
        ]
      ]
    },
    {
      "id": "8453d8fe.9c5838",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "削除エラー応答",
      "func": "msg.payload = {\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2160,
      "y": 960,
      "wires": [
        [
          "49d80dc8.39a4d4"
        ]
      ]
    },
    {
      "id": "aa072119.0dafa",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "取得応答",
      "func": "// if (!msg.payload) {\n//     msg.payload = {};\n// }\n\nmsg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\n\nif (msg.total_rows) {\n    msg.payload.total_rows = msg.total_rows;\n}\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2480,
      "y": 580,
      "wires": [
        [
          "86c20c75.460d8",
          "f3ec60a2.5afde"
        ]
      ]
    },
    {
      "id": "4bb41970.b3e718",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "エラーメッセージ",
      "func": "msg.payload = \"invalid parameter.\";\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1530,
      "y": 200,
      "wires": [
        [
          "476a913f.a001f",
          "cc1f73ac.0274e"
        ]
      ]
    },
    {
      "id": "3184a9e0.308e36",
      "type": "http request",
      "z": "c08d8bce.292a98",
      "name": "作成要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1500,
      "y": 280,
      "wires": [
        [
          "f5acdd9b.9cdfc"
        ]
      ]
    },
    {
      "id": "dece6929.3e9b28",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "全件取得処理",
      "func": "msg.method = \"GET\";\n\nvar addParam = \"\";\nif (msg.limit) {\n    addParam += \"&limit=\"+msg.limit;\n}\nif (msg.skip) {\n    addParam += \"&skip=\"+msg.skip;\n}\n\nmsg.url = context.global.APIDB_url + \"/login_user/_design/login_userDesignDocV1/_view/login_userAllSearch?reduce=false&include_docs=true&conflicts=true\"+addParam;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1540,
      "y": 520,
      "wires": [
        [
          "8fb2bf30.58397"
        ]
      ]
    },
    {
      "id": "c53538c3.b95b78",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "エラーメッセージ",
      "func": "msg.payload = \"invalid parameter.\";\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1550,
      "y": 680,
      "wires": [
        [
          "abf24ce0.42b35",
          "c32f255e.c239b8"
        ]
      ]
    },
    {
      "id": "6929a91b.a35f08",
      "type": "http request",
      "z": "c08d8bce.292a98",
      "name": "KEY取得要求",
      "method": "GET",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1540,
      "y": 760,
      "wires": [
        [
          "efc0694b.970758"
        ]
      ]
    },
    {
      "id": "98679896.c52788",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "エラーメッセージ",
      "func": "msg.payload = \"invalid parameter.\";\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1550,
      "y": 980,
      "wires": [
        [
          "8453d8fe.9c5838"
        ]
      ]
    },
    {
      "id": "64d352c0.2bb70c",
      "type": "http request",
      "z": "c08d8bce.292a98",
      "name": "KEY取得要求",
      "method": "GET",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1540,
      "y": 1040,
      "wires": [
        [
          "4ef096a9.1334f8"
        ]
      ]
    },
    {
      "id": "f5acdd9b.9cdfc",
      "type": "switch",
      "z": "c08d8bce.292a98",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1650,
      "y": 280,
      "wires": [
        [
          "6a0feac.ace5714"
        ],
        [
          "476a913f.a001f",
          "28113e21.342c92"
        ]
      ]
    },
    {
      "id": "efc0694b.970758",
      "type": "switch",
      "z": "c08d8bce.292a98",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "200",
          "vt": "str"
        },
        {
          "t": "neq",
          "v": "200",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1730,
      "y": 760,
      "wires": [
        [
          "5dc61b95.7e2934"
        ],
        [
          "abf24ce0.42b35",
          "44a7dae8.63d8b4"
        ]
      ]
    },
    {
      "id": "a8fbc981.ef9cd8",
      "type": "switch",
      "z": "c08d8bce.292a98",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2263.9444885253906,
      "y": 763.0555973052979,
      "wires": [
        [
          "5dae1e0b.f74bb"
        ],
        [
          "abf24ce0.42b35",
          "44a7dae8.63d8b4"
        ]
      ]
    },
    {
      "id": "32d24593.17c44a",
      "type": "switch",
      "z": "c08d8bce.292a98",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2186.0913619995117,
      "y": 1035.8968315124512,
      "wires": [
        [
          "67a3fc92.588a54"
        ],
        [
          "8453d8fe.9c5838",
          "e69d71e6.42f57"
        ]
      ]
    },
    {
      "id": "4ef096a9.1334f8",
      "type": "switch",
      "z": "c08d8bce.292a98",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "200",
          "vt": "str"
        },
        {
          "t": "neq",
          "v": "200",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1729.119068145752,
      "y": 1048.674602508545,
      "wires": [
        [
          "246a25d9.7cb8ea"
        ],
        [
          "8453d8fe.9c5838",
          "e69d71e6.42f57"
        ]
      ]
    },
    {
      "id": "f71e2aa2.aed688",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "フォーマット変更",
      "func": "var result = [];\n\nfor (var i=0; i < msg.payload.rows.length; i++) {\n// for (var i=0; i < msg.payload.total_rows; i++) {\n    result[i] = msg.payload.rows[i].value;\n}\n\nmsg.total_rows = msg.payload.total_rows;\nmsg.payload = result;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2030,
      "y": 520,
      "wires": [
        [
          "aa072119.0dafa"
        ]
      ]
    },
    {
      "id": "2f3ca20b.248f5e",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "set total_rows",
      "func": "if (msg.payload) {\n    msg.total_rows = msg.payload.length;\n} else {\n    msg.payload = [];\n}\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2180,
      "y": 460,
      "wires": [
        [
          "aa072119.0dafa"
        ]
      ]
    },
    {
      "id": "8fb2bf30.58397",
      "type": "http request",
      "z": "c08d8bce.292a98",
      "name": "全件取得要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1800,
      "y": 520,
      "wires": [
        [
          "f71e2aa2.aed688"
        ]
      ]
    },
    {
      "id": "5dc61b95.7e2934",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "変更処理2",
      "func": "// msg.url = \"https://d0c89290-0901-4a76-8a8c-4bb9c92f6fd2-bluemix:d93deef341315946577a459afa5f09e9f2c0e132f8a6ad1f5ccc3a2c2dc74752@d0c89290-0901-4a76-8a8c-4bb9c92f6fd2-bluemix.cloudant.com/login_user\";\nmsg.url = context.global.APIDB_url + \"/login_user\";\nmsg.url += '/' + msg.payload._id;\n\nmsg.headers = {\n    'Content-Type': 'application/json'\n};\n\nmsg.method = \"PUT\";\n\nvar currentTimestampMili = context.global.Util.currentTimestampMili();\n\n// password encryption\nvar encryptedStr = null;\n// if (msg.tmp.password != \"\") {\nif (msg.tmp.password) {\n    encryptedStr = context.global.Util.encrypt(msg.tmp.password);\n} else {\n    encryptedStr = msg.payload.password;\n}\n\nmsg.payload = {\n    _id : msg.payload._id,\n    _rev : msg.payload._rev,\n    userid: msg.payload._id,\n    password: encryptedStr,\n    group: msg.tmp.group,\n    create_date : msg.payload.create_date,\n    modify_date : context.global.Util.formatTimestamp(currentTimestampMili),\n    user : msg.tmp.user,\n    flag : msg.payload.flag\n};\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1950,
      "y": 780,
      "wires": [
        [
          "4ed4700e.56b3d"
        ]
      ]
    },
    {
      "id": "4ed4700e.56b3d",
      "type": "http request",
      "z": "c08d8bce.292a98",
      "name": "変更要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 2112.5000038146973,
      "y": 767.5000610351562,
      "wires": [
        [
          "a8fbc981.ef9cd8"
        ]
      ]
    },
    {
      "id": "e5736c7b.4678a",
      "type": "http request",
      "z": "c08d8bce.292a98",
      "name": "削除要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 2031.9244918823242,
      "y": 1041.7857465744019,
      "wires": [
        [
          "32d24593.17c44a"
        ]
      ]
    },
    {
      "id": "246a25d9.7cb8ea",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "削除処理",
      "func": "// msg.url = \"https://d0c89290-0901-4a76-8a8c-4bb9c92f6fd2-bluemix:d93deef341315946577a459afa5f09e9f2c0e132f8a6ad1f5ccc3a2c2dc74752@d0c89290-0901-4a76-8a8c-4bb9c92f6fd2-bluemix.cloudant.com/login_user\";\nmsg.url = context.global.APIDB_url + \"/login_user\";\nmsg.url += '/' + msg.payload._id;\nmsg.url += '?rev=' + msg.payload._rev;\n\nmsg.headers = {\n    'Content-Type': 'application/json'\n};\n\nmsg.method = \"DELETE\";\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1887.0356979370117,
      "y": 1043.53568649292,
      "wires": [
        [
          "e5736c7b.4678a"
        ]
      ]
    },
    {
      "id": "490e73b8.5f5ffc",
      "type": "http in",
      "z": "4caa9583.52322c",
      "name": "ログイン要求",
      "url": "/api/v1/login",
      "method": "post",
      "upload": false,
      "swaggerDoc": "",
      "x": 130,
      "y": 140,
      "wires": [
        [
          "cd69d5d6.fe8fa8",
          "4ef9efba.403a3"
        ]
      ]
    },
    {
      "id": "193790f.2ea156f",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "共通パラメータチェック",
      "func": "/*\nvar errorFlag = true;\n\nif (errorFlag) {\n    //CHECK APIKEY\n    errorFlag = context.global.commonFunction.checkAPIKey();\n}\n\n// if (errorFlag) {\n//     //CHECK USER\n//     errorFlag = context.global.commonFunction.checkUser();\n// }\n*/\n\ncontext.global.Util.checkAPIKey(msg);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 710,
      "y": 540,
      "wires": [
        [
          "eb9040bb.b1e8"
        ]
      ]
    },
    {
      "id": "cc95aadb.2aa918",
      "type": "http in",
      "z": "4caa9583.52322c",
      "name": "パスワード変更要求",
      "url": "/api/v1/user/password",
      "method": "put",
      "upload": false,
      "swaggerDoc": "",
      "x": 150,
      "y": 720,
      "wires": [
        [
          "cd69d5d6.fe8fa8",
          "1b99da60.03f3f6"
        ]
      ]
    },
    {
      "id": "eb9040bb.b1e8",
      "type": "switch",
      "z": "4caa9583.52322c",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "ERROR",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "PUT",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 3,
      "x": 940,
      "y": 540,
      "wires": [
        [
          "86c90cc7.a66a"
        ],
        [
          "139f57e2.e71768"
        ],
        [
          "22dbfd35.3b9692"
        ]
      ]
    },
    {
      "id": "86c90cc7.a66a",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "共通パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: msg.common.errorMessage };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1290,
      "y": 240,
      "wires": [
        [
          "a616b254.637d",
          "a082b631.b338b8"
        ]
      ]
    },
    {
      "id": "139f57e2.e71768",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "取得処理",
      "func": "msg.tmp = msg.payload;\n\nif (msg.payload.id && msg.payload.user) {\n    msg.payload = {\n        \"_id\": msg.payload.id\n    };\n} else {\n    msg.payload.error = true;\n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1180,
      "y": 540,
      "wires": [
        [
          "e66222a7.75052"
        ]
      ]
    },
    {
      "id": "22dbfd35.3b9692",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "パスワード変更処理",
      "func": "if (msg.payload.id) {\n    //msg.url = \"https://d0c89290-0901-4a76-8a8c-4bb9c92f6fd2-bluemix:d93deef341315946577a459afa5f09e9f2c0e132f8a6ad1f5ccc3a2c2dc74752@d0c89290-0901-4a76-8a8c-4bb9c92f6fd2-bluemix.cloudant.com/login_user\";\n    msg.url = context.global.APIDB_url + \"/login_user\";\n    // msg.url += '/' + msg.payload.userid;\n    msg.url += '/' + msg.payload.id;\n    msg.tmp = msg.payload;\n} else {\n    msg.payload.error = true;\n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1220,
      "y": 940,
      "wires": [
        [
          "7cd21dbc.30cd34"
        ]
      ]
    },
    {
      "id": "e66222a7.75052",
      "type": "switch",
      "z": "4caa9583.52322c",
      "name": "必須チェック",
      "property": "payload.error",
      "propertyType": "msg",
      "rules": [
        {
          "t": "true"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1360,
      "y": 540,
      "wires": [
        [
          "a347ed0e.cfd4",
          "6a2204f5.862fec"
        ],
        [
          "7a34d9bb.70e318"
        ]
      ]
    },
    {
      "id": "7cd21dbc.30cd34",
      "type": "switch",
      "z": "4caa9583.52322c",
      "name": "必須チェック",
      "property": "payload.error",
      "propertyType": "msg",
      "rules": [
        {
          "t": "true"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1480,
      "y": 940,
      "wires": [
        [
          "50e09e8b.1d4d5",
          "56377b0f.2f7a34"
        ],
        [
          "92ea1aad.656408"
        ]
      ]
    },
    {
      "id": "af00b10.ffad45",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "認証ＯＫ応答",
      "func": "msg.payload={\n    result: \"success\",\n    //パスワード以外のユーザ情報\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2780,
      "y": 620,
      "wires": [
        [
          "3c1f7ba1.3f9364",
          "dab42f6f.6a7b8"
        ]
      ]
    },
    {
      "id": "fecd8f6.dd55e7",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "認証ＮＧ応答",
      "func": "msg.payload={\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2800,
      "y": 520,
      "wires": [
        [
          "3b2ab48.d6abb4c"
        ]
      ]
    },
    {
      "id": "73a29d5b.2af164",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "パスワード変更エラー応答",
      "func": "msg.payload = {\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2240,
      "y": 940,
      "wires": [
        [
          "158f912f.8721ff"
        ]
      ]
    },
    {
      "id": "8ad0a86f.5dbf78",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "パスワード変更応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 3360,
      "y": 800,
      "wires": [
        [
          "f079cc4f.ef90c",
          "ab7ef17b.29c9e"
        ]
      ]
    },
    {
      "id": "a347ed0e.cfd4",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "エラーメッセージ",
      "func": "msg.payload = \"invalid parameter.\";\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2530,
      "y": 520,
      "wires": [
        [
          "fecd8f6.dd55e7"
        ]
      ]
    },
    {
      "id": "50e09e8b.1d4d5",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "エラーメッセージ",
      "func": "msg.payload = \"invalid parameter.\";\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1730,
      "y": 940,
      "wires": [
        [
          "73a29d5b.2af164"
        ]
      ]
    },
    {
      "id": "92ea1aad.656408",
      "type": "http request",
      "z": "4caa9583.52322c",
      "name": "KEY取得要求",
      "method": "GET",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1720,
      "y": 1020,
      "wires": [
        [
          "d7ed637e.31c6c"
        ]
      ]
    },
    {
      "id": "3c808d4c.c603f2",
      "type": "switch",
      "z": "4caa9583.52322c",
      "name": "認証結果",
      "property": "authentication",
      "propertyType": "msg",
      "rules": [
        {
          "t": "true"
        },
        {
          "t": "false"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2560,
      "y": 620,
      "wires": [
        [
          "af00b10.ffad45"
        ],
        [
          "fecd8f6.dd55e7",
          "5038f17c.a8f49"
        ]
      ]
    },
    {
      "id": "faa8c5bc.167018",
      "type": "switch",
      "z": "4caa9583.52322c",
      "name": "認証結果",
      "property": "authentication",
      "propertyType": "msg",
      "rules": [
        {
          "t": "true"
        },
        {
          "t": "false"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2560,
      "y": 1020,
      "wires": [
        [
          "4aa12920.71f4d8"
        ],
        [
          "6c10cce4.874334"
        ]
      ]
    },
    {
      "id": "d7ed637e.31c6c",
      "type": "switch",
      "z": "4caa9583.52322c",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "200",
          "vt": "str"
        },
        {
          "t": "neq",
          "v": "200",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1990,
      "y": 1020,
      "wires": [
        [
          "8a93bc83.bd198"
        ],
        [
          "73a29d5b.2af164",
          "47c5139e.8f287c"
        ]
      ]
    },
    {
      "id": "89951126.e777e",
      "type": "switch",
      "z": "4caa9583.52322c",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3070,
      "y": 800,
      "wires": [
        [
          "8ad0a86f.5dbf78"
        ],
        [
          "73a29d5b.2af164",
          "47c5139e.8f287c"
        ]
      ]
    },
    {
      "id": "7ebd4eb2.009d6",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "認証処理",
      "func": "// var user = msg.payload[0]; \nvar user = msg.payload; \nif (user && user.password) {\n    var decryptedStr = context.global.Util.decrypt(user.password);\n    if (msg.tmp.password === decryptedStr) {\n        msg.authentication = true;\n        msg.payload = user;\n        delete msg.payload['password'];\n        msg.common.loginUser = msg.payload.userid;\n        \n    } else {\n        msg.authentication = false;\n        msg.common.loginUser = msg.payload.userid;\n        msg.payload = \"invalid userid or password.\";\n    }\n    \n} else {\n    msg.authentication = false;\n    msg.common.loginUser = msg.tmp.id;\n    msg.payload = \"invalid userid or password.\";\n}\n/*\nif (true) {\n    msg.authentication = true;\n    msg.payload = {\n        userid: \"user1\",\n        group: [\"user\", \"maint\", \"admin\"],\n        create_date: \"2017-02-28 00:00:00.000\",\n        modify_date: \"2017-02-28 00:00:00.000\",\n        user: \"user1\"\n    };\n} else {\n    msg.authentication = false;\n    msg.payload = \"パスワード不一致\";\n}\n*/\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2380,
      "y": 620,
      "wires": [
        [
          "3c808d4c.c603f2"
        ]
      ]
    },
    {
      "id": "8a93bc83.bd198",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "認証&新パスワード設定処理",
      "func": "var user = msg.payload;\nif (user) {\n    var decryptedStr = context.global.Util.decrypt(user.password);\n    if (msg.tmp.old_password === decryptedStr) {\n        msg.authentication = true;\n        msg.payload = user;\n        \n        // password encryption\n        var encryptedStr = context.global.Util.encrypt(msg.tmp.new_password);\n        msg.payload.password = encryptedStr;\n        \n    } else {\n        msg.authentication = false;\n        msg.payload = \"invalid userid or password.\";\n    }\n    \n} else {\n    msg.authentication = false;\n    msg.payload = \"invalid userid or password.\";\n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2340,
      "y": 1020,
      "wires": [
        [
          "faa8c5bc.167018"
        ]
      ]
    },
    {
      "id": "4aa12920.71f4d8",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "パスワード変更処理2",
      "func": "// msg.url = \"https://d0c89290-0901-4a76-8a8c-4bb9c92f6fd2-bluemix:d93deef341315946577a459afa5f09e9f2c0e132f8a6ad1f5ccc3a2c2dc74752@d0c89290-0901-4a76-8a8c-4bb9c92f6fd2-bluemix.cloudant.com/login_user\";\nmsg.url = context.global.APIDB_url + \"/login_user\";\nmsg.url += '/' + msg.payload._id;\n\nmsg.headers = {\n    'Content-Type': 'application/json'\n};\n\nmsg.method = \"PUT\";\n\nvar currentTimestampMili = context.global.Util.currentTimestampMili();\n\n// // password encryption\n// var encryptedStr = context.global.commonFunction.encrypt(msg.tmp.password);\n\nmsg.payload = {\n    _id : msg.payload._id,\n    _rev : msg.payload._rev,\n    userid: msg.payload._id,\n    password: msg.payload.password,\n    group: msg.payload.group,\n    create_date : msg.payload.create_date,\n    modify_date : context.global.Util.formatTimestamp(currentTimestampMili),\n    user : msg.payload._id,\n    flag : msg.payload.flag\n};\n\nmsg.common.passwordChangedUser = msg.payload._id;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2780,
      "y": 1000,
      "wires": [
        [
          "7a8ad970.f8f3e8"
        ]
      ]
    },
    {
      "id": "7a8ad970.f8f3e8",
      "type": "http request",
      "z": "4caa9583.52322c",
      "name": "パスワード変更要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 2820,
      "y": 800,
      "wires": [
        [
          "89951126.e777e"
        ]
      ]
    },
    {
      "id": "cd69d5d6.fe8fa8",
      "type": "change",
      "z": "4caa9583.52322c",
      "name": "メソッド設定",
      "rules": [
        {
          "t": "set",
          "p": "common.method",
          "pt": "msg",
          "to": "req.method",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 480,
      "y": 540,
      "wires": [
        [
          "193790f.2ea156f"
        ]
      ]
    },
    {
      "id": "6c10cce4.874334",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "認証ＮＧ応答",
      "func": "msg.payload={\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2760,
      "y": 1040,
      "wires": [
        [
          "4493880f.d41b68",
          "47c5139e.8f287c"
        ]
      ]
    },
    {
      "id": "4493880f.d41b68",
      "type": "http response",
      "z": "4caa9583.52322c",
      "name": "応答",
      "x": 2950,
      "y": 1040,
      "wires": []
    },
    {
      "id": "fba75eaa.c23aa",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "共通パラメータチェック",
      "func": "/*\nvar errorFlag = true;\n\nif (errorFlag) {\n    //CHECK APIKEY\n    errorFlag = context.global.commonFunction.checkAPIKey();\n}\n\nif (errorFlag) {\n    //CHECK USER\n    errorFlag = context.global.commonFunction.checkUser();\n}\n*/\n\ncontext.global.Util.checkAPIKeyAndUser(msg);\n\n// msg.payload = flow.method;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 570,
      "y": 340,
      "wires": [
        [
          "a585157b.e33068",
          "c1e686e.d60bb78"
        ]
      ]
    },
    {
      "id": "a585157b.e33068",
      "type": "switch",
      "z": "ab8060fa.504b3",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "ERROR",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "GET",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 3,
      "x": 800,
      "y": 340,
      "wires": [
        [
          "ecd3ca71.cae9b8"
        ],
        [
          "76938e20.98ad4"
        ],
        [
          "77702ec3.19f47"
        ]
      ]
    },
    {
      "id": "ecd3ca71.cae9b8",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "共通パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: msg.common.errorMessage };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1070,
      "y": 160,
      "wires": [
        [
          "c027d9ff.d73498",
          "37abf650.5451ca"
        ]
      ]
    },
    {
      "id": "77702ec3.19f47",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "ロックファイル存在チェック",
      "func": "msg.filename = context.global.Const.SEMAPHORE_PATH;\n\nfunction isExistFile(file) {\n    var fs = context.global.Fs;\n    try {\n        fs.statSync(file);\n        return true\n    } catch(err) {\n        if(err.code === 'ENOENT') return false\n    }\n}\n\nmsg.payload = isExistFile(msg.filename);\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1020,
      "y": 760,
      "wires": [
        [
          "299a7df6.237f32"
        ]
      ]
    },
    {
      "id": "fb73d10f.38e89",
      "type": "http response",
      "z": "ab8060fa.504b3",
      "name": "",
      "x": 2370,
      "y": 220,
      "wires": []
    },
    {
      "id": "5f755a4a.b7e764",
      "type": "file in",
      "z": "ab8060fa.504b3",
      "name": "",
      "filename": "",
      "format": "utf8",
      "x": 1370,
      "y": 380,
      "wires": [
        [
          "ebf7902f.f8b37"
        ]
      ]
    },
    {
      "id": "299a7df6.237f32",
      "type": "switch",
      "z": "ab8060fa.504b3",
      "name": "",
      "property": "payload",
      "propertyType": "msg",
      "rules": [
        {
          "t": "true"
        },
        {
          "t": "false"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1250,
      "y": 760,
      "wires": [
        [
          "fff205cd.e5ef68"
        ],
        [
          "dee3686c.4b9f48"
        ]
      ]
    },
    {
      "id": "ac6c5143.0f14a",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "インポート応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.originalfilename+\" uploaded.\"\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2200,
      "y": 220,
      "wires": [
        [
          "fb73d10f.38e89",
          "dc4d43b9.72d4f"
        ]
      ]
    },
    {
      "id": "ebf7902f.f8b37",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "ヘッダー行切出し",
      "func": "var content = msg.payload+\"\";\nmsg.headerLine = content.substring(0, content.indexOf('\\r\\n'));\n\nmsg.payload = msg.tmp;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1550,
      "y": 380,
      "wires": [
        [
          "a186634e.2dfa5",
          "291f5e8d.01dd52"
        ]
      ]
    },
    {
      "id": "fff205cd.e5ef68",
      "type": "file in",
      "z": "ab8060fa.504b3",
      "name": "",
      "filename": "",
      "format": "utf8",
      "sendError": true,
      "x": 1426.6667175292969,
      "y": 727.9999160766602,
      "wires": [
        [
          "a4992425.6eaf08"
        ]
      ]
    },
    {
      "id": "dee3686c.4b9f48",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "ロックファイルなし応答",
      "func": "// var obj = JSON.parse(msg.payload);\n// var time = obj.time;\nvar currentTimestampMili = context.global.Util.currentTimestampMili();\n\nmsg.payload = {\n    result: \"success\",\n    message: {\n        status: \"idle\",\n        time: currentTimestampMili\n    }\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1490,
      "y": 780,
      "wires": [
        [
          "c0c1df4c.a457e"
        ]
      ]
    },
    {
      "id": "b2916bc6.5855f8",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "select file",
      "func": "// var path = msg.req.files.myFile[0].path;\n// var originalfilename = msg.req.files.myFile[0].originalname;\nvar originalfilename = msg.req.files[0].originalname;\n// msg.filename = path;\nmsg.originalfilename = originalfilename;\n\ncontext.global.api3 = {};\ncontext.global.api3.filename = msg.filename;\ncontext.global.api3.user = msg.payload.user;\n\ncontext.global.api3.lines = 0;\ncontext.global.api3.data = [];\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2000,
      "y": 380,
      "wires": [
        [
          "6b110af2.439814",
          "ac6c5143.0f14a",
          "6f4b7b2e.3bb224"
        ]
      ]
    },
    {
      "id": "a186634e.2dfa5",
      "type": "debug",
      "z": "ab8060fa.504b3",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "headerLine",
      "x": 1760,
      "y": 320,
      "wires": []
    },
    {
      "id": "291f5e8d.01dd52",
      "type": "switch",
      "z": "ab8060fa.504b3",
      "name": "CSVヘッダーチェック",
      "property": "headerLine",
      "propertyType": "msg",
      "rules": [
        {
          "t": "regex",
          "v": "^\\s*question\\s*,\\s*answer\\s*,\\s*url\\s*$",
          "vt": "str",
          "case": false
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1780,
      "y": 380,
      "wires": [
        [
          "b2916bc6.5855f8",
          "793efb04.38f054"
        ],
        [
          "56376e94.82353"
        ]
      ]
    },
    {
      "id": "a4992425.6eaf08",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "ステータス応答",
      "func": "var obj = JSON.parse(msg.payload);\nvar time = obj.time;\nvar currentTimestampMili = context.global.Util.currentTimestampMili();\n\nvar diff_minute = (currentTimestampMili - time)/1000/60;\n\nvar status = \"\";\nif (obj.status === \"exec\" && diff_minute >= 60) {\n// if (obj.status === \"exec\" && diff_minute >= 1) {\n    status = \"idle\";\n} else {\n    status = obj.status;\n}\n\nmsg.payload = {\n    result: \"success\",\n    message: {\n        status: status,\n        time: obj.time\n    }\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1590.0000305175781,
      "y": 727.3332901000977,
      "wires": [
        [
          "6edb018d.cf6b5",
          "42d67c49.525744"
        ]
      ]
    },
    {
      "id": "6edb018d.cf6b5",
      "type": "http response",
      "z": "ab8060fa.504b3",
      "name": "",
      "x": 1810,
      "y": 740,
      "wires": []
    },
    {
      "id": "6b110af2.439814",
      "type": "debug",
      "z": "ab8060fa.504b3",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "true",
      "x": 2170,
      "y": 420,
      "wires": []
    },
    {
      "id": "6f4b7b2e.3bb224",
      "type": "bigfile reader",
      "z": "ab8060fa.504b3",
      "name": "",
      "filename": "",
      "nopayload": false,
      "flow": "lines",
      "highWaterMark": 16,
      "encoding": "utf8",
      "format": "utf8",
      "keepEmptyLines": false,
      "x": 2180,
      "y": 360,
      "wires": [
        [
          "3b459505.5f5f6a"
        ],
        [
          "3b459505.5f5f6a"
        ]
      ]
    },
    {
      "id": "56376e94.82353",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "アップロードエラー応答",
      "func": "msg.payload={\n    result: \"failure\",\n    message: \"unknown csv header \"\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2030,
      "y": 540,
      "wires": [
        [
          "a54046ab.2fa288",
          "85ecd64d.1231c8"
        ]
      ]
    },
    {
      "id": "3b459505.5f5f6a",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "add header",
      "func": "// if (msg.payload) {\n//     context.global.lines++;\n// }\n// if (msg.control && msg.control.state == 'start') {\n//     global.lines = 0;\n// }\nif (msg.control && msg.control.state == 'end') {\n    msg.payload = \"END\";\n    \n} else {\n\n    if (msg.payload) {\n        context.global.api3.lines++;\n    }\n    \n    if (context.global.api3.lines == 1) {\n        context.global.api3.csvheader = msg.payload;\n    } else {\n        var line = msg.payload+\"\";\n        msg.payload = context.global.api3.csvheader+\"\\r\\n\"+line;\n    }\n\n    \n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2350,
      "y": 360,
      "wires": [
        [
          "439969ea.c79b08"
        ]
      ]
    },
    {
      "id": "a54046ab.2fa288",
      "type": "http response",
      "z": "ab8060fa.504b3",
      "name": "",
      "x": 2230,
      "y": 540,
      "wires": []
    },
    {
      "id": "439969ea.c79b08",
      "type": "switch",
      "z": "ab8060fa.504b3",
      "name": "",
      "property": "payload",
      "propertyType": "msg",
      "rules": [
        {
          "t": "neq",
          "v": "END",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "END",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2510,
      "y": 360,
      "wires": [
        [
          "6ec3475.11715b8"
        ],
        [
          "866897a.d737e68"
        ]
      ]
    },
    {
      "id": "6ec3475.11715b8",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "store",
      "func": "context.global.api3.data[context.global.api3.lines-1]=msg.payload;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2650,
      "y": 340,
      "wires": [
        []
      ]
    },
    {
      "id": "866897a.d737e68",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "end",
      "func": "msg.count = 1;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2650,
      "y": 380,
      "wires": [
        [
          "b5a8a0b6.43f44",
          "8a7c143e.9f84e8"
        ]
      ]
    },
    {
      "id": "b5a8a0b6.43f44",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "new context.global.rows",
      "func": "context.global.api3.rows = [];\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2890,
      "y": 420,
      "wires": [
        [
          "11742d.2052ebd4"
        ]
      ]
    },
    {
      "id": "8a7c143e.9f84e8",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "get filename",
      "func": "msg.filename = context.global.api3.filename;\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2851.000015258789,
      "y": 360.0000057220459,
      "wires": [
        [
          "b6f3c571.dca998"
        ]
      ]
    },
    {
      "id": "11742d.2052ebd4",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "get data[count]",
      "func": "msg.payload = context.global.api3.data[msg.count];\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3140,
      "y": 420,
      "wires": [
        [
          "986de778.636c58"
        ]
      ]
    },
    {
      "id": "b6f3c571.dca998",
      "type": "file",
      "z": "ab8060fa.504b3",
      "name": "",
      "filename": "",
      "appendNewline": true,
      "createDir": false,
      "overwriteFile": "delete",
      "x": 3019.7500190734863,
      "y": 358.7500057220459,
      "wires": []
    },
    {
      "id": "55703a45.8398b4",
      "type": "delay",
      "z": "ab8060fa.504b3",
      "name": "",
      "pauseType": "delay",
      "timeout": "10",
      "timeoutUnits": "milliseconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 3470,
      "y": 320,
      "wires": [
        [
          "11742d.2052ebd4"
        ]
      ]
    },
    {
      "id": "986de778.636c58",
      "type": "csv",
      "z": "ab8060fa.504b3",
      "name": "",
      "sep": ",",
      "hdrin": true,
      "hdrout": "",
      "multi": "one",
      "ret": "\\r\\n",
      "temp": "",
      "x": 3310,
      "y": 420,
      "wires": [
        [
          "66eaccc.3753534"
        ]
      ]
    },
    {
      "id": "354c606e.a0511",
      "type": "switch",
      "z": "ab8060fa.504b3",
      "name": "",
      "property": "count",
      "propertyType": "msg",
      "rules": [
        {
          "t": "lt",
          "v": "api3.lines",
          "vt": "global"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3870,
      "y": 420,
      "wires": [
        [
          "55703a45.8398b4"
        ],
        [
          "d6d8705d.462a4"
        ]
      ]
    },
    {
      "id": "66eaccc.3753534",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "set line to array",
      "func": "context.global.api3.rows[msg.count-1] = msg.payload;\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3480,
      "y": 420,
      "wires": [
        [
          "263d4029.f87e1"
        ]
      ]
    },
    {
      "id": "263d4029.f87e1",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "msg.count + 1",
      "func": "msg.count++;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3680,
      "y": 420,
      "wires": [
        [
          "354c606e.a0511",
          "685458d3.287448"
        ]
      ]
    },
    {
      "id": "27c12e6f.fbfed2",
      "type": "http request",
      "z": "ab8060fa.504b3",
      "name": "Max(id)取得要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 4300,
      "y": 420,
      "wires": [
        [
          "1a1605bf.4d3fda"
        ]
      ]
    },
    {
      "id": "685458d3.287448",
      "type": "debug",
      "z": "ab8060fa.504b3",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "count",
      "x": 3890,
      "y": 480,
      "wires": []
    },
    {
      "id": "1a1605bf.4d3fda",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "Max(id)取得",
      "func": "if (msg.payload.rows.length === 0) {\n    msg.maxId = 0;\n} else {\n    msg.maxId = msg.payload.rows[0].value.max;\n}\nmsg.payload = msg.tmp;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 4490,
      "y": 420,
      "wires": [
        [
          "ef6ba088.c805d",
          "74b38fe0.6d634"
        ]
      ]
    },
    {
      "id": "ef6ba088.c805d",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "make QA_DOC",
      "func": "const PAGE_SIZE = 500;\nvar rowsLength = context.global.api3.rows.length;\nvar rows = context.global.api3.rows;\n\nvar list = [];\nvar pageCount = Math.floor(rowsLength / PAGE_SIZE);\nvar remainder = rowsLength % PAGE_SIZE;\n\nvar currentTimestampMili = context.global.Util.currentTimestampMili();\nvar maxId = msg.maxId;\n\nfor (var p=0; p < pageCount; p++) {\n    var docs = [];\n    for (var i=p*PAGE_SIZE; i < p*PAGE_SIZE+PAGE_SIZE; i++) {\n        //var currentTimestampMili = context.global.commonFunction.currentTimestampMili() + i;\n\n        //var id = currentTimestampMili+\"\";\n        var id = ++maxId + \"\";\n        var record = {\n            \"_id\": id,\n            \"question\": rows[i].question,\n            \"answer\": rows[i].answer,\n            \"id\": id,\n            \"create_date\": context.global.Util.formatTimestamp(currentTimestampMili),\n            \"flag\": 1,\n            \"user\": context.global.api3.user\n            ,\"url\": rows[i].url\n        };\n        docs.push(record);\n    }\n    list[p] = { \"docs\": docs };\n\n}\nif (remainder > 0) {\n    var docs = [];\n    for (var i=pageCount*PAGE_SIZE; i < pageCount*PAGE_SIZE+remainder; i++) {\n        //var currentTimestampMili = context.global.commonFunction.currentTimestampMili() + i;\n\n        //var id = currentTimestampMili+\"\";\n        var id = ++maxId + \"\";\n        var record = {\n            \"_id\": id,\n            \"question\": rows[i].question,\n            \"answer\": rows[i].answer,\n            \"id\": id,\n            \"create_date\": context.global.Util.formatTimestamp(currentTimestampMili),\n            \"flag\": 1,\n            \"user\": context.global.api3.user\n            ,\"url\": rows[i].url\n        };\n        docs.push(record);\n    }\n    list[pageCount] = { \"docs\": docs }\n}\n\nmsg.list = list;\nmsg.index = 0;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 4680,
      "y": 420,
      "wires": [
        [
          "16ee3b68.04bd05"
        ]
      ]
    },
    {
      "id": "16ee3b68.04bd05",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "get list[msg.index]",
      "func": "msg.payload = msg.list[msg.index];\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 3910,
      "y": 760,
      "wires": [
        [
          "2a77a314.89ef5c",
          "af0567ba.36d028"
        ]
      ]
    },
    {
      "id": "2a77a314.89ef5c",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "msg.index++",
      "func": "msg.index++;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 4129.333442687988,
      "y": 728.8096046447754,
      "wires": [
        [
          "17aff417.00c52c"
        ]
      ]
    },
    {
      "id": "17aff417.00c52c",
      "type": "switch",
      "z": "ab8060fa.504b3",
      "name": "msg.index < msg.list.length",
      "property": "index",
      "propertyType": "msg",
      "rules": [
        {
          "t": "lt",
          "v": "list.length",
          "vt": "msg"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 4020,
      "y": 580,
      "wires": [
        [
          "16ee3b68.04bd05"
        ],
        [
          "f6aa7bcd.b87f28"
        ]
      ]
    },
    {
      "id": "5d41833c.92ceac",
      "type": "http request",
      "z": "ab8060fa.504b3",
      "name": "",
      "method": "use",
      "ret": "txt",
      "url": "",
      "tls": "",
      "x": 4330,
      "y": 780,
      "wires": [
        [
          "ff8a9500.bf8908"
        ]
      ]
    },
    {
      "id": "f6aa7bcd.b87f28",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "insert count",
      "func": "var total = 0;\nfor (var i=0; i < msg.list.length; i++) {\n    total += msg.list[i].docs.length;\n}\nmsg.payload = {\n    \"insert count\": total\n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 4490,
      "y": 620,
      "wires": [
        [
          "ec7f3216.c16ca",
          "cc849d78.a6294",
          "1fa765e3.a11bea"
        ]
      ]
    },
    {
      "id": "ff8a9500.bf8908",
      "type": "switch",
      "z": "ab8060fa.504b3",
      "name": "",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "201",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 4470,
      "y": 780,
      "wires": [
        [],
        [
          "29773be4.ee6ee4",
          "99c6e524.78f488"
        ]
      ]
    },
    {
      "id": "29773be4.ee6ee4",
      "type": "debug",
      "z": "ab8060fa.504b3",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "true",
      "x": 4630,
      "y": 740,
      "wires": []
    },
    {
      "id": "6099a5a2.476cac",
      "type": "http in",
      "z": "ab8060fa.504b3",
      "name": "ステータス確認要求",
      "url": "/api/v1/check",
      "method": "get",
      "upload": false,
      "swaggerDoc": "",
      "x": 110,
      "y": 900,
      "wires": [
        [
          "413b6665.7d2668",
          "b8d98587.7959e8"
        ]
      ]
    },
    {
      "id": "c1e686e.d60bb78",
      "type": "debug",
      "z": "ab8060fa.504b3",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "payload",
      "x": 790,
      "y": 280,
      "wires": []
    },
    {
      "id": "ec4b571f.4a1e88",
      "type": "http in",
      "z": "ab8060fa.504b3",
      "name": "アップロード要求",
      "url": "/api/v1/faqdoc/upload",
      "method": "post",
      "upload": true,
      "swaggerDoc": "",
      "x": 130,
      "y": 84,
      "wires": [
        [
          "413b6665.7d2668",
          "1e70d6d.ddbec29"
        ]
      ]
    },
    {
      "id": "76938e20.98ad4",
      "type": "function",
      "z": "ab8060fa.504b3",
      "name": "ファイルパス設定",
      "func": "msg.filename = '/tmp/' + msg.req.files[0].originalname;\n\nmsg.tmp = msg.payload;\n\nmsg.payload = msg.req.files[0].buffer;\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1010,
      "y": 340,
      "wires": [
        [
          "193c1686.e030e9",
          "f964ad88.5eff5"
        ]
      ]
    },
    {
      "id": "193c1686.e030e9",
      "type": "file",
      "z": "ab8060fa.504b3",
      "name": "",
      "filename": "",
      "appendNewline": false,
      "createDir": false,
      "overwriteFile": "true",
      "x": 1210,
      "y": 340,
      "wires": []
    },
    {
      "id": "f964ad88.5eff5",
      "type": "delay",
      "z": "ab8060fa.504b3",
      "name": "",
      "pauseType": "delay",
      "timeout": "1",
      "timeoutUnits": "seconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 1220,
      "y": 380,
      "wires": [
        [
          "5f755a4a.b7e764"
        ]
      ]
    },
    {
      "id": "dccc2e99.62769",
      "type": "inject",
      "z": "b85ebbb8.71d748",
      "name": "変数確認",
      "topic": "",
      "payload": "",
      "payloadType": "date",
      "repeat": "",
      "crontab": "",
      "once": false,
      "x": 100,
      "y": 702,
      "wires": [
        [
          "ac4d3eec.ba2cf"
        ]
      ]
    },
    {
      "id": "2c03b6bd.70a81a",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "メソッド設定",
      "rules": [
        {
          "t": "set",
          "p": "common.method",
          "pt": "msg",
          "to": "req.method",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 400,
      "y": 580,
      "wires": [
        [
          "e5bdc12c.2a62e"
        ]
      ]
    },
    {
      "id": "413b6665.7d2668",
      "type": "change",
      "z": "ab8060fa.504b3",
      "name": "メソッド設定",
      "rules": [
        {
          "t": "set",
          "p": "common.method",
          "pt": "msg",
          "to": "req.method",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 340,
      "y": 340,
      "wires": [
        [
          "fba75eaa.c23aa"
        ]
      ]
    },
    {
      "id": "74b38fe0.6d634",
      "type": "debug",
      "z": "ab8060fa.504b3",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "true",
      "x": 4650,
      "y": 360,
      "wires": []
    },
    {
      "id": "ec7f3216.c16ca",
      "type": "change",
      "z": "ab8060fa.504b3",
      "name": "",
      "rules": [
        {
          "t": "delete",
          "p": "api3",
          "pt": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4710,
      "y": 640,
      "wires": [
        []
      ]
    },
    {
      "id": "d6d8705d.462a4",
      "type": "change",
      "z": "ab8060fa.504b3",
      "name": "VIEW_FAQ_MAXID",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.VIEW_FAQ_MAXID",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "tmp",
          "pt": "msg",
          "to": "payload",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4080,
      "y": 420,
      "wires": [
        [
          "27c12e6f.fbfed2"
        ]
      ]
    },
    {
      "id": "af0567ba.36d028",
      "type": "change",
      "z": "ab8060fa.504b3",
      "name": "BULK_DOC_FAQ",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "POST",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.BULK_DOC_FAQ",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4150,
      "y": 780,
      "wires": [
        [
          "5d41833c.92ceac"
        ]
      ]
    },
    {
      "id": "cc849d78.a6294",
      "type": "debug",
      "z": "ab8060fa.504b3",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "false",
      "x": 4690,
      "y": 560,
      "wires": []
    },
    {
      "id": "4c67b1d4.1d5d6",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "共通パラメータチェック",
      "func": "/*\nvar errorFlag = true;\n\nif (errorFlag) {\n    //CHECK APIKEY\n    errorFlag = context.global.commonFunction.checkAPIKey();\n}\n\nif (errorFlag) {\n    //CHECK USER\n    errorFlag = context.global.commonFunction.checkUser();\n}\n*/\n\ncontext.global.Util.checkAPIKeyAndUser(msg);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 610,
      "y": 500,
      "wires": [
        [
          "ddec7fb6.a6169"
        ]
      ]
    },
    {
      "id": "f506d70b.0a9f88",
      "type": "http in",
      "z": "f88d33bb.e0bc5",
      "name": "テーブルドロップ要求",
      "url": "/api/v1/faqdoc/drop",
      "method": "delete",
      "upload": false,
      "swaggerDoc": "",
      "x": 140,
      "y": 680,
      "wires": [
        [
          "a01801b7.b2259",
          "bf7efbb2.ab9c28"
        ]
      ]
    },
    {
      "id": "bae873df.2f274",
      "type": "http in",
      "z": "f88d33bb.e0bc5",
      "name": "エクスポート要求",
      "url": "/api/v1/faqdoc/export",
      "method": "get",
      "upload": false,
      "swaggerDoc": "",
      "x": 150,
      "y": 500,
      "wires": [
        [
          "a01801b7.b2259",
          "b97faec1.8417"
        ]
      ]
    },
    {
      "id": "ddec7fb6.a6169",
      "type": "switch",
      "z": "f88d33bb.e0bc5",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "ERROR",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "GET",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "DELETE",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 4,
      "x": 820,
      "y": 500,
      "wires": [
        [
          "6e6f5bc1.db2fe4"
        ],
        [
          "203a9141.03e94e"
        ],
        [
          "42db1610.ada368"
        ],
        [
          "37f52944.ce5b56",
          "af2a6e98.f0e41"
        ]
      ]
    },
    {
      "id": "6e6f5bc1.db2fe4",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "共通パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: msg.common.errorMessage };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1170,
      "y": 100,
      "wires": [
        [
          "9a9e00e7.90dc2",
          "d1017e61.be0fd"
        ]
      ]
    },
    {
      "id": "219a5f09.3a264",
      "type": "http response",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "x": 4310,
      "y": 1020,
      "wires": []
    },
    {
      "id": "68f6ab16.30c384",
      "type": "file in",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "filename": "",
      "format": "utf8",
      "sendError": true,
      "x": 1450,
      "y": 500,
      "wires": [
        [
          "aee1cb4e.c41cf8"
        ]
      ]
    },
    {
      "id": "d131bee5.68d4c",
      "type": "http request",
      "z": "f88d33bb.e0bc5",
      "name": "Cloudantデータ取得要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1370,
      "y": 1800,
      "wires": [
        [
          "198e1249.3fdcae"
        ]
      ]
    },
    {
      "id": "743bca37.5e60c4",
      "type": "http request",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1290,
      "y": 720,
      "wires": [
        [
          "16b9cbf7.ffbd84"
        ]
      ]
    },
    {
      "id": "2a7de33a.ec6b1c",
      "type": "switch",
      "z": "f88d33bb.e0bc5",
      "name": "CSVヘッダーチェック",
      "property": "headerLine",
      "propertyType": "msg",
      "rules": [
        {
          "t": "regex",
          "v": "^\\s*id\\s*,\\s*question\\s*,\\s*answer\\s*,\\s*url\\s*$",
          "vt": "str",
          "case": false
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1860,
      "y": 500,
      "wires": [
        [
          "37f52944.ce5b56",
          "e0e33198.92c66"
        ],
        [
          "591a62db.ec1d3c"
        ]
      ]
    },
    {
      "id": "77bad58d.c4e3dc",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "インポート応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.originalfilename+\" uploaded.\"\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 4142,
      "y": 1043,
      "wires": [
        [
          "219a5f09.3a264",
          "24bf2a57.bcdf66"
        ]
      ]
    },
    {
      "id": "aee1cb4e.c41cf8",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "ヘッダー行切出し",
      "func": "var content = msg.payload+\"\";\nmsg.headerLine = content.substring(0, content.indexOf('\\r\\n'));\n\nmsg.payload = msg.tmp;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1630,
      "y": 500,
      "wires": [
        [
          "2a7de33a.ec6b1c",
          "cf1d9b13.1bbb18"
        ]
      ]
    },
    {
      "id": "198e1249.3fdcae",
      "type": "switch",
      "z": "f88d33bb.e0bc5",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "200",
          "vt": "str"
        },
        {
          "t": "neq",
          "v": "200",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1590,
      "y": 1800,
      "wires": [
        [
          "bac5606.eef3da",
          "67886c54.7314c4"
        ],
        [
          "acc408db.11fd08"
        ]
      ]
    },
    {
      "id": "e0eb92f4.3ce2c",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "make doc",
      "func": "const PAGE_SIZE = 10000;\nvar rowsLength = msg.payload.rows.length;\nvar rows = msg.payload.rows;\n\nvar list = [];\nvar pageCount = Math.floor(rowsLength / PAGE_SIZE);\nvar remainder = rowsLength % PAGE_SIZE;\n\nfor (var p=0; p < pageCount; p++) {\n    var docs = [];\n    for (var i=p*PAGE_SIZE; i < p*PAGE_SIZE+PAGE_SIZE; i++) {\n        if (rows[i].doc.user) {\n            var id = rows[i].id;\n            var rev = rows[i].value.rev;\n            var record = {\n                \"_id\": id,\n                \"_rev\": rev,\n                \"_deleted\": true\n            };\n            docs.push(record);\n        }\n    }\n    list[p] = { \"docs\": docs };\n\n}\nif (remainder > 0) {\n    var docs = [];\n    for (var i=pageCount*PAGE_SIZE; i < pageCount*PAGE_SIZE+remainder; i++) {\n        if (rows[i].doc.user) {\n            var id = rows[i].id;\n            var rev = rows[i].value.rev;\n            var record = {\n                \"_id\": id,\n                \"_rev\": rev,\n                \"_deleted\": true\n            };\n            docs.push(record);\n        }\n    }\n    list[pageCount] = { \"docs\": docs }\n}\n\nmsg.list = list;\nmsg.index = 0;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1638.4286041259766,
      "y": 710.2143726348877,
      "wires": [
        [
          "424e37e6.5ae228"
        ]
      ]
    },
    {
      "id": "591a62db.ec1d3c",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "インポートエラー応答",
      "func": "msg.payload={\n    result: \"failure\",\n    message: \"unknown csv header \"\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2120,
      "y": 520,
      "wires": [
        [
          "c47dd0d0.090c",
          "eb6ccc82.d6c94"
        ]
      ]
    },
    {
      "id": "5ba26b5e.021374",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "select file",
      "func": "// var path = msg.req.files.myFile[0].path;\n// var originalfilename = msg.req.files.myFile[0].originalname;\nvar originalfilename = msg.req.files[0].originalname;\n// msg.filename = path;\nmsg.originalfilename = originalfilename;\n\ncontext.global.api10 = {};\ncontext.global.api10.filename = msg.filename;\ncontext.global.api10.user = msg.payload.user;\n\ncontext.global.api10.lines = 0;\ncontext.global.api10.data = [];\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 3943.3333129882812,
      "y": 1097.3333339691162,
      "wires": [
        [
          "1086b7b4.a07dc8",
          "77bad58d.c4e3dc",
          "f911123d.e3b9a"
        ]
      ]
    },
    {
      "id": "bac5606.eef3da",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "CSV作成",
      "func": "var currentTimestampMili = context.global.Util.currentTimestampMili();\nvar prefix = context.global.Const.EXPORT_FILE_FAQ;\nvar fileName = context.global.Util.getDownloadFileName(prefix, currentTimestampMili);\nvar csv = \"id, question, answer, url\\r\\n\";\nfor (i=0; i < msg.payload.rows.length; i++) {\n    var url = \"\";\n    if (msg.payload.rows[i].value.url) {\n        url = msg.payload.rows[i].value.url;\n    }\n    csv += msg.payload.rows[i].value.id+\",\"+msg.payload.rows[i].value.question+\",\"+msg.payload.rows[i].value.answer+\",\"+url+\"\\r\\n\";\n}\nmsg.headers = {\n    \"Content-type\" : \"text/csv\",\n    'Content-disposition': 'attachment; filename='+fileName\n};\nmsg.payload = csv;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1780,
      "y": 1760,
      "wires": [
        [
          "7598d73f.9d1a08",
          "71da72a2.cb9e1c"
        ]
      ]
    },
    {
      "id": "67886c54.7314c4",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "登録件数セット",
      "func": "//context.global.api11.totalRow = msg.payload.rows.length;\nmsg.payload = msg.payload.rows.length;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1800,
      "y": 1820,
      "wires": [
        [
          "5dad0e47.2a08a"
        ]
      ]
    },
    {
      "id": "acc408db.11fd08",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "Cloudantデータ取得エラー",
      "func": "msg.payload = {\n    \"result\": \"failure\",\n    \"message\": {\n        status: msg.statusCode,\n        action: \"Cloudantデータ取得エラー\"\n    }\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1840,
      "y": 1880,
      "wires": [
        [
          "10100d0d.f6b2e3",
          "ffc3b6f5.459e18"
        ]
      ]
    },
    {
      "id": "424e37e6.5ae228",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "get list[msg.index]",
      "func": "msg.payload = msg.list[msg.index];\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1950,
      "y": 700,
      "wires": [
        [
          "2d302a7c.e52f56",
          "8827dfb3.7c2a4"
        ]
      ]
    },
    {
      "id": "c47dd0d0.090c",
      "type": "http response",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "x": 2350,
      "y": 520,
      "wires": []
    },
    {
      "id": "1086b7b4.a07dc8",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "true",
      "x": 4125.333358764648,
      "y": 1109.6666793823242,
      "wires": []
    },
    {
      "id": "f911123d.e3b9a",
      "type": "bigfile reader",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "filename": "",
      "nopayload": false,
      "flow": "lines",
      "highWaterMark": 16,
      "encoding": "utf8",
      "format": "utf8",
      "keepEmptyLines": false,
      "x": 4052.6666717529297,
      "y": 1180.6666526794434,
      "wires": [
        [
          "ada5a66.423de58"
        ],
        [
          "ada5a66.423de58"
        ]
      ]
    },
    {
      "id": "74075cd.78378a4",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "msg.payload = msg.tmp",
      "func": "msg.payload = msg.tmp;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 3750,
      "y": 1100,
      "wires": [
        [
          "5ba26b5e.021374"
        ]
      ]
    },
    {
      "id": "dd5f0b8e.130a38",
      "type": "switch",
      "z": "f88d33bb.e0bc5",
      "name": "msg.index < msg.list.length",
      "property": "index",
      "propertyType": "msg",
      "rules": [
        {
          "t": "lt",
          "v": "list.length",
          "vt": "msg"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2060,
      "y": 620,
      "wires": [
        [
          "424e37e6.5ae228"
        ],
        [
          "fc50c67.0ac1e38"
        ]
      ]
    },
    {
      "id": "ada5a66.423de58",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "add header",
      "func": "// if (msg.payload) {\n//     context.global.lines++;\n// }\n// if (msg.control && msg.control.state == 'start') {\n//     global.lines = 0;\n// }\nif (msg.control && msg.control.state == 'end') {\n    msg.payload = \"END\";\n    \n} else {\n\n    if (msg.payload) {\n        context.global.api10.lines++;\n    }\n    \n    if (context.global.api10.lines == 1) {\n        context.global.api10.csvheader = msg.payload;\n    } else {\n        var line = msg.payload+\"\";\n        msg.payload = context.global.api10.csvheader+\"\\r\\n\"+line;\n    }\n\n    \n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 4240.000011444092,
      "y": 1184.000005722046,
      "wires": [
        [
          "f44810b7.c5e7b"
        ]
      ]
    },
    {
      "id": "6b46bf1d.46ead",
      "type": "switch",
      "z": "f88d33bb.e0bc5",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3920,
      "y": 620,
      "wires": [
        [
          "74075cd.78378a4"
        ],
        [
          "66d49e1e.a0218",
          "94aba5ce.5266f8",
          "27472c48.d122a4"
        ]
      ]
    },
    {
      "id": "fc50c67.0ac1e38",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "delete count",
      "func": "var total = 0;\nfor (var i=0; i < msg.list.length; i++) {\n    total += msg.list[i].docs.length;\n}\nmsg.payload = {\n    result: \"success\",\n    message: \"delete count: \" + total\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 3710,
      "y": 620,
      "wires": [
        [
          "fc5dc5b3.34dac8",
          "6b46bf1d.46ead"
        ]
      ]
    },
    {
      "id": "6b5e0fa6.4d0f5",
      "type": "http request",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "method": "use",
      "ret": "txt",
      "url": "",
      "tls": "",
      "x": 2250,
      "y": 980,
      "wires": [
        [
          "66dd131b.f450ec"
        ]
      ]
    },
    {
      "id": "f44810b7.c5e7b",
      "type": "switch",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "property": "payload",
      "propertyType": "msg",
      "rules": [
        {
          "t": "neq",
          "v": "END",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "END",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 4401.333351135254,
      "y": 1173.0000047683716,
      "wires": [
        [
          "d8a77958.5059c8"
        ],
        [
          "8824935b.6baff"
        ]
      ]
    },
    {
      "id": "94aba5ce.5266f8",
      "type": "http response",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 4210,
      "y": 600,
      "wires": []
    },
    {
      "id": "fc5dc5b3.34dac8",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "payload",
      "x": 3910,
      "y": 580,
      "wires": []
    },
    {
      "id": "d8a77958.5059c8",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "store",
      "func": "context.global.api10.data[context.global.api10.lines-1]=msg.payload;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 4550,
      "y": 1140,
      "wires": [
        []
      ]
    },
    {
      "id": "8824935b.6baff",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "end",
      "func": "msg.count = 1;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 4550,
      "y": 1200,
      "wires": [
        [
          "e3e33ba7.7bdba8",
          "d453d12e.0e074"
        ]
      ]
    },
    {
      "id": "e3e33ba7.7bdba8",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "new context.global.rows",
      "func": "context.global.api10.rows = [];\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2850,
      "y": 1340,
      "wires": [
        [
          "467da2b4.0c091c"
        ]
      ]
    },
    {
      "id": "d453d12e.0e074",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "get filename",
      "func": "msg.filename = context.global.api10.filename;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 4710,
      "y": 1200,
      "wires": [
        [
          "578a4f41.7bbc6"
        ]
      ]
    },
    {
      "id": "467da2b4.0c091c",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "get data[count]",
      "func": "msg.payload = context.global.api10.data[msg.count];\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2340,
      "y": 1540,
      "wires": [
        [
          "e300c74.3aaa338"
        ]
      ]
    },
    {
      "id": "578a4f41.7bbc6",
      "type": "file",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "filename": "",
      "appendNewline": true,
      "createDir": false,
      "overwriteFile": "delete",
      "x": 4850,
      "y": 1200,
      "wires": []
    },
    {
      "id": "e300c74.3aaa338",
      "type": "csv",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "sep": ",",
      "hdrin": true,
      "hdrout": "",
      "multi": "one",
      "ret": "\\r\\n",
      "temp": "",
      "x": 2510,
      "y": 1540,
      "wires": [
        [
          "bfc0dfc0.35c0b",
          "9d8f585e.6a8358"
        ]
      ]
    },
    {
      "id": "7101aad8.fdb574",
      "type": "delay",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "pauseType": "delay",
      "timeout": "10",
      "timeoutUnits": "milliseconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 2690,
      "y": 1460,
      "wires": [
        [
          "467da2b4.0c091c"
        ]
      ]
    },
    {
      "id": "bfc0dfc0.35c0b",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "set line to array",
      "func": "context.global.api10.rows[msg.count-1] = msg.payload;\n//msg.payload = context.global.rows;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2680,
      "y": 1540,
      "wires": [
        [
          "30cbfc14.8fb6c4"
        ]
      ]
    },
    {
      "id": "9d8f585e.6a8358",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "false",
      "x": 2610,
      "y": 1600,
      "wires": []
    },
    {
      "id": "e62045f7.3c2b28",
      "type": "switch",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "property": "count",
      "propertyType": "msg",
      "rules": [
        {
          "t": "lt",
          "v": "api10.lines",
          "vt": "global"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3050,
      "y": 1540,
      "wires": [
        [
          "7101aad8.fdb574"
        ],
        [
          "f0e0c7e2.0950a8"
        ]
      ]
    },
    {
      "id": "30cbfc14.8fb6c4",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "msg.count + 1",
      "func": "msg.count++;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2880,
      "y": 1540,
      "wires": [
        [
          "e62045f7.3c2b28",
          "846a9d12.e4a5e"
        ]
      ]
    },
    {
      "id": "846a9d12.e4a5e",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "count",
      "x": 2890,
      "y": 1600,
      "wires": []
    },
    {
      "id": "3c66243e.46fcdc",
      "type": "http request",
      "z": "f88d33bb.e0bc5",
      "name": "Max(id)取得要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 3460,
      "y": 1540,
      "wires": [
        [
          "6158a749.b7f5d8"
        ]
      ]
    },
    {
      "id": "6158a749.b7f5d8",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "Max(id)取得",
      "func": "if (msg.payload.rows.length === 0) {\n    msg.maxId = 0;\n} else {\n    msg.maxId = msg.payload.rows[0].value.max;\n}\nmsg.payload = msg.tmp;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3630,
      "y": 1540,
      "wires": [
        [
          "7585cb5d.685644"
        ]
      ]
    },
    {
      "id": "7585cb5d.685644",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "make doc",
      "func": "const PAGE_SIZE = 500;\nvar rowsLength = context.global.api10.rows.length;\nvar rows = context.global.api10.rows;\n\nvar list = [];\nvar pageCount = Math.floor(rowsLength / PAGE_SIZE);\nvar remainder = rowsLength % PAGE_SIZE;\n\nvar currentTimestampMili = context.global.Util.currentTimestampMili();\n\nvar maxId = msg.maxId;\n\nfor (var p=0; p < pageCount; p++) {\n    var docs = [];\n    for (var i=p*PAGE_SIZE; i < p*PAGE_SIZE+PAGE_SIZE; i++) {\n        var id = rows[i].id + \"\";\n        if (id === \"undefined\" || id.trim() === \"\") {\n            //var currentTimestampMili = context.global.commonFunction.currentTimestampMili() + i;\n            \n            //currentTimestampMili += i;\n            //id = currentTimestampMili+\"\";\n            \n            id = ++maxId + \"\";\n        }\n        var record = {\n            \"_id\": id,\n            \"question\": rows[i].question,\n            \"answer\": rows[i].answer,\n            \"id\": id,\n            \"create_date\": context.global.Util.formatTimestamp(currentTimestampMili),\n            \"flag\": 1,\n            \"user\": context.global.api10.user\n            ,\"url\": rows[i].url\n        };\n        docs.push(record);\n    }\n    list[p] = { \"docs\": docs };\n\n}\nif (remainder > 0) {\n    var docs = [];\n    for (var i=pageCount*PAGE_SIZE; i < pageCount*PAGE_SIZE+remainder; i++) {\n        var id = rows[i].id + \"\";\n        if (id === \"undefined\" || id.trim() === \"\") {\n            //var currentTimestampMili = context.global.commonFunction.currentTimestampMili() + i;\n            \n            //currentTimestampMili += i;\n            //id = currentTimestampMili+\"\";\n            \n            id = ++maxId + \"\";\n        }\n        var record = {\n            \"_id\": id,\n            \"question\": rows[i].question,\n            \"answer\": rows[i].answer,\n            \"id\": id,\n            \"create_date\": context.global.Util.formatTimestamp(currentTimestampMili),\n            \"flag\": 1,\n            \"user\": context.global.api10.user\n            ,\"url\": rows[i].url\n        };\n        docs.push(record);\n    }\n    list[pageCount] = { \"docs\": docs }\n}\n\nmsg.list = list;\nmsg.index = 0;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 3780,
      "y": 1540,
      "wires": [
        [
          "b07d00f2.bb6a3",
          "be8f9100.a4aea"
        ]
      ]
    },
    {
      "id": "b07d00f2.bb6a3",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "get list[msg.index]",
      "func": "msg.payload = msg.list[msg.index];\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 3990,
      "y": 1540,
      "wires": [
        [
          "91fced0c.380cd",
          "20d646a5.e7ca6a"
        ]
      ]
    },
    {
      "id": "be8f9100.a4aea",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "list",
      "x": 3820,
      "y": 1620,
      "wires": []
    },
    {
      "id": "91fced0c.380cd",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "msg.index++",
      "func": "msg.index++;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 4186.833442687988,
      "y": 1536.166660308838,
      "wires": [
        [
          "5d4cbfd3.11cf2"
        ]
      ]
    },
    {
      "id": "5d4cbfd3.11cf2",
      "type": "switch",
      "z": "f88d33bb.e0bc5",
      "name": "msg.index < msg.list.length",
      "property": "index",
      "propertyType": "msg",
      "rules": [
        {
          "t": "lt",
          "v": "list.length",
          "vt": "msg"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 4080,
      "y": 1420,
      "wires": [
        [
          "b07d00f2.bb6a3"
        ],
        [
          "c0c5edca.0ec94"
        ]
      ]
    },
    {
      "id": "f6c1a2b4.cb028",
      "type": "http request",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "method": "use",
      "ret": "txt",
      "url": "",
      "tls": "",
      "x": 4411.250045776367,
      "y": 1584.023733139038,
      "wires": [
        [
          "aa4e7d3b.24ec4",
          "e55143fa.64ee6"
        ]
      ]
    },
    {
      "id": "c0c5edca.0ec94",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "insert count",
      "func": "var total = 0;\nfor (var i=0; i < msg.list.length; i++) {\n    total += msg.list[i].docs.length;\n}\nmsg.payload = {\n    \"insert count\": total\n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 4371.250045776367,
      "y": 1424.023733139038,
      "wires": [
        [
          "9d3cf0c2.dff69",
          "e6a8c361.8d155",
          "5b152748.fecec8"
        ]
      ]
    },
    {
      "id": "aa4e7d3b.24ec4",
      "type": "switch",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "201",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 4567.49991607666,
      "y": 1583.3570404052734,
      "wires": [
        [],
        [
          "6ee8fac2.e7eee4",
          "c2225e1.e895aa"
        ]
      ]
    },
    {
      "id": "e55143fa.64ee6",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "false",
      "x": 4551.250045776367,
      "y": 1624.023733139038,
      "wires": []
    },
    {
      "id": "9d3cf0c2.dff69",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "payload",
      "x": 4571.250045776367,
      "y": 1464.023733139038,
      "wires": []
    },
    {
      "id": "6ee8fac2.e7eee4",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "true",
      "x": 4711.250045776367,
      "y": 1564.023733139038,
      "wires": []
    },
    {
      "id": "a01801b7.b2259",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "メソッド設定",
      "rules": [
        {
          "t": "set",
          "p": "common.method",
          "pt": "msg",
          "to": "req.method",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 400,
      "y": 500,
      "wires": [
        [
          "4c67b1d4.1d5d6"
        ]
      ]
    },
    {
      "id": "5dad0e47.2a08a",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "false",
      "x": 2070,
      "y": 1820,
      "wires": []
    },
    {
      "id": "66dd131b.f450ec",
      "type": "switch",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "201",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2410,
      "y": 980,
      "wires": [
        [],
        [
          "b587ff53.883f5",
          "eddbf3e9.d06e9"
        ]
      ]
    },
    {
      "id": "b587ff53.883f5",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "true",
      "x": 2550,
      "y": 960,
      "wires": []
    },
    {
      "id": "2e122619.d37aaa",
      "type": "http in",
      "z": "f88d33bb.e0bc5",
      "name": "インポート要求",
      "url": "/api/v1/faqdoc/import",
      "method": "post",
      "upload": true,
      "swaggerDoc": "",
      "x": 160,
      "y": 320,
      "wires": [
        [
          "a01801b7.b2259",
          "a30194e0.373168"
        ]
      ]
    },
    {
      "id": "203a9141.03e94e",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "ファイルパス設定",
      "func": "msg.filename = '/tmp/' + msg.req.files[0].originalname;\n\nmsg.tmp = msg.payload;\n\nmsg.payload = msg.req.files[0].buffer;\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1110,
      "y": 500,
      "wires": [
        [
          "4b671cdf.755514",
          "aca00ef9.062fd"
        ]
      ]
    },
    {
      "id": "4b671cdf.755514",
      "type": "file",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "filename": "",
      "appendNewline": false,
      "createDir": false,
      "overwriteFile": "true",
      "x": 1290,
      "y": 400,
      "wires": []
    },
    {
      "id": "aca00ef9.062fd",
      "type": "delay",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "pauseType": "delay",
      "timeout": "1",
      "timeoutUnits": "seconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 1300,
      "y": 500,
      "wires": [
        [
          "68f6ab16.30c384"
        ]
      ]
    },
    {
      "id": "e6a8c361.8d155",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "rules": [
        {
          "t": "delete",
          "p": "api10",
          "pt": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4591.250045776367,
      "y": 1424.023733139038,
      "wires": [
        []
      ]
    },
    {
      "id": "f3ac0197.7e4ad",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "共通パラメータチェック",
      "func": "/*\nvar errorFlag = true;\n\nif (errorFlag) {\n    //CHECK APIKEY\n    errorFlag = context.global.commonFunction.checkAPIKey();\n    // errorFlag = context.global.commonFunction.checkAPIKey(msg, context);\n}\n\nif (errorFlag) {\n    //CHECK USER\n    errorFlag = context.global.commonFunction.checkUser();\n    // errorFlag = context.global.commonFunction.checkUser(msg, context);\n}\n*/\n\ncontext.global.Util.checkAPIKeyAndUser(msg);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 690,
      "y": 640,
      "wires": [
        [
          "e6732fa7.1ca86"
        ]
      ]
    },
    {
      "id": "370f3062.5fa4a",
      "type": "http in",
      "z": "f06e3ca3.ed0a6",
      "name": "テーブルドロップ要求",
      "url": "/api/v1/fbdoc/drop",
      "method": "delete",
      "upload": false,
      "swaggerDoc": "",
      "x": 120,
      "y": 1240,
      "wires": [
        [
          "fda51265.e475d",
          "78837882.1e93e8"
        ]
      ]
    },
    {
      "id": "d84b76b.87d5488",
      "type": "http in",
      "z": "f06e3ca3.ed0a6",
      "name": "エクスポート要求",
      "url": "/api/v1/fbdoc/export",
      "method": "get",
      "upload": false,
      "swaggerDoc": "",
      "x": 110,
      "y": 640,
      "wires": [
        [
          "fda51265.e475d",
          "488742e1.4f21ac"
        ]
      ]
    },
    {
      "id": "e6732fa7.1ca86",
      "type": "switch",
      "z": "f06e3ca3.ed0a6",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "ERROR",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "GET",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "DELETE",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 4,
      "x": 900,
      "y": 640,
      "wires": [
        [
          "691c85bd.ff90cc"
        ],
        [
          "797eb27.824694c"
        ],
        [
          "3904b550.07eb4a"
        ],
        [
          "c1483235.8ab3e",
          "c5d2daf0.2c8d68"
        ]
      ]
    },
    {
      "id": "691c85bd.ff90cc",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "共通パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: msg.common.errorMessage };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1190,
      "y": 80,
      "wires": [
        [
          "1bcf9f13.e06211",
          "236461a9.7cfa1e"
        ]
      ]
    },
    {
      "id": "7bf9ad9c.ccbe04",
      "type": "http response",
      "z": "f06e3ca3.ed0a6",
      "name": "応答",
      "statusCode": "",
      "headers": {},
      "x": 2810,
      "y": 1020,
      "wires": []
    },
    {
      "id": "5eab667f.2ea568",
      "type": "file in",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "filename": "",
      "format": "utf8",
      "x": 1470,
      "y": 220,
      "wires": [
        [
          "a94d6c8f.aec9b"
        ]
      ]
    },
    {
      "id": "aa97da73.c3b8b8",
      "type": "http request",
      "z": "f06e3ca3.ed0a6",
      "name": "Cloudantデータ取得要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1470,
      "y": 1600,
      "wires": [
        [
          "e5cbd562.4ce1a8",
          "446e8ff0.42542"
        ]
      ]
    },
    {
      "id": "a1db30b1.92eb2",
      "type": "http request",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1350,
      "y": 660,
      "wires": [
        [
          "658859ee.ca4098",
          "a29c6a1c.4df398"
        ]
      ]
    },
    {
      "id": "7a96e6fe.db7408",
      "type": "switch",
      "z": "f06e3ca3.ed0a6",
      "name": "CSVヘッダーチェック",
      "property": "headerLine",
      "propertyType": "msg",
      "rules": [
        {
          "t": "regex",
          "v": "^\\s*question\\s*,\\s*answerid\\s*,\\s*relevance\\s*$",
          "vt": "str",
          "case": false
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1860,
      "y": 220,
      "wires": [
        [
          "c1483235.8ab3e",
          "d1a123ac.d3c91"
        ],
        [
          "8316d2c9.2e111"
        ]
      ]
    },
    {
      "id": "79349cb4.ae0314",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "作成応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.originalfilename+\" uploaded.\"\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2600,
      "y": 1020,
      "wires": [
        [
          "7bf9ad9c.ccbe04",
          "a63b4cd.1709cb"
        ]
      ]
    },
    {
      "id": "a94d6c8f.aec9b",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "ヘッダー行切出し",
      "func": "var content = msg.payload+\"\";\nmsg.headerLine = content.substring(0, content.indexOf('\\r\\n'));\n\nmsg.payload = msg.tmp;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1630,
      "y": 220,
      "wires": [
        [
          "9202c0e.cc2924",
          "7a96e6fe.db7408"
        ]
      ]
    },
    {
      "id": "e5cbd562.4ce1a8",
      "type": "switch",
      "z": "f06e3ca3.ed0a6",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "200",
          "vt": "str"
        },
        {
          "t": "neq",
          "v": "200",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1690,
      "y": 1600,
      "wires": [
        [
          "41d686ea.f1f698",
          "e52046b5.806f98"
        ],
        [
          "d7f73a95.eab338"
        ]
      ]
    },
    {
      "id": "446e8ff0.42542",
      "type": "debug",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "true",
      "x": 1670,
      "y": 1660,
      "wires": []
    },
    {
      "id": "658859ee.ca4098",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "make doc",
      "func": "const PAGE_SIZE = 10000;\nvar rowsLength = msg.payload.rows.length;\nvar rows = msg.payload.rows;\n\nvar list = [];\nvar pageCount = Math.floor(rowsLength / PAGE_SIZE);\nvar remainder = rowsLength % PAGE_SIZE;\n\nfor (var p=0; p < pageCount; p++) {\n    var docs = [];\n    for (var i=p*PAGE_SIZE; i < p*PAGE_SIZE+PAGE_SIZE; i++) {\n        if (rows[i].doc.user) {\n            var id = rows[i].id;\n            var rev = rows[i].value.rev;\n            var record = {\n                \"_id\": id,\n                \"_rev\": rev,\n                \"_deleted\": true\n            };\n            docs.push(record);\n        }\n    }\n    list[p] = { \"docs\": docs };\n\n}\nif (remainder > 0) {\n    var docs = [];\n    for (var i=pageCount*PAGE_SIZE; i < pageCount*PAGE_SIZE+remainder; i++) {\n        if (rows[i].doc.user) {\n            var id = rows[i].id;\n            var rev = rows[i].value.rev;\n            var record = {\n                \"_id\": id,\n                \"_rev\": rev,\n                \"_deleted\": true\n            };\n            docs.push(record);\n        }\n    }\n    list[pageCount] = { \"docs\": docs }\n}\n\nmsg.list = list;\nmsg.index = 0;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1540,
      "y": 660,
      "wires": [
        [
          "4896b413.576b4c",
          "7ff99ebb.a4df"
        ]
      ]
    },
    {
      "id": "8316d2c9.2e111",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "アップロードエラー応答",
      "func": "msg.payload={\n    result: \"failure\",\n    message: \"unknown csv header \"\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2130,
      "y": 220,
      "wires": [
        [
          "66df7a55.44d444",
          "add1b6ca.621e08"
        ]
      ]
    },
    {
      "id": "45b7c531.9ab45c",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "select file",
      "func": "var originalfilename = msg.req.files[0].originalname;\nmsg.originalfilename = originalfilename;\n\ncontext.global.api19 = {};\ncontext.global.api19.filename = msg.filename;\ncontext.global.api19.user = msg.payload.user;\n\ncontext.global.api19.lines = 0;\ncontext.global.api19.data = [];\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2440,
      "y": 1100,
      "wires": [
        [
          "79349cb4.ae0314",
          "c0a58b3f.574cc8"
        ]
      ]
    },
    {
      "id": "9202c0e.cc2924",
      "type": "debug",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "headerLine",
      "x": 1820,
      "y": 140,
      "wires": []
    },
    {
      "id": "41d686ea.f1f698",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "CSV作成",
      "func": "var currentTimestampMili = context.global.Util.currentTimestampMili();\nvar prefix = context.global.Const.EXPORT_FILE_FB;\nvar fileName = context.global.Util.getDownloadFileName(prefix, currentTimestampMili);\nvar csv = \"question,answerid,relevance\\r\\n\";\nfor (i=0; i < msg.payload.rows.length; i++) {\n    csv += msg.payload.rows[i].value.question+\",\"+msg.payload.rows[i].value.answerid+\",\"+msg.payload.rows[i].value.relevance+\"\\r\\n\";\n}\nmsg.headers = {\n    \"Content-type\" : \"text/csv\",\n    'Content-disposition': 'attachment; filename='+fileName\n};\nmsg.payload = csv;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1900,
      "y": 1540,
      "wires": [
        [
          "3fbed0f3.81e7d",
          "a7bd2a13.697ae8"
        ]
      ]
    },
    {
      "id": "e52046b5.806f98",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "登録件数セット",
      "func": "//context.global.totalRow = msg.payload.rows.length;\nmsg.payload = msg.payload.rows.length;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1920,
      "y": 1600,
      "wires": [
        []
      ]
    },
    {
      "id": "d7f73a95.eab338",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "Cloudantデータ取得エラー",
      "func": "msg.payload = {\n    \"result\": \"failure\",\n    \"message\": {\n        status: msg.statusCode,\n        action: \"Cloudantデータ取得エラー\"\n    }\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1960,
      "y": 1660,
      "wires": [
        [
          "81fa60dc.e1954",
          "bbc44784.11ee18"
        ]
      ]
    },
    {
      "id": "4896b413.576b4c",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "get list[msg.index]",
      "func": "msg.payload = msg.list[msg.index];\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1853.095199584961,
      "y": 666.1189272403717,
      "wires": [
        [
          "a5775f69.11c1",
          "12b73f8a.6c299",
          "631cdb6a.4caa14"
        ]
      ]
    },
    {
      "id": "66df7a55.44d444",
      "type": "http response",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "x": 2350,
      "y": 220,
      "wires": []
    },
    {
      "id": "c0a58b3f.574cc8",
      "type": "bigfile reader",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "filename": "",
      "nopayload": false,
      "flow": "lines",
      "highWaterMark": 16,
      "encoding": "utf8",
      "format": "utf8",
      "keepEmptyLines": false,
      "x": 2600,
      "y": 1100,
      "wires": [
        [
          "173b6e8.ea29092"
        ],
        [
          "173b6e8.ea29092"
        ]
      ]
    },
    {
      "id": "8b2b9e9f.2abd5",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "msg.payload = msg.tmp",
      "func": "msg.payload = msg.tmp;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2230,
      "y": 1100,
      "wires": [
        [
          "45b7c531.9ab45c"
        ]
      ]
    },
    {
      "id": "3fbed0f3.81e7d",
      "type": "http response",
      "z": "f06e3ca3.ed0a6",
      "name": "応答",
      "x": 2190,
      "y": 1540,
      "wires": []
    },
    {
      "id": "a5775f69.11c1",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "msg.index++",
      "func": "msg.index++;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2050,
      "y": 660,
      "wires": [
        [
          "97edda89.83b698"
        ]
      ]
    },
    {
      "id": "12b73f8a.6c299",
      "type": "debug",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "false",
      "x": 1978.452350616455,
      "y": 797.9046268463135,
      "wires": []
    },
    {
      "id": "97edda89.83b698",
      "type": "switch",
      "z": "f06e3ca3.ed0a6",
      "name": "msg.index < msg.list.length",
      "property": "index",
      "propertyType": "msg",
      "rules": [
        {
          "t": "lt",
          "v": "list.length",
          "vt": "msg"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1963.0952072143555,
      "y": 559.8689255714417,
      "wires": [
        [
          "4896b413.576b4c"
        ],
        [
          "808aba4d.98e688"
        ]
      ]
    },
    {
      "id": "173b6e8.ea29092",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "add header",
      "func": "// if (msg.payload) {\n//     context.global.lines++;\n// }\n// if (msg.control && msg.control.state == 'start') {\n//     global.lines = 0;\n// }\nif (msg.control && msg.control.state == 'end') {\n    msg.payload = \"END\";\n    \n} else {\n\n    if (msg.payload) {\n        context.global.api19.lines++;\n    }\n    \n    if (context.global.api19.lines == 1) {\n        context.global.api19.csvheader = msg.payload;\n    } else {\n        var line = msg.payload+\"\";\n        msg.payload = context.global.api19.csvheader+\"\\r\\n\"+line;\n    }\n\n    \n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2770,
      "y": 1100,
      "wires": [
        [
          "1a0d598a.f28136"
        ]
      ]
    },
    {
      "id": "d79eeac.328a518",
      "type": "switch",
      "z": "f06e3ca3.ed0a6",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2480,
      "y": 560,
      "wires": [
        [
          "8b2b9e9f.2abd5"
        ],
        [
          "d6ceed8b.da21f",
          "274910b1.3d2d5",
          "26439ae0.e0d0c6"
        ]
      ]
    },
    {
      "id": "a3a7e749.8d3e98",
      "type": "http request",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "method": "use",
      "ret": "txt",
      "url": "",
      "tls": "",
      "x": 2230,
      "y": 720,
      "wires": [
        [
          "984db98c.4a04c8"
        ]
      ]
    },
    {
      "id": "808aba4d.98e688",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "delete count",
      "func": "var total = 0;\nfor (var i=0; i < msg.list.length; i++) {\n    total += msg.list[i].docs.length;\n}\nmsg.payload = {\n    result: \"success\",\n    message: \"delete count: \" + total\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2284.3451919555664,
      "y": 566.1189866065979,
      "wires": [
        [
          "57e583b9.44948c",
          "d79eeac.328a518",
          "f6e2c3c4.607dc"
        ]
      ]
    },
    {
      "id": "1a0d598a.f28136",
      "type": "switch",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "property": "payload",
      "propertyType": "msg",
      "rules": [
        {
          "t": "neq",
          "v": "END",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "END",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2930,
      "y": 1100,
      "wires": [
        [
          "84e611ed.1864b"
        ],
        [
          "be4e4b8.31caab8"
        ]
      ]
    },
    {
      "id": "d6ceed8b.da21f",
      "type": "http response",
      "z": "f06e3ca3.ed0a6",
      "name": "テーブルドロップ応答",
      "x": 2740,
      "y": 580,
      "wires": []
    },
    {
      "id": "57e583b9.44948c",
      "type": "debug",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "payload",
      "x": 2361.7857971191406,
      "y": 650.7617058753967,
      "wires": []
    },
    {
      "id": "84e611ed.1864b",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "store",
      "func": "context.global.api19.data[context.global.api19.lines-1]=msg.payload;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 3068.1905632019043,
      "y": 1064.0833578109741,
      "wires": [
        []
      ]
    },
    {
      "id": "be4e4b8.31caab8",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "end",
      "func": "msg.count = 1;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 3070.083339691162,
      "y": 1107.5833129882812,
      "wires": [
        [
          "6c4889e5.7b5fa8",
          "8fc1815a.4e345"
        ]
      ]
    },
    {
      "id": "6c4889e5.7b5fa8",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "get filename",
      "func": "msg.filename = context.global.api19.filename;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3230,
      "y": 1100,
      "wires": [
        [
          "49902238.33995c"
        ]
      ]
    },
    {
      "id": "8fc1815a.4e345",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "new context.global.rows",
      "func": "context.global.api19.rows = [];\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3270,
      "y": 1140,
      "wires": [
        [
          "396c7f01.f5e1f"
        ]
      ]
    },
    {
      "id": "49902238.33995c",
      "type": "file",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "filename": "",
      "appendNewline": true,
      "createDir": false,
      "overwriteFile": "delete",
      "x": 3390,
      "y": 1100,
      "wires": []
    },
    {
      "id": "396c7f01.f5e1f",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "get data[count]",
      "func": "msg.payload = context.global.api19.data[msg.count];\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3540,
      "y": 1140,
      "wires": [
        [
          "96668449.6a5be8"
        ]
      ]
    },
    {
      "id": "96668449.6a5be8",
      "type": "csv",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "sep": ",",
      "hdrin": true,
      "hdrout": "",
      "multi": "one",
      "ret": "\\r\\n",
      "temp": "",
      "x": 3710,
      "y": 1140,
      "wires": [
        [
          "4f1dac8a.d626c4"
        ]
      ]
    },
    {
      "id": "104dc8d8.bc6fb7",
      "type": "delay",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "pauseType": "delay",
      "timeout": "10",
      "timeoutUnits": "milliseconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 3710,
      "y": 1340,
      "wires": [
        [
          "396c7f01.f5e1f"
        ]
      ]
    },
    {
      "id": "4f1dac8a.d626c4",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "FB_DOC作成処理",
      "func": "var currentTimestampMili = context.global.Util.currentTimestampMili();\n\nvar answer = [];\nvar flag;\nif (msg.payload.relevance) {\n    answer[0] = { id: msg.payload.answerid, relevance: msg.payload.relevance };\n    flag = 1;\n    \n} else if (msg.payload.relevance === 0) {\n    //Not Relevance(0)への対応\n    answer[0] = { id: msg.payload.answerid, relevance: 0 };\n    flag = 1;\n    \n} else {\n    answer[0] = { id: msg.payload.answerid, relevance: \"\" };\n    flag = 99;\n    \n}\n\nmsg.payload = {\n    _id : currentTimestampMili+\"\",\n    id : currentTimestampMili+\"\",\n    question : msg.payload.question,\n    answer : answer,\n    create_date : context.global.Util.formatTimestamp(currentTimestampMili),\n    flag : flag,\n    user : context.global.api19.user\n};\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 3891.190444946289,
      "y": 1142.1190185546875,
      "wires": [
        [
          "581a53f4.f4585c"
        ]
      ]
    },
    {
      "id": "9fb53948.b0faf8",
      "type": "switch",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "property": "count",
      "propertyType": "msg",
      "rules": [
        {
          "t": "lt",
          "v": "api19.lines",
          "vt": "global"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3530,
      "y": 1340,
      "wires": [
        [
          "104dc8d8.bc6fb7"
        ],
        [
          "b4e3174.24e7de8"
        ]
      ]
    },
    {
      "id": "581a53f4.f4585c",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "set line to array",
      "func": "context.global.api19.rows[msg.count-1] = msg.payload;\n//msg.payload = context.global.rows;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 4100,
      "y": 1140,
      "wires": [
        [
          "1a58654c.cf938b"
        ]
      ]
    },
    {
      "id": "b4e3174.24e7de8",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "make doc",
      "func": "const PAGE_SIZE = 500;\nvar rowsLength = context.global.api19.rows.length;\nvar rows = context.global.api19.rows;\n\nvar list = [];\nvar pageCount = Math.floor(rowsLength / PAGE_SIZE);\nvar remainder = rowsLength % PAGE_SIZE;\n\nfor (var p=0; p < pageCount; p++) {\n    var docs = [];\n    for (var i=p*PAGE_SIZE; i < p*PAGE_SIZE+PAGE_SIZE; i++) {\n        // var currentTimestampMili = context.global.commonFunction.currentTimestampMili() + i;\n\n        // var id = currentTimestampMili+\"\";\n        // var record = {\n        //     \"_id\": id,\n        //     \"title\": rows[i].title,\n        //     \"body\": rows[i].body,\n        //     \"id\": id,\n        //     \"create_date\": context.global.commonFunction.formatTimestamp(currentTimestampMili),\n        //     \"flag\": 1,\n        //     \"user\": context.global.user\n        // };\n        // docs.push(record);\n        docs.push(rows[i]);\n    }\n    list[p] = { \"docs\": docs };\n\n}\nif (remainder > 0) {\n    var docs = [];\n    for (var i=pageCount*PAGE_SIZE; i < pageCount*PAGE_SIZE+remainder; i++) {\n        // var currentTimestampMili = context.global.commonFunction.currentTimestampMili() + i;\n\n        // var id = currentTimestampMili+\"\";\n        // var record = {\n        //     \"_id\": id,\n        //     \"title\": rows[i].title,\n        //     \"body\": rows[i].body,\n        //     \"id\": id,\n        //     \"create_date\": context.global.commonFunction.formatTimestamp(currentTimestampMili),\n        //     \"flag\": 1,\n        //     \"user\": context.global.user\n        // };\n        // docs.push(record);\n        docs.push(rows[i]);\n    }\n    list[pageCount] = { \"docs\": docs }\n}\n\nmsg.list = list;\nmsg.index = 0;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 3700,
      "y": 1400,
      "wires": [
        [
          "a58ee0e.1b36d2",
          "4ed31347.15d06c"
        ]
      ]
    },
    {
      "id": "1a58654c.cf938b",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "msg.count + 1",
      "func": "msg.count++;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 4300,
      "y": 1140,
      "wires": [
        [
          "9fb53948.b0faf8",
          "2ee599af.429056"
        ]
      ]
    },
    {
      "id": "a58ee0e.1b36d2",
      "type": "debug",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "list",
      "x": 3820,
      "y": 1460,
      "wires": []
    },
    {
      "id": "4ed31347.15d06c",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "get list[msg.index]",
      "func": "msg.payload = msg.list[msg.index];\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 3950,
      "y": 1400,
      "wires": [
        [
          "c1392d3e.8493a",
          "59ea80a.825818"
        ]
      ]
    },
    {
      "id": "2ee599af.429056",
      "type": "debug",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "count",
      "x": 4550,
      "y": 1140,
      "wires": []
    },
    {
      "id": "c1392d3e.8493a",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "msg.index++",
      "func": "msg.index++;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 4150,
      "y": 1400,
      "wires": [
        [
          "3852b0f3.bf019"
        ]
      ]
    },
    {
      "id": "3852b0f3.bf019",
      "type": "switch",
      "z": "f06e3ca3.ed0a6",
      "name": "msg.index < msg.list.length",
      "property": "index",
      "propertyType": "msg",
      "rules": [
        {
          "t": "lt",
          "v": "list.length",
          "vt": "msg"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 4060,
      "y": 1300,
      "wires": [
        [
          "4ed31347.15d06c"
        ],
        [
          "efca5014.3434c"
        ]
      ]
    },
    {
      "id": "12bb139b.e19bac",
      "type": "http request",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "method": "use",
      "ret": "txt",
      "url": "",
      "tls": "",
      "x": 4350,
      "y": 1460,
      "wires": [
        [
          "7c3eb340.15793c"
        ]
      ]
    },
    {
      "id": "efca5014.3434c",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "insert count",
      "func": "var total = 0;\nfor (var i=0; i < msg.list.length; i++) {\n    total += msg.list[i].docs.length;\n}\nmsg.payload = {\n    \"insert count\": total\n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 4350,
      "y": 1300,
      "wires": [
        [
          "b4193bd8.1bf458",
          "10bcbdd5.84acd2",
          "eac1b8a9.46bbe8"
        ]
      ]
    },
    {
      "id": "7c3eb340.15793c",
      "type": "switch",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "201",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 4509.345363616943,
      "y": 1454.5595474243164,
      "wires": [
        [],
        [
          "596e2805.dcb8e8",
          "a70013f2.e5b3c"
        ]
      ]
    },
    {
      "id": "b4193bd8.1bf458",
      "type": "debug",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "payload",
      "x": 4590,
      "y": 1340,
      "wires": []
    },
    {
      "id": "596e2805.dcb8e8",
      "type": "debug",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "true",
      "x": 4670,
      "y": 1500,
      "wires": []
    },
    {
      "id": "91b5cd52.4d932",
      "type": "http in",
      "z": "f06e3ca3.ed0a6",
      "name": "インポート要求",
      "url": "/api/v1/fbdoc/import",
      "method": "post",
      "upload": true,
      "swaggerDoc": "",
      "x": 111.42853927612305,
      "y": 81.85714149475098,
      "wires": [
        [
          "fda51265.e475d",
          "9b9a3187.d209a"
        ]
      ]
    },
    {
      "id": "fda51265.e475d",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "メソッド設定",
      "rules": [
        {
          "t": "set",
          "p": "common.method",
          "pt": "msg",
          "to": "req.method",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 480,
      "y": 640,
      "wires": [
        [
          "f3ac0197.7e4ad"
        ]
      ]
    },
    {
      "id": "797eb27.824694c",
      "type": "function",
      "z": "f06e3ca3.ed0a6",
      "name": "ファイルパス設定",
      "func": "msg.filename = '/tmp/' + msg.req.files[0].originalname;\n\nmsg.tmp = msg.payload;\n\nmsg.payload = msg.req.files[0].buffer;\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1150,
      "y": 220,
      "wires": [
        [
          "ce3a88ea.64ce38",
          "c7344dff.da929"
        ]
      ]
    },
    {
      "id": "ce3a88ea.64ce38",
      "type": "file",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "filename": "",
      "appendNewline": false,
      "createDir": false,
      "overwriteFile": "true",
      "x": 1330,
      "y": 180,
      "wires": []
    },
    {
      "id": "c7344dff.da929",
      "type": "delay",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "pauseType": "delay",
      "timeout": "1",
      "timeoutUnits": "seconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 1340,
      "y": 220,
      "wires": [
        [
          "5eab667f.2ea568"
        ]
      ]
    },
    {
      "id": "a29c6a1c.4df398",
      "type": "debug",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "true",
      "x": 1510,
      "y": 720,
      "wires": []
    },
    {
      "id": "10bcbdd5.84acd2",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "rules": [
        {
          "t": "delete",
          "p": "api19",
          "pt": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4610,
      "y": 1300,
      "wires": [
        []
      ]
    },
    {
      "id": "984db98c.4a04c8",
      "type": "switch",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "201",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2386.3095626831055,
      "y": 725.9045944213867,
      "wires": [
        [],
        [
          "16e36377.1b288d",
          "a450c620.c49ca8"
        ]
      ]
    },
    {
      "id": "16e36377.1b288d",
      "type": "debug",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "true",
      "x": 2470,
      "y": 800,
      "wires": []
    },
    {
      "id": "7ff99ebb.a4df",
      "type": "debug",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "true",
      "x": 1713.4523544311523,
      "y": 728.7618217468262,
      "wires": []
    },
    {
      "id": "f0e0c7e2.0950a8",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "VIEW_FAQ_MAXID",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.VIEW_FAQ_MAXID",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "tmp",
          "pt": "msg",
          "to": "payload",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 3260,
      "y": 1540,
      "wires": [
        [
          "3c66243e.46fcdc"
        ]
      ]
    },
    {
      "id": "2d302a7c.e52f56",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "BULK_DOC_FAQ",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "POST",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.BULK_DOC_FAQ",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2065.416530609131,
      "y": 980.2380523681641,
      "wires": [
        [
          "6b5e0fa6.4d0f5"
        ]
      ]
    },
    {
      "id": "20d646a5.e7ca6a",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "BULK_DOC_FAQ",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "POST",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.BULK_DOC_FAQ",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4211.250045776367,
      "y": 1584.023733139038,
      "wires": [
        [
          "f6c1a2b4.cb028"
        ]
      ]
    },
    {
      "id": "59ea80a.825818",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "BULK_DOC_FB",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "POST",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.BULK_DOC_FB",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4159.345363616943,
      "y": 1454.5595474243164,
      "wires": [
        [
          "12bb139b.e19bac"
        ]
      ]
    },
    {
      "id": "631cdb6a.4caa14",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "BULK_DOC_FB",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "POST",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.BULK_DOC_FB",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2060,
      "y": 720,
      "wires": [
        [
          "a3a7e749.8d3e98"
        ]
      ]
    },
    {
      "id": "6d20047e.7908bc",
      "type": "comment",
      "z": "f88d33bb.e0bc5",
      "name": "user項目のあるデータのみ",
      "info": "",
      "x": 1691.4286346435547,
      "y": 677.1429012417793,
      "wires": []
    },
    {
      "id": "748fbb9c.241914",
      "type": "comment",
      "z": "f06e3ca3.ed0a6",
      "name": "user項目のあるデータのみ",
      "info": "",
      "x": 1592.023811340332,
      "y": 625.9046649932861,
      "wires": []
    },
    {
      "id": "35ef7220.152a2e",
      "type": "http in",
      "z": "e4d10f14.d558b",
      "name": "取得要求",
      "url": "/api/v1/faqdoc",
      "method": "get",
      "upload": false,
      "swaggerDoc": "",
      "x": 200,
      "y": 260,
      "wires": [
        [
          "e8cecfa7.3c74d",
          "101ed69b.f4e069"
        ]
      ]
    },
    {
      "id": "e8cecfa7.3c74d",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "メソッド設定",
      "func": "msg.common = {\n    method: msg.req.method\n}\n\nif (msg.req.path === \"/api/v1/faqdoc/dsc\") {\n    msg.common.method = \"RaR_POST\";\n}\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 800,
      "y": 1040,
      "wires": [
        [
          "1b1c390e.dfce37"
        ]
      ]
    },
    {
      "id": "6c3c037e.2d9d6c",
      "type": "http in",
      "z": "e4d10f14.d558b",
      "name": "作成要求",
      "url": "/api/v1/faqdoc",
      "method": "post",
      "upload": false,
      "swaggerDoc": "",
      "x": 200,
      "y": 680,
      "wires": [
        [
          "e8cecfa7.3c74d",
          "a2c0d992.e68c38"
        ]
      ]
    },
    {
      "id": "1b1c390e.dfce37",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "共通パラメータチェック",
      "func": "/*\nvar errorFlag = true;\n\nif (errorFlag) {\n    //CHECK APIKEY\n    errorFlag = context.global.commonFunction.checkAPIKey();\n}\n\nif (errorFlag) {\n    //CHECK USER\n    errorFlag = context.global.commonFunction.checkUser();\n}\n*/\n\ncontext.global.Util.checkAPIKeyAndUser(msg);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1010,
      "y": 1040,
      "wires": [
        [
          "fdc85477.5ec068"
        ]
      ]
    },
    {
      "id": "403622dc.e7f33c",
      "type": "http in",
      "z": "e4d10f14.d558b",
      "name": "変更要求",
      "url": "/api/v1/faqdoc",
      "method": "put",
      "upload": false,
      "swaggerDoc": "",
      "x": 200,
      "y": 1020,
      "wires": [
        [
          "e8cecfa7.3c74d",
          "28459b8e.c14014"
        ]
      ]
    },
    {
      "id": "a85c90ea.d335c",
      "type": "http in",
      "z": "e4d10f14.d558b",
      "name": "削除要求",
      "url": "/api/v1/faqdoc",
      "method": "delete",
      "upload": false,
      "swaggerDoc": "",
      "x": 200,
      "y": 1320,
      "wires": [
        [
          "e8cecfa7.3c74d",
          "921daa51.16b6e8"
        ]
      ]
    },
    {
      "id": "25887f76.98b5d",
      "type": "http in",
      "z": "e4d10f14.d558b",
      "name": "DSC追加要求",
      "url": "/api/v1/faqdoc/dsc",
      "method": "post",
      "upload": false,
      "swaggerDoc": "",
      "x": 210,
      "y": 1600,
      "wires": [
        [
          "e8cecfa7.3c74d",
          "c3fde260.32ad2"
        ]
      ]
    },
    {
      "id": "fdc85477.5ec068",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "ERROR",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "GET",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "PUT",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "DELETE",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "RaR_POST",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 6,
      "x": 1220,
      "y": 1040,
      "wires": [
        [
          "395e9c57.caeb44"
        ],
        [
          "37a01bd6.4055d4"
        ],
        [
          "7ddc493b.6ee4f8"
        ],
        [
          "ce041ce1.19eab"
        ],
        [
          "42ac456e.43094c"
        ],
        [
          "83db1020.a4aad",
          "2c9351af.6b0a4e"
        ]
      ]
    },
    {
      "id": "395e9c57.caeb44",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "共通パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: msg.common.errorMessage };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1550,
      "y": 140,
      "wires": [
        [
          "814402ec.c19b6",
          "662cc340.f102ec"
        ]
      ]
    },
    {
      "id": "7ddc493b.6ee4f8",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "取得処理",
      "func": "if (msg.payload.id) {\n    msg.condition=\"key\";\n    msg.payload = {\n        \"_id\": msg.payload.id\n    };\n\n} else if (msg.payload.question || msg.payload.answer) {\n    \n    var flag = false;\n    var query = \"\";\n    if (msg.payload.question) {\n        query = \"question: \"+msg.payload.question;\n        flag = true;\n    }\n    if (msg.payload.answer) {\n        if (flag === true) {\n            // query = query + \" AND \";\n            query = query + \" OR \";\n        }\n        query = query + \"answer: \"+msg.payload.answer;\n    }\n    msg.payload = {\n        \"query\": query,\n        \"limit\": 100\n    };\n\n} else {\n    msg.condition=\"all\";\n    msg.limit=msg.payload.limit;\n    msg.skip=msg.payload.skip;\n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1500,
      "y": 420,
      "wires": [
        [
          "267dcebf.c4e192"
        ]
      ]
    },
    {
      "id": "ce041ce1.19eab",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "変更処理",
      "func": "msg.url = context.global.Apis.Cloudant.DOC_FAQ\nmsg.url += '/' + msg.payload.id;\n\nmsg.tmp = msg.payload;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1500,
      "y": 640,
      "wires": [
        [
          "9b89c73b.1bc028"
        ]
      ]
    },
    {
      "id": "42ac456e.43094c",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "削除処理",
      "func": "msg.url = context.global.Apis.Cloudant.DOC_FAQ\nmsg.url += '/' + msg.payload.id;\n\nmsg.tmp = msg.payload;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1500,
      "y": 940,
      "wires": [
        [
          "e28af0af.e7c77"
        ]
      ]
    },
    {
      "id": "64eb771e.f9afd8",
      "type": "http response",
      "z": "e4d10f14.d558b",
      "name": "応答",
      "x": 2590,
      "y": 1760,
      "wires": []
    },
    {
      "id": "2aedd7cc.62f3c8",
      "type": "http request",
      "z": "e4d10f14.d558b",
      "name": "Max(id)取得要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1720,
      "y": 320,
      "wires": [
        [
          "2f94097.40d49f6"
        ]
      ]
    },
    {
      "id": "267dcebf.c4e192",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "取得分岐",
      "property": "condition",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "eq",
          "v": "all",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "key",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 3,
      "x": 1660,
      "y": 420,
      "wires": [
        [
          "fcd97966.a611a8"
        ],
        [
          "5735465b.16ac48"
        ],
        [
          "4201c324.defb9c"
        ]
      ]
    },
    {
      "id": "9b89c73b.1bc028",
      "type": "http request",
      "z": "e4d10f14.d558b",
      "name": "KEY取得要求",
      "method": "GET",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1660,
      "y": 640,
      "wires": [
        [
          "e784532a.d0766"
        ]
      ]
    },
    {
      "id": "e28af0af.e7c77",
      "type": "http request",
      "z": "e4d10f14.d558b",
      "name": "KEY取得要求",
      "method": "GET",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1660,
      "y": 940,
      "wires": [
        [
          "2535c3c1.82e9fc"
        ]
      ]
    },
    {
      "id": "c168e684.b52c98",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "作成応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2760,
      "y": 300,
      "wires": [
        [
          "368c607e.8d363",
          "43b3349.5504ccc"
        ]
      ]
    },
    {
      "id": "eb8851ee.db854",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "取得応答",
      "func": "// if (!msg.payload) {\n//     msg.payload = {};\n// }\n\nmsg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\n\nif (msg.total_rows) {\n    msg.payload.total_rows = msg.total_rows;\n}\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2660,
      "y": 520,
      "wires": [
        [
          "4f8d3e6b.13071",
          "c5697e71.c9625"
        ]
      ]
    },
    {
      "id": "ad5952f7.121e",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "変更応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2520,
      "y": 620,
      "wires": [
        [
          "ad2af62a.afdd18",
          "4106428f.2f1f1c"
        ]
      ]
    },
    {
      "id": "eccd6444.88a078",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "削除応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2580,
      "y": 920,
      "wires": [
        [
          "edaabdf2.535b3",
          "79a9394e.87c428"
        ]
      ]
    },
    {
      "id": "454f2c0.ee03ad4",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "Cloudantデータ取得エラー",
      "func": "msg.payload = {\n    \"result\": \"failure\",\n    \"message\": {\n        status: msg.statusCode,\n        action: \"Cloudantデータ取得エラー\"\n    }\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2300,
      "y": 1680,
      "wires": [
        [
          "64eb771e.f9afd8",
          "60ab6b9d.7ef7a4",
          "4dbfc8f6.f33ce8"
        ]
      ]
    },
    {
      "id": "c8cd902e.6e22a",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "変更エラー応答",
      "func": "msg.payload = {\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2340,
      "y": 700,
      "wires": [
        [
          "969cc9e4.6e9fb8",
          "961fd2ae.fd9ae"
        ]
      ]
    },
    {
      "id": "980ddba0.754d38",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "削除エラー応答",
      "func": "msg.payload = {\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2600,
      "y": 1020,
      "wires": [
        [
          "c810229a.1aa14",
          "bab5597f.a156d8"
        ]
      ]
    },
    {
      "id": "f389d04a.b7cca",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "作成エラー応答",
      "func": "msg.payload = {\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2780,
      "y": 340,
      "wires": [
        [
          "f469fbcf.2845e8",
          "39ab68d4.149c48"
        ]
      ]
    },
    {
      "id": "f146f9be.20e948",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "必須パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: \"必須パラメータエラー\" };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2510,
      "y": 200,
      "wires": [
        [
          "7a2bd1ba.6a31f",
          "7a9b83f8.bbcc3c"
        ]
      ]
    },
    {
      "id": "2f94097.40d49f6",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "Max(id)取得",
      "func": "if (msg.payload.rows.length === 0) {\n    msg.maxId = 0;\n} else {\n    msg.maxId = msg.payload.rows[0].value.max;\n}\nmsg.payload = msg.tmp;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1890,
      "y": 320,
      "wires": [
        [
          "d23028b6.664c58"
        ]
      ]
    },
    {
      "id": "5735465b.16ac48",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "全件取得処理",
      "func": "msg.method = \"GET\";\n\nvar addParam = \"\";\nif (msg.limit) {\n    addParam += \"&limit=\"+msg.limit;\n}\nif (msg.skip) {\n    addParam += \"&skip=\"+msg.skip;\n}\n\nmsg.url = context.global.Apis.Cloudant.VIEW_FAQ_ALLSEARCH + addParam;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1880,
      "y": 460,
      "wires": [
        [
          "e25d5595.35fd78"
        ]
      ]
    },
    {
      "id": "e784532a.d0766",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "200",
          "vt": "str"
        },
        {
          "t": "neq",
          "v": "200",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1830,
      "y": 640,
      "wires": [
        [
          "69bff8cd.aabba8"
        ],
        [
          "c8cd902e.6e22a"
        ]
      ]
    },
    {
      "id": "2535c3c1.82e9fc",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "200",
          "vt": "str"
        },
        {
          "t": "neq",
          "v": "200",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1830,
      "y": 940,
      "wires": [
        [
          "cf9832cc.9c5d6"
        ],
        [
          "980ddba0.754d38"
        ]
      ]
    },
    {
      "id": "52647f6e.d33ca",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2590,
      "y": 320,
      "wires": [
        [
          "c168e684.b52c98"
        ],
        [
          "f389d04a.b7cca"
        ]
      ]
    },
    {
      "id": "473e3f5.2b269c",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "フォーマット変更",
      "func": "var result = [];\n\nfor (var i=0; i < msg.payload.rows.length; i++) {\n// for (var i=0; i < msg.payload.total_rows; i++) {\n    result[i] = msg.payload.rows[i].value;\n}\n\nmsg.total_rows = msg.payload.total_rows;\nmsg.payload = result;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2310,
      "y": 460,
      "wires": [
        [
          "eb8851ee.db854"
        ]
      ]
    },
    {
      "id": "9ad11a71.1441a8",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "set total_rows",
      "func": "if (msg.payload) {\n    //msg.total_rows = msg.payload.length;\n    msg.total_rows = msg.payload.length || 1;\n    \n    if (msg.total_rows == 1) {\n        msg.payload = [ msg.payload ];\n    }\n    \n} else {\n    msg.payload = [];\n}\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2480,
      "y": 400,
      "wires": [
        [
          "eb8851ee.db854"
        ]
      ]
    },
    {
      "id": "bc3408a2.7fb228",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2310,
      "y": 620,
      "wires": [
        [
          "ad5952f7.121e"
        ],
        [
          "c8cd902e.6e22a"
        ]
      ]
    },
    {
      "id": "f532cd8d.c136c",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2390,
      "y": 920,
      "wires": [
        [
          "eccd6444.88a078"
        ],
        [
          "980ddba0.754d38"
        ]
      ]
    },
    {
      "id": "f98776da.465af8",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "200",
          "vt": "str"
        },
        {
          "t": "neq",
          "v": "200",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2042.1111946105957,
      "y": 1268.7618789672852,
      "wires": [
        [
          "b9f993af.957c3",
          "2714a45e.35bbbc",
          "27407566.e7ebba"
        ],
        [
          "454f2c0.ee03ad4"
        ]
      ]
    },
    {
      "id": "93aab267.23e3b",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "入力チェック判定",
      "property": "payload",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "nnull"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2210,
      "y": 320,
      "wires": [
        [
          "f146f9be.20e948"
        ],
        [
          "56e617de.0de7b8"
        ]
      ]
    },
    {
      "id": "d23028b6.664c58",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "作成処理",
      "func": "var errorFlag = false;\nif (!msg.payload.question) {\n    errorFlag = true;\n}\nif (!msg.payload.answer) {\n    errorFlag = true;\n}\nif (msg.payload.flag === undefined) {\n    errorFlag = true;\n}\n\nif (errorFlag) {\n    msg.payload = null;\n    \n} else {\n\n    msg.method = \"POST\";\n    msg.url = context.global.Apis.Cloudant.DOC_FAQ\n    msg.headers = {\n        \"Content-type\" : \"application/json\"\n    };\n    \n    var currentTimestampMili = context.global.Util.currentTimestampMili();\n    \n    //msg.payload._id = currentTimestampMili+\"\";\n    msg.payload._id = (msg.maxId + 1) + \"\";\n    msg.payload.id = msg.payload._id;\n    msg.payload.create_date = context.global.Util.formatTimestamp(currentTimestampMili);\n    //msg.payload.flag = 1;\n    \n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2040,
      "y": 320,
      "wires": [
        [
          "93aab267.23e3b"
        ]
      ]
    },
    {
      "id": "e25d5595.35fd78",
      "type": "http request",
      "z": "e4d10f14.d558b",
      "name": "全件取得要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 2080,
      "y": 460,
      "wires": [
        [
          "473e3f5.2b269c"
        ]
      ]
    },
    {
      "id": "69bff8cd.aabba8",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "変更処理2",
      "func": "msg.url = context.global.Apis.Cloudant.DOC_FAQ\nmsg.url += '/' + msg.payload._id;\n\nmsg.headers = {\n    'Content-Type': 'application/json'\n};\n\nmsg.method = \"PUT\";\n\nvar currentTimestampMili = context.global.Util.currentTimestampMili();\n\nmsg.payload._id = msg.payload._id;\nmsg.payload._rev = msg.payload._rev;\nmsg.payload.id = msg.payload._id;\nmsg.payload.question = msg.tmp.question;\nmsg.payload.answer = msg.tmp.answer;\nmsg.payload.modify_date = context.global.Util.formatTimestamp(currentTimestampMili);\nmsg.payload.user = msg.tmp.user;\nmsg.payload.flag = msg.tmp.flag;\nmsg.payload.url = msg.tmp.url;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2010,
      "y": 620,
      "wires": [
        [
          "3d41f0b3.17547"
        ]
      ]
    },
    {
      "id": "cf9832cc.9c5d6",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "削除処理",
      "func": "msg.url = context.global.Apis.Cloudant.DOC_FAQ\nmsg.url += '/' + msg.payload._id;\nmsg.url += '?rev=' + msg.payload._rev;\n\nmsg.headers = {\n    'Content-Type': 'application/json'\n};\n\nmsg.method = \"DELETE\";\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2020,
      "y": 900,
      "wires": [
        [
          "5434e920.c030b8",
          "c22addee.80f0e"
        ]
      ]
    },
    {
      "id": "56e617de.0de7b8",
      "type": "http request",
      "z": "e4d10f14.d558b",
      "name": "作成要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 2420,
      "y": 320,
      "wires": [
        [
          "52647f6e.d33ca"
        ]
      ]
    },
    {
      "id": "3d41f0b3.17547",
      "type": "http request",
      "z": "e4d10f14.d558b",
      "name": "変更要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 2160,
      "y": 620,
      "wires": [
        [
          "bc3408a2.7fb228"
        ]
      ]
    },
    {
      "id": "5434e920.c030b8",
      "type": "http request",
      "z": "e4d10f14.d558b",
      "name": "削除要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 2200,
      "y": 920,
      "wires": [
        [
          "f532cd8d.c136c"
        ]
      ]
    },
    {
      "id": "ac5c604d.6d33c",
      "type": "http request",
      "z": "e4d10f14.d558b",
      "name": "Cloudantデータ取得要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1836.8888320922852,
      "y": 1263.4286289215088,
      "wires": [
        [
          "f98776da.465af8"
        ]
      ]
    },
    {
      "id": "b9f993af.957c3",
      "type": "debug",
      "z": "e4d10f14.d558b",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "payload.rows.length",
      "x": 2250,
      "y": 1200,
      "wires": []
    },
    {
      "id": "d158959b.672738",
      "type": "http in",
      "z": "8baa0034.d9587",
      "name": "取得要求",
      "url": "/api/v1/fbdoc",
      "method": "get",
      "upload": false,
      "swaggerDoc": "",
      "x": 100,
      "y": 120,
      "wires": [
        [
          "4c4d76ca.4d3978",
          "54b6e050.95e12"
        ]
      ]
    },
    {
      "id": "51a581bf.463a4",
      "type": "http in",
      "z": "8baa0034.d9587",
      "name": "作成要求",
      "url": "/api/v1/fbdoc",
      "method": "post",
      "upload": false,
      "swaggerDoc": "",
      "x": 100,
      "y": 480,
      "wires": [
        [
          "4c4d76ca.4d3978",
          "f700300a.a738b"
        ]
      ]
    },
    {
      "id": "a8dbbd00.e6a69",
      "type": "http in",
      "z": "8baa0034.d9587",
      "name": "変更要求",
      "url": "/api/v1/fbdoc",
      "method": "put",
      "upload": false,
      "swaggerDoc": "",
      "x": 100,
      "y": 860,
      "wires": [
        [
          "4c4d76ca.4d3978",
          "bbc5863f.a3ccf8"
        ]
      ]
    },
    {
      "id": "df886b10.2cfd58",
      "type": "http in",
      "z": "8baa0034.d9587",
      "name": "削除要求",
      "url": "/api/v1/fbdoc",
      "method": "delete",
      "upload": false,
      "swaggerDoc": "",
      "x": 100,
      "y": 1220,
      "wires": [
        [
          "4c4d76ca.4d3978",
          "7be6f4b.bab430c"
        ]
      ]
    },
    {
      "id": "89be7fb1.ebe23",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "共通パラメータチェック",
      "func": "/*\nvar errorFlag = true;\n\nif (errorFlag) {\n    //CHECK APIKEY\n    errorFlag = context.global.commonFunction.checkAPIKey();\n}\n\nif (errorFlag) {\n    //CHECK USER\n    errorFlag = context.global.commonFunction.checkUser();\n}\n*/\n\ncontext.global.Util.checkAPIKeyAndUser(msg);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 650,
      "y": 860,
      "wires": [
        [
          "38a2428b.fb79be"
        ]
      ]
    },
    {
      "id": "38a2428b.fb79be",
      "type": "switch",
      "z": "8baa0034.d9587",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "ERROR",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "GET",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "PUT",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "DELETE",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 5,
      "x": 870,
      "y": 862,
      "wires": [
        [
          "ca7d0dd5.27504"
        ],
        [
          "895726bc.7aa118"
        ],
        [
          "1c3a7f77.f54451"
        ],
        [
          "34ed3339.5b245c"
        ],
        [
          "f1721bc5.26f608"
        ]
      ]
    },
    {
      "id": "ca7d0dd5.27504",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "共通パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: msg.common.errorMessage };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1170,
      "y": 280,
      "wires": [
        [
          "a4d16203.9b4eb",
          "893a1706.b7aec8"
        ]
      ]
    },
    {
      "id": "895726bc.7aa118",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "作成処理",
      "func": "var errorFlag = false;\nif (!msg.payload.question) {\n    errorFlag = true;\n}\nif (!msg.payload.answerid) {\n    errorFlag = true;\n}\nif (!msg.payload.relevance) {\n    errorFlag = true;\n}\nif (msg.payload.flag === undefined) {\n    errorFlag = true;\n}\n\nif (errorFlag) {\n    msg.payload = null;\n    \n} else {\n    msg.method = \"POST\";\n    msg.url = context.global.Apis.Cloudant.DOC_FB;\n    \n    var currentTimestampMili = context.global.Util.currentTimestampMili();\n    \n    msg.payload = {\n        _id : currentTimestampMili+\"\",\n        // _id : (msg.maxId + 1) + \"\",\n        id : currentTimestampMili+\"\",\n        // id : (msg.maxId + 1) + \"\",\n        question: msg.payload.question,\n        answer: [{id: msg.payload.answerid+\"\", relevance: msg.payload.relevance}],\n        user : msg.payload.user,\n        create_date : context.global.Util.formatTimestamp(currentTimestampMili),\n        flag : msg.payload.flag\n    };\n    \n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1100,
      "y": 360,
      "wires": [
        [
          "b4a36d50.a1b01"
        ]
      ]
    },
    {
      "id": "1c3a7f77.f54451",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "取得処理",
      "func": "if (msg.payload.id) {\n    msg.condition=\"key\";\n    msg.payload = {\n        \"_id\": msg.payload.id\n    };\n} else if (msg.payload.question || msg.payload.answerid || msg.payload.relevance) {\n    \n    var flag = false;\n    var query = \"\";\n    if (msg.payload.question) {\n        query = \"question: \"+msg.payload.question;\n        flag = true;\n    }\n    if (msg.payload.relevance) {\n        if (flag === true) {\n            query = query + \" AND \";\n            // query = query + \" OR \";\n        }\n        query = query + \"relevance: \"+msg.payload.relevance;\n        flag = true;\n    }\n    if (msg.payload.answerid) {\n        if (flag === true) {\n            query = query + \" AND \";\n            // query = query + \" OR \";\n        }\n        if (msg.payload.answerid === \"answer\") {\n            if (flag === true) {\n                query += \"NOT answerid: NoAnswer\";\n            } else {\n                query += \"*:* AND NOT answerid: NoAnswer\";\n            }\n        } else if (msg.payload.answerid === \"noanswer\") {\n            query += \"answerid: NoAnswer\";\n        } else {\n            query += \"answerid: \"+msg.payload.answerid;\n        }\n    }\n    msg.payload = {\n        \"query\": query,\n        \"limit\": 100\n    };\n    \n} else {\n    msg.condition=\"all\";\n    msg.limit=msg.payload.limit;\n    msg.skip=msg.payload.skip;\n    \n    msg.datatype=msg.payload.datatype;\n}\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1120,
      "y": 660,
      "wires": [
        [
          "c64888ad.c5cae8",
          "4fd47c7d.466604"
        ]
      ]
    },
    {
      "id": "34ed3339.5b245c",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "変更処理",
      "func": "msg.url = context.global.Apis.Cloudant.DOC_FB;\nmsg.url += '/' + msg.payload.id;\n\nmsg.tmp = msg.payload;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1120,
      "y": 940,
      "wires": [
        [
          "c94eca7f.016ec8"
        ]
      ]
    },
    {
      "id": "f1721bc5.26f608",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "削除処理",
      "func": "msg.url = context.global.Apis.Cloudant.DOC_FB\nmsg.url += '/' + msg.payload.id;\n\nmsg.tmp = msg.payload;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1120,
      "y": 1220,
      "wires": [
        [
          "c85e3296.ec175"
        ]
      ]
    },
    {
      "id": "b4a36d50.a1b01",
      "type": "switch",
      "z": "8baa0034.d9587",
      "name": "入力チェック判定",
      "property": "payload",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "nnull"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1270,
      "y": 360,
      "wires": [
        [
          "b93461b0.db98e"
        ],
        [
          "2a9c3970.360886"
        ]
      ]
    },
    {
      "id": "c64888ad.c5cae8",
      "type": "switch",
      "z": "8baa0034.d9587",
      "name": "取得分岐",
      "property": "condition",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "eq",
          "v": "all",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "key",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 3,
      "x": 1280,
      "y": 660,
      "wires": [
        [
          "2a379f60.7f008"
        ],
        [
          "2e74c9b7.90bd26"
        ],
        [
          "d1262d6a.3ba2b"
        ]
      ]
    },
    {
      "id": "4fd47c7d.466604",
      "type": "debug",
      "z": "8baa0034.d9587",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "false",
      "x": 1230,
      "y": 580,
      "wires": []
    },
    {
      "id": "c94eca7f.016ec8",
      "type": "http request",
      "z": "8baa0034.d9587",
      "name": "KEY取得要求",
      "method": "GET",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1300,
      "y": 940,
      "wires": [
        [
          "b37268d7.3ddbe8"
        ]
      ]
    },
    {
      "id": "c85e3296.ec175",
      "type": "http request",
      "z": "8baa0034.d9587",
      "name": "KEY取得要求",
      "method": "GET",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1300,
      "y": 1220,
      "wires": [
        [
          "e69ad92d.b114b8"
        ]
      ]
    },
    {
      "id": "1d9688b8.3b3d77",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "作成応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1820,
      "y": 420,
      "wires": [
        [
          "182751b3.10a4ae",
          "2bb36276.86da5e"
        ]
      ]
    },
    {
      "id": "e792dad4.e89fe8",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "取得応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\n\nif (msg.total_rows) {\n    msg.payload.total_rows = msg.total_rows;\n}\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2260,
      "y": 760,
      "wires": [
        [
          "dc72186e.5b3718",
          "c054ff5d.9e236"
        ]
      ]
    },
    {
      "id": "aea7138b.50cd7",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "変更エラー応答",
      "func": "msg.payload = {\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2240,
      "y": 960,
      "wires": [
        [
          "d934332.6b9ebd",
          "8ed015c4.c4da68"
        ]
      ]
    },
    {
      "id": "fcae644d.77d6a8",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "変更応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2220,
      "y": 900,
      "wires": [
        [
          "d830104d.8df5f",
          "48316e11.bcffe"
        ]
      ]
    },
    {
      "id": "d392b4eb.adcd38",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "削除エラー応答",
      "func": "msg.payload = {\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2140,
      "y": 1260,
      "wires": [
        [
          "c0a10926.67df88",
          "e48a6a7e.393fe8"
        ]
      ]
    },
    {
      "id": "2e58a0b3.be519",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "削除応答",
      "func": "msg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 2120,
      "y": 1180,
      "wires": [
        [
          "d019ed61.45036",
          "23017ea9.7e6ba2"
        ]
      ]
    },
    {
      "id": "c578982d.df8e68",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "作成エラー応答",
      "func": "msg.payload = {\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1840,
      "y": 480,
      "wires": [
        [
          "d144f2cf.bd5ec",
          "44dfa82a.c882d8"
        ]
      ]
    },
    {
      "id": "b93461b0.db98e",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "必須パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: \"必須パラメータエラー\" };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1550,
      "y": 360,
      "wires": [
        [
          "31c84581.cee3ca",
          "50c155ff.46827c"
        ]
      ]
    },
    {
      "id": "2a9c3970.360886",
      "type": "http request",
      "z": "8baa0034.d9587",
      "name": "作成要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1460,
      "y": 420,
      "wires": [
        [
          "4050fe8f.81d3a"
        ]
      ]
    },
    {
      "id": "2e74c9b7.90bd26",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "全件取得処理",
      "func": "msg.method = \"GET\";\n\nvar addParam = \"\";\nif (msg.limit) {\n    addParam += \"&limit=\"+msg.limit;\n}\nif (msg.skip) {\n    addParam += \"&skip=\"+msg.skip;\n}\n\nif (msg.datatype) {\n    if (msg.datatype == \"answer\") {\n        msg.url = context.global.Apis.Cloudant.VIEW_FB_ISANSWER + addParam;\n        \n    } else if (msg.datatype == \"noanswer\") {\n        msg.url = context.global.Apis.Cloudant.VIEW_FB_NOANSWER + addParam;\n    }\n    \n} else {\n    msg.url = context.global.Apis.Cloudant.VIEW_FB_ALLSEARCH + addParam;\n}\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1500,
      "y": 700,
      "wires": [
        [
          "1e1f5915.b60547"
        ]
      ]
    },
    {
      "id": "b37268d7.3ddbe8",
      "type": "switch",
      "z": "8baa0034.d9587",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "200",
          "vt": "str"
        },
        {
          "t": "neq",
          "v": "200",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1490,
      "y": 940,
      "wires": [
        [
          "cc0391f8.643b3"
        ],
        [
          "aea7138b.50cd7"
        ]
      ]
    },
    {
      "id": "e69ad92d.b114b8",
      "type": "switch",
      "z": "8baa0034.d9587",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "200",
          "vt": "str"
        },
        {
          "t": "neq",
          "v": "200",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1470,
      "y": 1220,
      "wires": [
        [
          "f207e4b7.423c58"
        ],
        [
          "d392b4eb.adcd38"
        ]
      ]
    },
    {
      "id": "4050fe8f.81d3a",
      "type": "switch",
      "z": "8baa0034.d9587",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1630,
      "y": 420,
      "wires": [
        [
          "1d9688b8.3b3d77"
        ],
        [
          "c578982d.df8e68"
        ]
      ]
    },
    {
      "id": "85ab879d.d5fd28",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "フォーマット変更",
      "func": "var result = [];\n\nfor (var i=0; i < msg.payload.rows.length; i++) {\n// for (var i=0; i < msg.payload.total_rows; i++) {\n    result[i] = msg.payload.rows[i].value;\n}\n\nmsg.total_rows = msg.payload.total_rows;\nmsg.payload = result;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1930,
      "y": 700,
      "wires": [
        [
          "e792dad4.e89fe8"
        ]
      ]
    },
    {
      "id": "37828ecf.8db7f2",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "set total_rows",
      "func": "if (msg.payload) {\n    //msg.total_rows = msg.payload.length;\n    msg.total_rows = msg.payload.length || 1;\n    \n    if (msg.total_rows == 1) {\n        msg.payload = [ msg.payload ];\n    }\n    \n} else {\n    msg.payload = [];\n}\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2060,
      "y": 620,
      "wires": [
        [
          "e792dad4.e89fe8"
        ]
      ]
    },
    {
      "id": "d1ecf9b6.c6dde8",
      "type": "switch",
      "z": "8baa0034.d9587",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2050,
      "y": 920,
      "wires": [
        [
          "fcae644d.77d6a8"
        ],
        [
          "aea7138b.50cd7"
        ]
      ]
    },
    {
      "id": "48cc1c68.a43d84",
      "type": "switch",
      "z": "8baa0034.d9587",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1930,
      "y": 1200,
      "wires": [
        [
          "2e58a0b3.be519"
        ],
        [
          "d392b4eb.adcd38"
        ]
      ]
    },
    {
      "id": "1e1f5915.b60547",
      "type": "http request",
      "z": "8baa0034.d9587",
      "name": "全件取得要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1720,
      "y": 700,
      "wires": [
        [
          "85ab879d.d5fd28"
        ]
      ]
    },
    {
      "id": "cc0391f8.643b3",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "変更処理2",
      "func": "msg.url = context.global.Apis.Cloudant.DOC_FB;\nmsg.url += '/' + msg.payload._id;\n\nmsg.headers = {\n    'Content-Type': 'application/json'\n};\n\nmsg.method = \"PUT\";\n\nvar currentTimestampMili = context.global.Util.currentTimestampMili();\n\nmsg.payload = {\n    _id : msg.payload._id,\n    _rev : msg.payload._rev,\n    id : msg.payload._id,\n    question : msg.tmp.question,\n    answer : [{id: msg.tmp.answerid+\"\", relevance: msg.tmp.relevance}],\n    create_date : msg.payload.create_date,\n    modify_date : context.global.Util.formatTimestamp(currentTimestampMili),\n    user : msg.tmp.user,\n    flag : msg.tmp.flag\n};\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1690,
      "y": 920,
      "wires": [
        [
          "af0b3918.4639f8"
        ]
      ]
    },
    {
      "id": "f207e4b7.423c58",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "削除処理",
      "func": "msg.url = context.global.Apis.Cloudant.DOC_FB;\nmsg.url += '/' + msg.payload._id;\nmsg.url += '?rev=' + msg.payload._rev;\n\nmsg.headers = {\n    'Content-Type': 'application/json'\n};\n\nmsg.method = \"DELETE\";\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1640,
      "y": 1200,
      "wires": [
        [
          "124224d6.8decbb"
        ]
      ]
    },
    {
      "id": "af0b3918.4639f8",
      "type": "http request",
      "z": "8baa0034.d9587",
      "name": "変更要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1880,
      "y": 920,
      "wires": [
        [
          "d1ecf9b6.c6dde8"
        ]
      ]
    },
    {
      "id": "124224d6.8decbb",
      "type": "http request",
      "z": "8baa0034.d9587",
      "name": "削除要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1780,
      "y": 1200,
      "wires": [
        [
          "48cc1c68.a43d84"
        ]
      ]
    },
    {
      "id": "4c4d76ca.4d3978",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "メソッド設定",
      "rules": [
        {
          "t": "set",
          "p": "common.method",
          "pt": "msg",
          "to": "req.method",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 440,
      "y": 860,
      "wires": [
        [
          "89be7fb1.ebe23"
        ]
      ]
    },
    {
      "id": "2714a45e.35bbbc",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "",
      "rules": [
        {
          "t": "set",
          "p": "data",
          "pt": "msg",
          "to": "msg.payload.rows.value",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "i",
          "pt": "msg",
          "to": "0",
          "tot": "str"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2280,
      "y": 1400,
      "wires": [
        [
          "6b894d0d.beb964"
        ]
      ]
    },
    {
      "id": "1d47c563.42cc5b",
      "type": "http response",
      "z": "e4d10f14.d558b",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2510,
      "y": 1260,
      "wires": []
    },
    {
      "id": "37f52944.ce5b56",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "ALL_DOC_FAQ",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.ALL_DOC_FAQ",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1100,
      "y": 720,
      "wires": [
        [
          "743bca37.5e60c4"
        ]
      ]
    },
    {
      "id": "42db1610.ada368",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "VIEW_FAQ_FLAGSEARCH",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.VIEW_FAQ_FLAGSEARCH",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1111.464340209961,
      "y": 1792.6546912193298,
      "wires": [
        [
          "d131bee5.68d4c"
        ]
      ]
    },
    {
      "id": "c1483235.8ab3e",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "ALL_DOC_FB",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.ALL_DOC_FB",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1160,
      "y": 660,
      "wires": [
        [
          "a1db30b1.92eb2"
        ]
      ]
    },
    {
      "id": "3904b550.07eb4a",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "VIEW_FB_FLAGSEARCH",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.VIEW_FB_FLAGSEARCH",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1196.7620086669922,
      "y": 1603.583477973938,
      "wires": [
        [
          "aa97da73.c3b8b8"
        ]
      ]
    },
    {
      "id": "37a01bd6.4055d4",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "VIEW_FAQ_MAXID",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.VIEW_FAQ_MAXID",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "tmp",
          "pt": "msg",
          "to": "payload",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1520,
      "y": 320,
      "wires": [
        [
          "2aedd7cc.62f3c8"
        ]
      ]
    },
    {
      "id": "83db1020.a4aad",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "VIEW_FAQ_FLAGSEARCH",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.VIEW_FAQ_FLAGSEARCH",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1560,
      "y": 1260,
      "wires": [
        [
          "ac5c604d.6d33c"
        ]
      ]
    },
    {
      "id": "27407566.e7ebba",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "QA_DOC文章登録応答",
      "func": "msg.payload = {\n    \"result\": \"success\",\n    \"message\": {\n        status: msg.statusCode,\n        action: \"Discovery文章登録: \" + msg.payload.rows.length\n    }\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2300,
      "y": 1260,
      "wires": [
        [
          "1d47c563.42cc5b",
          "4ee40852.598698"
        ]
      ]
    },
    {
      "id": "7932c4d8.a6c7dc",
      "type": "comment",
      "z": "ab8060fa.504b3",
      "name": "ロック後60分以上はidleと見なす",
      "info": "",
      "x": 1543.0000076293945,
      "y": 692.666675567627,
      "wires": []
    },
    {
      "id": "5d8eecfc.2db2f4",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "delete request ※Async",
      "func": "request = context.global.Request;\nvar async = context.global.Async;\n\n//オプションを定義\nconst auth = {\n    user: context.global.CredentialInfo.username,\n    password: context.global.CredentialInfo.password\n}\n\nfunction delDoc(data, callback) {\n    \n    var url2 = msg.url.replace(/\\{DOC_ID\\}/, data._id);\n\n    var options = {\n        url: url2,\n        auth: auth\n    }\n    \n    // リクエスト送信\n    request.del(options, function (error, response, body) {\n        callback(error, response, JSON.parse(body));\n    });\n}\n\nmsg.body = null;\nmsg.delCount = 0;\nmsg.errCount = 0;\n\nasync.each(msg.target, function(data, next) {\n//async.eachSeries(msg.delDocs, function(data, next) {\n    delDoc(data, function (error, response, body) {\n        if (error) {\n            msg.errCount++;\n        } else {\n            msg.delCount++;\n        }\n        next();\n    });\n}, function complete(err) {\n    if (err) {\n        msg.body = \"ERROR \" + msg.errCount;\n    } else {\n        msg.body = \"OK \" + msg.delCount;\n    }\n});\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3270,
      "y": 880,
      "wires": [
        [
          "50060a44.0c98f4"
        ]
      ]
    },
    {
      "id": "8827dfb3.7c2a4",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "rules": [
        {
          "t": "set",
          "p": "delDocs",
          "pt": "msg",
          "to": "payload.docs",
          "tot": "msg"
        },
        {
          "t": "set",
          "p": "i",
          "pt": "msg",
          "to": "0",
          "tot": "num"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2100,
      "y": 880,
      "wires": [
        [
          "d9470012.10f0b"
        ]
      ]
    },
    {
      "id": "b1a2a87e.b46ce8",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "DEL_DOC",
      "rules": [
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.DEL_DOC",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 3070,
      "y": 880,
      "wires": [
        [
          "5d8eecfc.2db2f4"
        ]
      ]
    },
    {
      "id": "935ffb82.402598",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "body",
      "x": 3660,
      "y": 880,
      "wires": []
    },
    {
      "id": "50060a44.0c98f4",
      "type": "switch",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "property": "body",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3470,
      "y": 880,
      "wires": [
        [
          "269fedd3.6c06b2"
        ],
        [
          "935ffb82.402598",
          "d336a83a.28ea98"
        ]
      ]
    },
    {
      "id": "269fedd3.6c06b2",
      "type": "delay",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "pauseType": "delay",
      "timeout": "1",
      "timeoutUnits": "seconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 3460,
      "y": 720,
      "wires": [
        [
          "50060a44.0c98f4",
          "6a8866c0.d623a8"
        ]
      ]
    },
    {
      "id": "c3d48f35.43cc9",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "msg.index++",
      "func": "msg.index++;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2990,
      "y": 740,
      "wires": [
        [
          "dd5f0b8e.130a38"
        ]
      ]
    },
    {
      "id": "6a8866c0.d623a8",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "delCount",
      "x": 3680,
      "y": 720,
      "wires": []
    },
    {
      "id": "a3090ea3.478e7",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "multipart/form-data ※Async",
      "func": "request = context.global.Request;\nasync = context.global.Async;\n\nconst auth = \n{\n    user: context.global.CredentialInfo.username,\n    password: context.global.CredentialInfo.password\n}\n\nfunction addDoc(data, callback) {\n    var ID  = data.id;\n    delete data['id'];\n    \n    data.extracted_metadata = {\n        url: data.url\n    }\n    delete data['url'];\n    \n    var url2 = msg.url.replace(/\\{DOC_ID\\}/, ID);\n\n    //オプションを定義\n    var options = {\n      url: url2,\n      auth: auth,\n      formData: {\n        file: {\n            value: Buffer.from(JSON.stringify(data)),\n            options: {\n                filename: ID + '.json'\n            }\n            ,contentType: 'application/json'\n        }\n      },\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'multipart/form-data'\n      }\n    }\n\n    // リクエスト送信\n    request.post(options, function (error, response, body) {\n        callback(error, response, JSON.parse(body));\n    });\n}\n\nmsg.result = null;\nmsg.errorCount = 0;\ncount = 0;\n\nasync.each(msg.target, function(data, next) {\n//async.eachLimit(msg.target, 3, function(data, next) {\n//async.eachSeries(msg.target, function(data, next) {\n    addDoc(data, function (error, response, body) {\n        if (error) {\n            msg.errorCount++;\n        } else {\n            ++count;\n        }\n        next();\n    });\n}, function complete(err) {\n    if (err) {\n        msg.result = \"ERROR\";\n    } else {\n        msg.result = \"OK \"+count;\n    }\n});\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3100,
      "y": 1560,
      "wires": [
        [
          "67f6717e.65574"
        ]
      ]
    },
    {
      "id": "2ba8cfe9.f4ab9",
      "type": "delay",
      "z": "e4d10f14.d558b",
      "name": "",
      "pauseType": "delay",
      "timeout": "500",
      "timeoutUnits": "milliseconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 3370,
      "y": 1500,
      "wires": [
        [
          "67f6717e.65574"
        ]
      ]
    },
    {
      "id": "a523d41.459fb28",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "ADD_DOC",
      "rules": [
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.ADD_DOC",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2870,
      "y": 1560,
      "wires": [
        [
          "a3090ea3.478e7"
        ]
      ]
    },
    {
      "id": "6b894d0d.beb964",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "divide array per ADD_DOC_MULTIPLICITY",
      "func": "if (!msg.data) {\n    msg.data = null;\n    \n} else {\n    \n    //配列判定\n    if (!(Object.prototype.toString.call(msg.data) === \"[object Array]\")) {\n        msg.data = [ msg.data ];\n    }\n\n    const PAGE_SIZE = context.global.Const.ADD_DOC_MULTIPLICITY;\n    var rowsLength = msg.data.length;\n    var rows = msg.data;\n    \n    var list = [];\n    var pageCount = Math.floor(rowsLength / PAGE_SIZE);\n    var remainder = rowsLength % PAGE_SIZE;\n    \n    for (var p=0; p < pageCount; p++) {\n        var docs = [];\n        for (var i=p*PAGE_SIZE; i < p*PAGE_SIZE+PAGE_SIZE; i++) {\n            docs.push(rows[i]);\n        }\n        list[p] = docs;\n    }\n    if (remainder > 0) {\n        var docs = [];\n        for (var i=pageCount*PAGE_SIZE; i < pageCount*PAGE_SIZE+remainder; i++) {\n            docs.push(rows[i]);\n        }\n        list[pageCount] = docs;\n    }\n    \n    msg.data = list;\n}\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2570,
      "y": 1400,
      "wires": [
        [
          "516dec6b.3f8c24"
        ]
      ]
    },
    {
      "id": "a402487a.805608",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "msg.data[msg.i++]",
      "func": "\nmsg.payload = msg.data[msg.i++];\nmsg.target = msg.payload;\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3190,
      "y": 1400,
      "wires": [
        [
          "cc20162d.543168",
          "8e2d52e1.f05c6"
        ]
      ]
    },
    {
      "id": "e81ceb3a.804e78",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "",
      "property": "i",
      "propertyType": "msg",
      "rules": [
        {
          "t": "lt",
          "v": "data.length",
          "vt": "msg"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3830,
      "y": 1520,
      "wires": [
        [
          "3792897a.212aa6",
          "a402487a.805608"
        ],
        [
          "81d6c227.66064",
          "1397fdc1.bae1b2"
        ]
      ]
    },
    {
      "id": "3792897a.212aa6",
      "type": "debug",
      "z": "e4d10f14.d558b",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "i",
      "x": 4010,
      "y": 1440,
      "wires": []
    },
    {
      "id": "d9470012.10f0b",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "divide array per DEL_DOC_MULTIPLICITY",
      "func": "//配列判定\n// if (!(Object.prototype.toString.call(msg.data) === \"[object Array]\")) {\n//     msg.data = [];\n// }\n\nconst PAGE_SIZE = context.global.Const.DEL_DOC_MULTIPLICITY;\nvar rowsLength = msg.delDocs.length;\nvar rows = msg.delDocs;\n\nvar list = [];\nvar pageCount = Math.floor(rowsLength / PAGE_SIZE);\nvar remainder = rowsLength % PAGE_SIZE;\n\nfor (var p=0; p < pageCount; p++) {\n    var docs = [];\n    for (var i=p*PAGE_SIZE; i < p*PAGE_SIZE+PAGE_SIZE; i++) {\n        docs.push(rows[i]);\n    }\n    list[p] = docs;\n}\nif (remainder > 0) {\n    var docs = [];\n    for (var i=pageCount*PAGE_SIZE; i < pageCount*PAGE_SIZE+remainder; i++) {\n        docs.push(rows[i]);\n    }\n    list[pageCount] = docs;\n}\n\nmsg.delDocs = list;\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2390,
      "y": 880,
      "wires": [
        [
          "b48e7dfd.de818"
        ]
      ]
    },
    {
      "id": "b48e7dfd.de818",
      "type": "function",
      "z": "f88d33bb.e0bc5",
      "name": "msg.delDocs[msg.i++]",
      "func": "\nmsg.target = msg.delDocs[msg.i++];\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2720,
      "y": 880,
      "wires": [
        [
          "140ea5f6.e546ba"
        ]
      ]
    },
    {
      "id": "d336a83a.28ea98",
      "type": "switch",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "property": "i",
      "propertyType": "msg",
      "rules": [
        {
          "t": "lt",
          "v": "delDocs.length",
          "vt": "msg"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2730,
      "y": 740,
      "wires": [
        [
          "427d7901.7f9448",
          "b48e7dfd.de818"
        ],
        [
          "c3d48f35.43cc9",
          "fec35611.371f78"
        ]
      ]
    },
    {
      "id": "427d7901.7f9448",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "i",
      "x": 2810,
      "y": 680,
      "wires": []
    },
    {
      "id": "81d6c227.66064",
      "type": "debug",
      "z": "e4d10f14.d558b",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "i",
      "x": 4010,
      "y": 1480,
      "wires": []
    },
    {
      "id": "140ea5f6.e546ba",
      "type": "delay",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "pauseType": "delay",
      "timeout": "3",
      "timeoutUnits": "seconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 2920,
      "y": 880,
      "wires": [
        [
          "b1a2a87e.b46ce8"
        ]
      ]
    },
    {
      "id": "516dec6b.3f8c24",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "msg.data is null?",
      "property": "data",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2870,
      "y": 1400,
      "wires": [
        [],
        [
          "a402487a.805608"
        ]
      ]
    },
    {
      "id": "e4c05357.eeede",
      "type": "file",
      "z": "664cefa1.09a55",
      "name": "",
      "filename": "",
      "appendNewline": true,
      "createDir": false,
      "overwriteFile": "true",
      "x": 750,
      "y": 320,
      "wires": []
    },
    {
      "id": "8a6e373d.4ad4e8",
      "type": "function",
      "z": "84c49712.df4df8",
      "name": "ロックファイル作成(idle)",
      "func": "msg.filename = context.global.Const.SEMAPHORE_PATH\n\nvar currentTimestampMili = context.global.Util.currentTimestampMili();\n\nmsg.payload = {\n    status: \"idle\",\n    time: currentTimestampMili\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 610,
      "y": 240,
      "wires": [
        [
          "c3352388.c79b2"
        ]
      ]
    },
    {
      "id": "c3352388.c79b2",
      "type": "file",
      "z": "84c49712.df4df8",
      "name": "",
      "filename": "",
      "appendNewline": true,
      "createDir": false,
      "overwriteFile": "true",
      "x": 810,
      "y": 240,
      "wires": []
    },
    {
      "id": "e999e588.ac18a8",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "DEL_ALL_QUERY",
      "rules": [
        {
          "t": "set",
          "p": "CredentialInfo",
          "pt": "msg",
          "to": "CredentialInfo",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "DELETE",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.DEL_ALL_QUERY",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2730,
      "y": 460,
      "wires": [
        [
          "a7aa7914.cf74e8"
        ]
      ]
    },
    {
      "id": "a7aa7914.cf74e8",
      "type": "http request",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "method": "use",
      "ret": "txt",
      "url": "",
      "tls": "",
      "x": 2930,
      "y": 460,
      "wires": [
        [
          "2bd5e56d.02cd4a",
          "797af8bb.721788"
        ]
      ]
    },
    {
      "id": "2bd5e56d.02cd4a",
      "type": "debug",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "statusCode",
      "x": 3120,
      "y": 500,
      "wires": []
    },
    {
      "id": "cc20162d.543168",
      "type": "debug",
      "z": "e4d10f14.d558b",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "true",
      "x": 3430,
      "y": 1400,
      "wires": []
    },
    {
      "id": "d7139aea.5e9588",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "",
      "rules": [
        {
          "t": "set",
          "p": "doc_id",
          "pt": "msg",
          "to": "payload._id",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2420,
      "y": 860,
      "wires": [
        [
          "b1ed7104.52ff9"
        ]
      ]
    },
    {
      "id": "b1ed7104.52ff9",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "DEL_DOC",
      "rules": [
        {
          "t": "set",
          "p": "CredentialInfo",
          "pt": "msg",
          "to": "CredentialInfo",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "DELETE",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.DEL_DOC",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2605.000045776367,
      "y": 858.3329658508301,
      "wires": [
        [
          "43cf850e.09f82c"
        ]
      ]
    },
    {
      "id": "43cf850e.09f82c",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "DOC_ID ",
      "rules": [
        {
          "t": "change",
          "p": "url",
          "pt": "msg",
          "from": "\\{DOC_ID\\}",
          "fromt": "re",
          "to": "doc_id",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2776.666679382324,
      "y": 858.3329658508301,
      "wires": [
        [
          "36952949.02a8a6"
        ]
      ]
    },
    {
      "id": "36952949.02a8a6",
      "type": "http request",
      "z": "e4d10f14.d558b",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 2951.6666870117188,
      "y": 851.6663398742676,
      "wires": [
        [
          "67460af6.65bd24"
        ]
      ]
    },
    {
      "id": "67460af6.65bd24",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "statusCode = 200 ?",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "200",
          "vt": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3165.000015258789,
      "y": 851.6664390563965,
      "wires": [
        [
          "243d23f2.a7ab3c"
        ],
        [
          "15c0e377.736d4d",
          "927d2f49.3b377"
        ]
      ]
    },
    {
      "id": "243d23f2.a7ab3c",
      "type": "debug",
      "z": "e4d10f14.d558b",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "true",
      "x": 3354,
      "y": 730,
      "wires": []
    },
    {
      "id": "15c0e377.736d4d",
      "type": "debug",
      "z": "e4d10f14.d558b",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "true",
      "x": 3374,
      "y": 770,
      "wires": []
    },
    {
      "id": "a114a365.9f4f6",
      "type": "comment",
      "z": "e4d10f14.d558b",
      "name": "Discoveryから削除する",
      "info": "",
      "x": 2240,
      "y": 820,
      "wires": []
    },
    {
      "id": "8687af35.49915",
      "type": "http request",
      "z": "c08d8bce.292a98",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1810,
      "y": 460,
      "wires": [
        [
          "4650d4a1.f1942c"
        ]
      ]
    },
    {
      "id": "ff87f299.1d5e6",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "INDEX_USER_SEARCH",
      "func": "msg.method = \"GET\";\n\nmsg.url = context.global.Apis.Cloudant.INDEX_USER_SEARCH;\n\nmsg.url += 'q=' + encodeURI(msg.payload.query) + '&include_docs=true&limit=' + msg.payload.limit;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1570,
      "y": 460,
      "wires": [
        [
          "8687af35.49915"
        ]
      ]
    },
    {
      "id": "4650d4a1.f1942c",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "[doc]",
      "rules": [
        {
          "t": "set",
          "p": "payload",
          "pt": "msg",
          "to": "msg.payload.rows.doc",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1990,
      "y": 460,
      "wires": [
        [
          "2f3ca20b.248f5e"
        ]
      ]
    },
    {
      "id": "20aa1deb.593652",
      "type": "function",
      "z": "c08d8bce.292a98",
      "name": "KEY_USER_SEARCH",
      "func": "msg.method = \"GET\";\n\nmsg.url = context.global.Apis.Cloudant.KEY_USER_SEARCH;\n\nmsg.url += '/' + encodeURI(msg.payload._id);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1560,
      "y": 580,
      "wires": [
        [
          "da1e1f70.4c25"
        ]
      ]
    },
    {
      "id": "da1e1f70.4c25",
      "type": "http request",
      "z": "c08d8bce.292a98",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1790,
      "y": 580,
      "wires": [
        [
          "80a817f.21714e8"
        ]
      ]
    },
    {
      "id": "80a817f.21714e8",
      "type": "switch",
      "z": "c08d8bce.292a98",
      "name": "error?",
      "property": "payload.error",
      "propertyType": "msg",
      "rules": [
        {
          "t": "nnull"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1970,
      "y": 580,
      "wires": [
        [
          "9c494a36.906308"
        ],
        [
          "aa072119.0dafa"
        ]
      ]
    },
    {
      "id": "9c494a36.906308",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "set null",
      "rules": [
        {
          "t": "set",
          "p": "payload",
          "pt": "msg",
          "to": "null",
          "tot": "json"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2180,
      "y": 560,
      "wires": [
        [
          "aa072119.0dafa"
        ]
      ]
    },
    {
      "id": "7a34d9bb.70e318",
      "type": "function",
      "z": "4caa9583.52322c",
      "name": "KEY_USER_SEARCH",
      "func": "msg.method = \"GET\";\n\nmsg.url = context.global.Apis.Cloudant.KEY_USER_SEARCH;\n\nmsg.url += '/' + encodeURI(msg.payload._id);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1640,
      "y": 620,
      "wires": [
        [
          "6ac009bb.562e98"
        ]
      ]
    },
    {
      "id": "6ac009bb.562e98",
      "type": "http request",
      "z": "4caa9583.52322c",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1850,
      "y": 620,
      "wires": [
        [
          "36249f74.d5018"
        ]
      ]
    },
    {
      "id": "36249f74.d5018",
      "type": "switch",
      "z": "4caa9583.52322c",
      "name": "error?",
      "property": "payload.error",
      "propertyType": "msg",
      "rules": [
        {
          "t": "nnull"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2010,
      "y": 620,
      "wires": [
        [
          "4669c308.1e32cc"
        ],
        [
          "7ebd4eb2.009d6"
        ]
      ]
    },
    {
      "id": "4669c308.1e32cc",
      "type": "change",
      "z": "4caa9583.52322c",
      "name": "set null",
      "rules": [
        {
          "t": "set",
          "p": "payload",
          "pt": "msg",
          "to": "null",
          "tot": "json"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2200,
      "y": 600,
      "wires": [
        [
          "7ebd4eb2.009d6"
        ]
      ]
    },
    {
      "id": "4201c324.defb9c",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "KEY_FAQ_SEARCH",
      "func": "msg.method = \"GET\";\n\nmsg.url = context.global.Apis.Cloudant.KEY_FAQ_SEARCH;\n\nmsg.url += '/' + encodeURI(msg.payload._id);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1900,
      "y": 520,
      "wires": [
        [
          "ce0281e8.6ffcb"
        ]
      ]
    },
    {
      "id": "ce0281e8.6ffcb",
      "type": "http request",
      "z": "e4d10f14.d558b",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 2090,
      "y": 520,
      "wires": [
        [
          "79590cfa.caf6d4"
        ]
      ]
    },
    {
      "id": "79590cfa.caf6d4",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "error?",
      "property": "payload.error",
      "propertyType": "msg",
      "rules": [
        {
          "t": "nnull"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2270,
      "y": 520,
      "wires": [
        [
          "ffd6937c.12874"
        ],
        [
          "eb8851ee.db854"
        ]
      ]
    },
    {
      "id": "ffd6937c.12874",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "set null",
      "rules": [
        {
          "t": "set",
          "p": "payload",
          "pt": "msg",
          "to": "null",
          "tot": "json"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2420,
      "y": 500,
      "wires": [
        [
          "eb8851ee.db854"
        ]
      ]
    },
    {
      "id": "fcd97966.a611a8",
      "type": "function",
      "z": "e4d10f14.d558b",
      "name": "INDEX_FAQ_SEARCH",
      "func": "msg.method = \"GET\";\n\nmsg.url = context.global.Apis.Cloudant.INDEX_FAQ_SEARCH;\n\nmsg.url += 'q=' + encodeURI(msg.payload.query) + '&include_docs=true&limit=' + msg.payload.limit;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1910,
      "y": 400,
      "wires": [
        [
          "6a3ee5f2.9c9e1c"
        ]
      ]
    },
    {
      "id": "6a3ee5f2.9c9e1c",
      "type": "http request",
      "z": "e4d10f14.d558b",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 2130,
      "y": 400,
      "wires": [
        [
          "528a2c51.ee6844"
        ]
      ]
    },
    {
      "id": "528a2c51.ee6844",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "[doc]",
      "rules": [
        {
          "t": "set",
          "p": "payload",
          "pt": "msg",
          "to": "msg.payload.rows.doc",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2270,
      "y": 400,
      "wires": [
        [
          "9ad11a71.1441a8"
        ]
      ]
    },
    {
      "id": "d1262d6a.3ba2b",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "KEY_FB_SEARCH",
      "func": "msg.method = \"GET\";\n\nmsg.url = context.global.Apis.Cloudant.KEY_FB_SEARCH;\n\nmsg.url += '/' + encodeURI(msg.payload._id);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1510,
      "y": 780,
      "wires": [
        [
          "43171299.0b67bc"
        ]
      ]
    },
    {
      "id": "43171299.0b67bc",
      "type": "http request",
      "z": "8baa0034.d9587",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1710,
      "y": 780,
      "wires": [
        [
          "e961f728.75faa8"
        ]
      ]
    },
    {
      "id": "e961f728.75faa8",
      "type": "switch",
      "z": "8baa0034.d9587",
      "name": "error?",
      "property": "payload.error",
      "propertyType": "msg",
      "rules": [
        {
          "t": "nnull"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1890,
      "y": 780,
      "wires": [
        [
          "88f9cfd2.1fe88"
        ],
        [
          "e792dad4.e89fe8"
        ]
      ]
    },
    {
      "id": "88f9cfd2.1fe88",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "set null",
      "rules": [
        {
          "t": "set",
          "p": "payload",
          "pt": "msg",
          "to": "null",
          "tot": "json"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2020,
      "y": 740,
      "wires": [
        [
          "e792dad4.e89fe8"
        ]
      ]
    },
    {
      "id": "2a379f60.7f008",
      "type": "function",
      "z": "8baa0034.d9587",
      "name": "INDEX_FB_SEARCH",
      "func": "msg.method = \"GET\";\n\nmsg.url = context.global.Apis.Cloudant.INDEX_FB_SEARCH;\n\nmsg.url += 'q=' + encodeURI(msg.payload.query) + '&include_docs=true&limit=' + msg.payload.limit;\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1520,
      "y": 620,
      "wires": [
        [
          "d6ce6030.4e109"
        ]
      ]
    },
    {
      "id": "d6ce6030.4e109",
      "type": "http request",
      "z": "8baa0034.d9587",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1710,
      "y": 620,
      "wires": [
        [
          "2de715b.e7725ea"
        ]
      ]
    },
    {
      "id": "2de715b.e7725ea",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "[doc]",
      "rules": [
        {
          "t": "set",
          "p": "payload",
          "pt": "msg",
          "to": "msg.payload.rows.doc",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1890,
      "y": 620,
      "wires": [
        [
          "37828ecf.8db7f2"
        ]
      ]
    },
    {
      "id": "8c866951.16c908",
      "type": "inject",
      "z": "ecf7cb7a.f7b568",
      "name": "セマフォ解除実行",
      "topic": "",
      "payload": "",
      "payloadType": "date",
      "repeat": "",
      "crontab": "",
      "once": false,
      "x": 130,
      "y": 106,
      "wires": [
        []
      ]
    },
    {
      "id": "c7cbf8a3.466cd8",
      "type": "change",
      "z": "60894a16.3cd484",
      "name": "変数設定",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "POST",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.DOC_API_COUNT",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 380,
      "y": 240,
      "wires": [
        [
          "f0e2abf2.a83328"
        ]
      ]
    },
    {
      "id": "f0e2abf2.a83328",
      "type": "function",
      "z": "60894a16.3cd484",
      "name": "API Call Data挿入処理",
      "func": "user = 'Unknown';\nif (msg.payload.user) {\n    user = msg.payload.user;\n} else if (msg.common && msg.common.user) {\n    user = msg.common.user;\n}\n\nmsg.payload = {\n    user: user,\n    timestampOfMili: context.global.Util.currentTimestampMili(),\n    api: msg.apiType\n}\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 580,
      "y": 240,
      "wires": [
        [
          "be9b26e7.c96158",
          "171caac2.710dc5"
        ]
      ]
    },
    {
      "id": "be9b26e7.c96158",
      "type": "http request",
      "z": "60894a16.3cd484",
      "name": "API Call Data挿入",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 870,
      "y": 240,
      "wires": [
        []
      ]
    },
    {
      "id": "bd215719.d5e848",
      "type": "function",
      "z": "664cefa1.09a55",
      "name": "ロックファイル作成(exec)",
      "func": "msg.filename = context.global.Const.SEMAPHORE_PATH\n\nvar currentTimestampMili = context.global.Util.currentTimestampMili();\n\nmsg.payload = {\n    status: \"exec\",\n    time: currentTimestampMili\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 560,
      "y": 320,
      "wires": [
        [
          "e4c05357.eeede"
        ]
      ]
    },
    {
      "id": "74c2db84.012f54",
      "type": "subflow:84c49712.df4df8",
      "z": "ecf7cb7a.f7b568",
      "x": 340,
      "y": 106,
      "wires": []
    },
    {
      "id": "d1a123ac.d3c91",
      "type": "subflow:664cefa1.09a55",
      "z": "f06e3ca3.ed0a6",
      "x": 1260,
      "y": 620,
      "wires": []
    },
    {
      "id": "274910b1.3d2d5",
      "type": "subflow:84c49712.df4df8",
      "z": "f06e3ca3.ed0a6",
      "x": 2720,
      "y": 660,
      "wires": []
    },
    {
      "id": "eac1b8a9.46bbe8",
      "type": "subflow:84c49712.df4df8",
      "z": "f06e3ca3.ed0a6",
      "x": 4600,
      "y": 1260,
      "wires": []
    },
    {
      "id": "2c9351af.6b0a4e",
      "type": "subflow:664cefa1.09a55",
      "z": "e4d10f14.d558b",
      "x": 1520,
      "y": 1300,
      "wires": []
    },
    {
      "id": "60ab6b9d.7ef7a4",
      "type": "subflow:84c49712.df4df8",
      "z": "e4d10f14.d558b",
      "x": 2620,
      "y": 1680,
      "wires": []
    },
    {
      "id": "793efb04.38f054",
      "type": "subflow:664cefa1.09a55",
      "z": "ab8060fa.504b3",
      "x": 2000,
      "y": 320,
      "wires": []
    },
    {
      "id": "1fa765e3.a11bea",
      "type": "subflow:84c49712.df4df8",
      "z": "ab8060fa.504b3",
      "x": 4700,
      "y": 600,
      "wires": []
    },
    {
      "id": "e0e33198.92c66",
      "type": "subflow:664cefa1.09a55",
      "z": "f88d33bb.e0bc5",
      "x": 2100,
      "y": 480,
      "wires": []
    },
    {
      "id": "c5d2daf0.2c8d68",
      "type": "subflow:664cefa1.09a55",
      "z": "f06e3ca3.ed0a6",
      "x": 1160,
      "y": 720,
      "wires": []
    },
    {
      "id": "af2a6e98.f0e41",
      "type": "subflow:664cefa1.09a55",
      "z": "f88d33bb.e0bc5",
      "x": 1100,
      "y": 620,
      "wires": []
    },
    {
      "id": "66d49e1e.a0218",
      "type": "subflow:84c49712.df4df8",
      "z": "f88d33bb.e0bc5",
      "x": 4240,
      "y": 560,
      "wires": []
    },
    {
      "id": "5b152748.fecec8",
      "type": "subflow:84c49712.df4df8",
      "z": "f88d33bb.e0bc5",
      "x": 4581.250045776367,
      "y": 1384.023733139038,
      "wires": []
    },
    {
      "id": "116dfe29.fea732",
      "type": "comment",
      "z": "60894a16.3cd484",
      "name": "msg.apiType が設定されていること",
      "info": "",
      "x": 420,
      "y": 180,
      "wires": []
    },
    {
      "id": "f73a8543.4ba1e8",
      "type": "comment",
      "z": "f06e3ca3.ed0a6",
      "name": "relevance値=なし or 0 のときflag=0としている。Not Relevant(0)を扱うためにIF文を追加",
      "info": "",
      "x": 4110,
      "y": 1100,
      "wires": []
    },
    {
      "id": "1397fdc1.bae1b2",
      "type": "subflow:84c49712.df4df8",
      "z": "e4d10f14.d558b",
      "x": 4040,
      "y": 1520,
      "wires": []
    },
    {
      "id": "67f6717e.65574",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "result is not null",
      "property": "result",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3360,
      "y": 1560,
      "wires": [
        [
          "2ba8cfe9.f4ab9"
        ],
        [
          "446f90c6.6d387",
          "72bab0e4.e0424"
        ]
      ]
    },
    {
      "id": "446f90c6.6d387",
      "type": "debug",
      "z": "e4d10f14.d558b",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "result",
      "x": 3590,
      "y": 1600,
      "wires": []
    },
    {
      "id": "8e2d52e1.f05c6",
      "type": "delay",
      "z": "e4d10f14.d558b",
      "name": "",
      "pauseType": "delay",
      "timeout": "3",
      "timeoutUnits": "seconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 2700,
      "y": 1560,
      "wires": [
        [
          "a523d41.459fb28"
        ]
      ]
    },
    {
      "id": "e69b3803.56b638",
      "type": "comment",
      "z": "f06e3ca3.ed0a6",
      "name": "FBドロップ時はDSCからQuery全削除する",
      "info": "",
      "x": 2560,
      "y": 420,
      "wires": []
    },
    {
      "id": "797af8bb.721788",
      "type": "switch",
      "z": "f06e3ca3.ed0a6",
      "name": "statusCode is 200-204?",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "204",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3150,
      "y": 460,
      "wires": [
        [],
        [
          "d5e82313.2c0ed"
        ]
      ]
    },
    {
      "id": "e6b7acc9.34b81",
      "type": "comment",
      "z": "e4d10f14.d558b",
      "name": "エラー発生時処理",
      "info": "",
      "x": 3610,
      "y": 1520,
      "wires": []
    },
    {
      "id": "72bab0e4.e0424",
      "type": "switch",
      "z": "e4d10f14.d558b",
      "name": "msg.errorCount = 0 ?",
      "property": "errorCount",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "0",
          "vt": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3620,
      "y": 1560,
      "wires": [
        [
          "e81ceb3a.804e78"
        ],
        [
          "cc70d95b.45d4d8",
          "52f1d1aa.acc81"
        ]
      ]
    },
    {
      "id": "cc70d95b.45d4d8",
      "type": "subflow:84c49712.df4df8",
      "z": "e4d10f14.d558b",
      "x": 3860,
      "y": 1560,
      "wires": []
    },
    {
      "id": "16b9cbf7.ffbd84",
      "type": "switch",
      "z": "f88d33bb.e0bc5",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "200",
          "vt": "str"
        },
        {
          "t": "neq",
          "v": "200",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1470,
      "y": 720,
      "wires": [
        [
          "e0eb92f4.3ce2c"
        ],
        [
          "b49103e.0c5ef"
        ]
      ]
    },
    {
      "id": "fec35611.371f78",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "i",
      "x": 2990,
      "y": 680,
      "wires": []
    },
    {
      "id": "5bf251fd.b9b48",
      "type": "function",
      "z": "b85ebbb8.71d748",
      "name": "Util(Public)",
      "func": "formatDate = function(date, format) {\n    if (!format) format = 'YYYY-MM-DD hh:mm:ss.SSS';\n    format = format.replace(/YYYY/g, date.getFullYear());\n    format = format.replace(/MM/g, ('0' + (date.getMonth() + 1)).slice(-2));\n    format = format.replace(/DD/g, ('0' + date.getDate()).slice(-2));\n    format = format.replace(/hh/g, ('0' + date.getHours()).slice(-2));\n    format = format.replace(/mm/g, ('0' + date.getMinutes()).slice(-2));\n    format = format.replace(/ss/g, ('0' + date.getSeconds()).slice(-2));\n    if (format.match(/S/g)) {\n        var milliSeconds = ('00' + date.getMilliseconds()).slice(-3);\n        var length = format.match(/S/g).length;\n        for (var i = 0; i < length; i++) format = format.replace(/S/, milliSeconds.substring(i, i + 1));\n    }\n    return format;\n}\n\ncurrentDate = function() {\n    var date = new Date();\n    var jisa = 9;\n    var here= date.getTime();\n    var gmt = here + date.getTimezoneOffset()*60*1000;\n\n    var dateMili = gmt+jisa*60*60*1000;\n    return dateMili;\n}\n\nfunction LogWriter(msg, type, str) {\n    // var user = msg.payload.user || msg.common.user || 'Unknown';\n    var user = 'Unknown';\n    if (msg.payload.user) {\n        user = msg.payload.user;\n    } else if (msg.common && msg.common.user) {\n        user = msg.common.user;\n    }\n\n    var host = 'Unknown';\n    var client = 'unknown';\n    if (msg != null && msg.req != null) {\n        host = msg.req.headers['host'];\n        client = msg.req.headers['x-client-ip'];\n    }\n    var ts = formatDate(new Date(currentDate()), null);\n    var logStr = host+ \" \" + client + \" \"+ ts +\" \"+ user +\" [\"+type+\"] \"+ str;\n    console.log(logStr);\n    return logStr;\n}\n\nLogger = {\n    info: function(msg, str) {\n        return LogWriter(msg, \"INFO\", str);\n    },\n    error: function(msg, str) {\n        return LogWriter(msg, \"ERROR\", str);\n    },\n    debug: function(msg, str) {\n        return LogWriter(msg, \"DEBUG\", str);\n    },\n    api: function(msg, str) {\n        return LogWriter(msg, \"API\", str);\n    }\n}\n\nmsg.Util = {\n\n    Logger: Logger,\n    formatTimestamp: function(dateMili) {\n        return formatDate(new Date(dateMili), null);\n    },\n    currentTimestampMili: function() {\n        return currentDate();\n    },\n    checkAPIKey: function(msg) {\n        msg.common.user = msg.payload.user;\n        \n        if (msg.payload.apikey === context.global.Const.API_KEY) {\n            delete msg.payload[\"apikey\"];\n            // return true;\n        } else {\n            msg.common.method=\"ERROR\";\n            msg.common.errorMessage=\"APIKEYエラー\";\n            // return false;\n        }\n    },\n    checkAPIKeyAndUser: function(msg) {\n      msg.common.user = msg.payload.user;\n      \n      var result = false;\n      if (msg.payload.apikey === context.global.Const.API_KEY) {\n          delete msg.payload[\"apikey\"];\n          result = true;\n      } else {\n          msg.common.method = \"ERROR\";\n          msg.common.errorMessage = \"APIKEYエラー\";\n          result = false;\n      }\n      if (result) {\n        if (!msg.payload.user) {\n            msg.common.method = \"ERROR\";\n            msg.common.errorMessage = \"userエラー\";\n            result = false;\n        }\n      }\n    //   return result;\n    },\n    getDownloadFileName: function(name, dateMili) {\n        var cdate = formatDate(new Date(dateMili), 'YYYY-MM-DD-hhmmss');\n        return \"export-\"+name+\"-\"+cdate+\".csv\";\n    },\n    encrypt: function(str) {\n        return str;\n    },\n    decrypt: function(str) {\n        return str;\n    }\n\n}\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 410,
      "y": 582,
      "wires": [
        [
          "92521d9d.06035"
        ]
      ]
    },
    {
      "id": "a8fe82ce.a6712",
      "type": "inject",
      "z": "ecf7cb7a.f7b568",
      "name": "セマフォ参照",
      "topic": "",
      "payload": "",
      "payloadType": "date",
      "repeat": "",
      "crontab": "",
      "once": false,
      "x": 110,
      "y": 60,
      "wires": [
        [
          "dbb1fe87.bb09f"
        ]
      ]
    },
    {
      "id": "dbb1fe87.bb09f",
      "type": "change",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "rules": [
        {
          "t": "set",
          "p": "filename",
          "pt": "msg",
          "to": "Const.SEMAPHORE_PATH",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 350,
      "y": 60,
      "wires": [
        [
          "11e4a988.a1e756"
        ]
      ]
    },
    {
      "id": "8b7c4986.f657c8",
      "type": "debug",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "false",
      "x": 990,
      "y": 60,
      "wires": []
    },
    {
      "id": "11e4a988.a1e756",
      "type": "file in",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "filename": "",
      "format": "utf8",
      "chunk": false,
      "sendError": false,
      "x": 530,
      "y": 60,
      "wires": [
        [
          "f559a210.5e347"
        ]
      ]
    },
    {
      "id": "f559a210.5e347",
      "type": "json",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "pretty": false,
      "x": 670,
      "y": 60,
      "wires": [
        [
          "ead41e4a.dd98a"
        ]
      ]
    },
    {
      "id": "ead41e4a.dd98a",
      "type": "function",
      "z": "ecf7cb7a.f7b568",
      "name": "日時変換",
      "func": "\nmsg.payload.time = context.global.Util.formatTimestamp(msg.payload.time);\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 820,
      "y": 60,
      "wires": [
        [
          "8b7c4986.f657c8"
        ]
      ]
    },
    {
      "id": "365de6e8.684e4a",
      "type": "change",
      "z": "b85ebbb8.71d748",
      "name": "LIST_COLLECTION",
      "rules": [
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "CredentialInfo.url & '/v1/environments/' & CollectionInfo.EnvironmentId & '/collections?version=2017-11-07'",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1040,
      "y": 402,
      "wires": [
        [
          "39b6e927.71f046"
        ]
      ]
    },
    {
      "id": "39b6e927.71f046",
      "type": "http request",
      "z": "b85ebbb8.71d748",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1250,
      "y": 402,
      "wires": [
        [
          "cc1f947c.c23ff8"
        ]
      ]
    },
    {
      "id": "7f698016.2e142",
      "type": "template",
      "z": "b85ebbb8.71d748",
      "name": "Update CollectionInfo",
      "field": "CollectionInfo",
      "fieldType": "msg",
      "format": "handlebars",
      "syntax": "mustache",
      "template": "{\n    \"CollectionId\": \"{{{collection_id}}}\"\n    \n    ,\"ConfigurationId\": \"{{{configuration_id}}}\"\n    \n    ,\"EnvironmentId\": \"{{{CollectionInfo.EnvironmentId}}}\"\n}\n",
      "output": "json",
      "x": 2020,
      "y": 422,
      "wires": [
        [
          "65657998.84d078"
        ]
      ]
    },
    {
      "id": "38d631ff.e3464e",
      "type": "inject",
      "z": "ecf7cb7a.f7b568",
      "name": "コレクション削除",
      "topic": "",
      "payload": "",
      "payloadType": "date",
      "repeat": "",
      "crontab": "",
      "once": false,
      "x": 130,
      "y": 257,
      "wires": [
        []
      ]
    },
    {
      "id": "b791e791.412568",
      "type": "change",
      "z": "ecf7cb7a.f7b568",
      "name": "DEL_COLLECTION",
      "rules": [
        {
          "t": "set",
          "p": "CredentialInfo",
          "pt": "msg",
          "to": "CredentialInfo",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "DELETE",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.DEL_COLLECTION",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 360,
      "y": 257,
      "wires": [
        [
          "7e94b600.f58ef8"
        ]
      ]
    },
    {
      "id": "7e94b600.f58ef8",
      "type": "http request",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 610,
      "y": 257,
      "wires": [
        [
          "12d08f7b.041441"
        ]
      ]
    },
    {
      "id": "12d08f7b.041441",
      "type": "debug",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "payload",
      "x": 790,
      "y": 257,
      "wires": []
    },
    {
      "id": "1ce14694.42b4b9",
      "type": "switch",
      "z": "b85ebbb8.71d748",
      "name": "CollectionInfo.CollectionId is null ?",
      "property": "CollectionInfo.CollectionId",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 720,
      "y": 402,
      "wires": [
        [
          "365de6e8.684e4a"
        ],
        [
          "65657998.84d078"
        ]
      ]
    },
    {
      "id": "d69d258e.f67bf8",
      "type": "change",
      "z": "b85ebbb8.71d748",
      "name": "LIST_ENV",
      "rules": [
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "CredentialInfo.url & '/v1/environments?version=2017-11-07'",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 650,
      "y": 60,
      "wires": [
        [
          "95ad5e7a.e6243"
        ]
      ]
    },
    {
      "id": "95ad5e7a.e6243",
      "type": "http request",
      "z": "b85ebbb8.71d748",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 870,
      "y": 60,
      "wires": [
        [
          "f09153f4.3ae77"
        ]
      ]
    },
    {
      "id": "cc1f947c.c23ff8",
      "type": "change",
      "z": "b85ebbb8.71d748",
      "name": "collection_id, configuration_id",
      "rules": [
        {
          "t": "set",
          "p": "collection_id",
          "pt": "msg",
          "to": "payload.collections[name='faq_collection'].collection_id",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "configuration_id",
          "pt": "msg",
          "to": "payload.collections[name='faq_collection'].configuration_id",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1490,
      "y": 402,
      "wires": [
        [
          "ef532f0e.286f7"
        ]
      ]
    },
    {
      "id": "ef532f0e.286f7",
      "type": "switch",
      "z": "b85ebbb8.71d748",
      "name": "collection_id is null ?",
      "property": "collection_id",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1760,
      "y": 402,
      "wires": [
        [
          "83a2802f.be0a3"
        ],
        [
          "7f698016.2e142"
        ]
      ]
    },
    {
      "id": "5b542668.34dc28",
      "type": "debug",
      "z": "b85ebbb8.71d748",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "false",
      "x": 2130,
      "y": 382,
      "wires": []
    },
    {
      "id": "83a2802f.be0a3",
      "type": "template",
      "z": "b85ebbb8.71d748",
      "name": "エラー",
      "field": "payload",
      "fieldType": "msg",
      "format": "handlebars",
      "syntax": "mustache",
      "template": "[error]コレクションを作成して下さい。",
      "output": "str",
      "x": 1970,
      "y": 382,
      "wires": [
        [
          "5b542668.34dc28",
          "7f698016.2e142"
        ]
      ]
    },
    {
      "id": "7f788774.2f9c98",
      "type": "comment",
      "z": "b85ebbb8.71d748",
      "name": "name='faq_collection'",
      "info": "",
      "x": 1460,
      "y": 360,
      "wires": []
    },
    {
      "id": "f09153f4.3ae77",
      "type": "switch",
      "z": "b85ebbb8.71d748",
      "name": "statusCode != 200 ?",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "neq",
          "v": "200",
          "vt": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1060,
      "y": 60,
      "wires": [
        [
          "a149432f.839b9"
        ],
        [
          "616cc4ba.62f16c",
          "fbe61faa.0db75"
        ]
      ]
    },
    {
      "id": "a149432f.839b9",
      "type": "template",
      "z": "b85ebbb8.71d748",
      "name": "エラー",
      "field": "payload",
      "fieldType": "msg",
      "format": "handlebars",
      "syntax": "mustache",
      "template": "[error]CredentialInfo設定を確認して下さい。",
      "output": "str",
      "x": 1250,
      "y": 40,
      "wires": [
        [
          "c437235f.e730d",
          "fbe61faa.0db75"
        ]
      ]
    },
    {
      "id": "c437235f.e730d",
      "type": "debug",
      "z": "b85ebbb8.71d748",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "false",
      "x": 1410,
      "y": 40,
      "wires": []
    },
    {
      "id": "861f75b3.db4328",
      "type": "change",
      "z": "ecf7cb7a.f7b568",
      "name": "LIST_COLLECTION_DETAIL",
      "rules": [
        {
          "t": "set",
          "p": "CredentialInfo",
          "pt": "msg",
          "to": "CredentialInfo",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.LIST_COLLECTION_DETAIL",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 380,
      "y": 197,
      "wires": [
        [
          "b96f86fa.c40368"
        ]
      ]
    },
    {
      "id": "b96f86fa.c40368",
      "type": "http request",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 610,
      "y": 197,
      "wires": [
        [
          "60af8eee.95aa3"
        ]
      ]
    },
    {
      "id": "60af8eee.95aa3",
      "type": "debug",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "payload",
      "x": 790,
      "y": 197,
      "wires": []
    },
    {
      "id": "bdb84e5c.57ad2",
      "type": "inject",
      "z": "ecf7cb7a.f7b568",
      "name": "コレクション状況",
      "topic": "",
      "payload": "",
      "payloadType": "date",
      "repeat": "",
      "crontab": "",
      "once": false,
      "x": 130,
      "y": 197,
      "wires": [
        [
          "861f75b3.db4328"
        ]
      ]
    },
    {
      "id": "4049bfe1.973e2",
      "type": "inject",
      "z": "ecf7cb7a.f7b568",
      "name": "学習データ削除",
      "topic": "",
      "payload": "",
      "payloadType": "date",
      "repeat": "",
      "crontab": "",
      "once": false,
      "x": 120,
      "y": 317,
      "wires": [
        []
      ]
    },
    {
      "id": "be2e2ea7.f24b7",
      "type": "change",
      "z": "ecf7cb7a.f7b568",
      "name": "DEL_ALL_QUERY",
      "rules": [
        {
          "t": "set",
          "p": "CredentialInfo",
          "pt": "msg",
          "to": "CredentialInfo",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "DELETE",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.DEL_ALL_QUERY",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 350,
      "y": 317,
      "wires": [
        [
          "3e0df785.a01798"
        ]
      ]
    },
    {
      "id": "3e0df785.a01798",
      "type": "http request",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "method": "use",
      "ret": "txt",
      "url": "",
      "tls": "",
      "x": 610,
      "y": 317,
      "wires": [
        [
          "d24b8a1c.5cb0d8"
        ]
      ]
    },
    {
      "id": "d24b8a1c.5cb0d8",
      "type": "debug",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "payload",
      "x": 790,
      "y": 317,
      "wires": []
    },
    {
      "id": "4977e8fa.1eb028",
      "type": "link in",
      "z": "b85ebbb8.71d748",
      "name": "from_create_collection",
      "links": [
        "c244be5a.16d4c"
      ],
      "x": 215,
      "y": 456,
      "wires": [
        [
          "65657998.84d078"
        ]
      ]
    },
    {
      "id": "b4312761.2c0848",
      "type": "inject",
      "z": "ecf7cb7a.f7b568",
      "name": "コレクション作成",
      "topic": "",
      "payload": "",
      "payloadType": "date",
      "repeat": "",
      "crontab": "",
      "once": false,
      "x": 130,
      "y": 600,
      "wires": [
        [
          "f3b9d8e7.1bd788"
        ]
      ]
    },
    {
      "id": "f3b9d8e7.1bd788",
      "type": "change",
      "z": "ecf7cb7a.f7b568",
      "name": "LIST_ENV",
      "rules": [
        {
          "t": "set",
          "p": "CredentialInfo",
          "pt": "msg",
          "to": "CredentialInfo",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "CredentialInfo.url & '/v1/environments?version=2017-11-07'",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 410,
      "y": 600,
      "wires": [
        [
          "e1142a80.e7ed88"
        ]
      ]
    },
    {
      "id": "627c694e.ca06a8",
      "type": "change",
      "z": "ecf7cb7a.f7b568",
      "name": "LIST_CONFIG",
      "rules": [
        {
          "t": "set",
          "p": "CredentialInfo",
          "pt": "msg",
          "to": "CredentialInfo",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.LIST_CONFIG",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1320,
      "y": 660,
      "wires": [
        [
          "8717cbf1.c62d38"
        ]
      ]
    },
    {
      "id": "8717cbf1.c62d38",
      "type": "http request",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1510,
      "y": 660,
      "wires": [
        [
          "497bdd18.a025c4"
        ]
      ]
    },
    {
      "id": "e1142a80.e7ed88",
      "type": "http request",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 610,
      "y": 600,
      "wires": [
        [
          "3c332bab.d916d4"
        ]
      ]
    },
    {
      "id": "3c332bab.d916d4",
      "type": "switch",
      "z": "ecf7cb7a.f7b568",
      "name": "statusCode != 200 ?",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "neq",
          "v": "200",
          "vt": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 840,
      "y": 600,
      "wires": [
        [
          "40021b45.b17234"
        ],
        [
          "c4566722.5c74a8"
        ]
      ]
    },
    {
      "id": "497bdd18.a025c4",
      "type": "change",
      "z": "ecf7cb7a.f7b568",
      "name": "Default Configuration ID",
      "rules": [
        {
          "t": "set",
          "p": "payload",
          "pt": "msg",
          "to": "payload.configurations[name='Default Configuration'].configuration_id",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1730,
      "y": 660,
      "wires": [
        [
          "1b3f0194.f1699e"
        ]
      ]
    },
    {
      "id": "1b3f0194.f1699e",
      "type": "template",
      "z": "ecf7cb7a.f7b568",
      "name": "作成コレクションJSON",
      "field": "payload",
      "fieldType": "msg",
      "format": "handlebars",
      "syntax": "mustache",
      "template": "{\n    \"name\": \"faq_collection\",\n    \"description\": \"My faq collection\",\n    \"configuration_id\": \"{{{payload}}}\",\n    \"language\": \"ja\"\n}\n",
      "output": "json",
      "x": 1990,
      "y": 660,
      "wires": [
        [
          "30637d8c.ac1792"
        ]
      ]
    },
    {
      "id": "47499c36.80a514",
      "type": "comment",
      "z": "ecf7cb7a.f7b568",
      "name": "name='faq_collection'",
      "info": "",
      "x": 1980,
      "y": 620,
      "wires": []
    },
    {
      "id": "27d26924.79a026",
      "type": "change",
      "z": "ecf7cb7a.f7b568",
      "name": "ADD_COLLECTION",
      "rules": [
        {
          "t": "set",
          "p": "CredentialInfo",
          "pt": "msg",
          "to": "CredentialInfo",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "POST",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.ADD_COLLECTION",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2420,
      "y": 660,
      "wires": [
        [
          "37a19c9f.fc7984"
        ]
      ]
    },
    {
      "id": "37a19c9f.fc7984",
      "type": "http request",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 2630,
      "y": 660,
      "wires": [
        [
          "dc509552.b91268"
        ]
      ]
    },
    {
      "id": "dc509552.b91268",
      "type": "switch",
      "z": "ecf7cb7a.f7b568",
      "name": "statusCode = 201",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "201",
          "vt": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2830,
      "y": 660,
      "wires": [
        [
          "dcbb83b4.22128"
        ],
        [
          "a3b73f74.f5df6"
        ]
      ]
    },
    {
      "id": "40021b45.b17234",
      "type": "template",
      "z": "ecf7cb7a.f7b568",
      "name": "エラー",
      "field": "payload",
      "fieldType": "msg",
      "format": "handlebars",
      "syntax": "mustache",
      "template": "[error]CredentialInfo設定を確認して下さい。",
      "output": "str",
      "x": 1050,
      "y": 540,
      "wires": [
        [
          "392e4cb.7a3d9b4"
        ]
      ]
    },
    {
      "id": "392e4cb.7a3d9b4",
      "type": "debug",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "false",
      "x": 1210,
      "y": 540,
      "wires": []
    },
    {
      "id": "dcbb83b4.22128",
      "type": "template",
      "z": "ecf7cb7a.f7b568",
      "name": "Update CollectionInfo",
      "field": "CollectionInfo",
      "fieldType": "msg",
      "format": "handlebars",
      "syntax": "mustache",
      "template": "{\n    \"CollectionId\": \"{{{payload.collection_id}}}\"\n    \n    ,\"ConfigurationId\": \"{{{payload.configuration_id}}}\"\n    \n    ,\"EnvironmentId\": \"{{{environment_id}}}\"\n}\n",
      "output": "json",
      "x": 3060,
      "y": 660,
      "wires": [
        [
          "61560a55.dca394",
          "c244be5a.16d4c"
        ]
      ]
    },
    {
      "id": "a3b73f74.f5df6",
      "type": "template",
      "z": "ecf7cb7a.f7b568",
      "name": "エラー",
      "field": "payload",
      "fieldType": "msg",
      "format": "handlebars",
      "syntax": "mustache",
      "template": "[error]既にコレクションは作成済みか、または新規コレクションの作成に失敗しました。",
      "output": "str",
      "x": 3010,
      "y": 760,
      "wires": [
        [
          "d96ec253.b9ed"
        ]
      ]
    },
    {
      "id": "d96ec253.b9ed",
      "type": "debug",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "false",
      "x": 3170,
      "y": 760,
      "wires": []
    },
    {
      "id": "61560a55.dca394",
      "type": "debug",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "false",
      "x": 3310,
      "y": 620,
      "wires": []
    },
    {
      "id": "c244be5a.16d4c",
      "type": "link out",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "links": [
        "4977e8fa.1eb028"
      ],
      "x": 3255,
      "y": 660,
      "wires": []
    },
    {
      "id": "1cf9271d.4e6d19",
      "type": "comment",
      "z": "ecf7cb7a.f7b568",
      "name": "誤操作防止のためノード切断",
      "info": "",
      "x": 237,
      "y": 287,
      "wires": []
    },
    {
      "id": "542988ea.8ec058",
      "type": "debug",
      "z": "c505c6cd.aad308",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "payload",
      "x": 670,
      "y": 180,
      "wires": []
    },
    {
      "id": "3373f1ec.7eb82e",
      "type": "switch",
      "z": "c505c6cd.aad308",
      "name": "ログ種別判定",
      "property": "LogType",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "info",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "error",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "debug",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "api",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 4,
      "x": 220,
      "y": 180,
      "wires": [
        [
          "257bb564.dcbbfa"
        ],
        [
          "f185bfa0.0b72f"
        ],
        [
          "25a8951c.04fd1a"
        ],
        [
          "c05f09d3.461b98"
        ]
      ]
    },
    {
      "id": "257bb564.dcbbfa",
      "type": "function",
      "z": "c505c6cd.aad308",
      "name": "info",
      "func": "msg.payload = context.global.Util.Logger.info(msg, msg.LogStr);\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 430,
      "y": 100,
      "wires": [
        [
          "542988ea.8ec058"
        ]
      ]
    },
    {
      "id": "f185bfa0.0b72f",
      "type": "function",
      "z": "c505c6cd.aad308",
      "name": "error",
      "func": "msg.payload = context.global.Util.Logger.error(msg, msg.LogStr);\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 430,
      "y": 160,
      "wires": [
        [
          "542988ea.8ec058"
        ]
      ]
    },
    {
      "id": "25a8951c.04fd1a",
      "type": "function",
      "z": "c505c6cd.aad308",
      "name": "debug",
      "func": "msg.payload = context.global.Util.Logger.debug(msg, msg.LogStr);\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 430,
      "y": 220,
      "wires": [
        [
          "542988ea.8ec058"
        ]
      ]
    },
    {
      "id": "c05f09d3.461b98",
      "type": "function",
      "z": "c505c6cd.aad308",
      "name": "api",
      "func": "msg.payload = context.global.Util.Logger.api(msg, msg.LogStr);\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 430,
      "y": 280,
      "wires": [
        [
          "542988ea.8ec058"
        ]
      ]
    },
    {
      "id": "df65289e.a58078",
      "type": "comment",
      "z": "c505c6cd.aad308",
      "name": "msg.LogType と msg.LogStr が必須",
      "info": "",
      "x": 180,
      "y": 100,
      "wires": []
    },
    {
      "id": "74719887.afd238",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(3) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 130,
      "y": 140,
      "wires": [
        [
          "897b9799.111b08"
        ]
      ]
    },
    {
      "id": "897b9799.111b08",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 140,
      "y": 180,
      "wires": []
    },
    {
      "id": "b8bd3c95.165a2",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(2) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 110,
      "y": 380,
      "wires": [
        [
          "9718f611.1c5ae8"
        ]
      ]
    },
    {
      "id": "9718f611.1c5ae8",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 140,
      "y": 420,
      "wires": []
    },
    {
      "id": "54edd9db.4a9038",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(4) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 130,
      "y": 700,
      "wires": [
        [
          "d4f9e384.ff0b6"
        ]
      ]
    },
    {
      "id": "d4f9e384.ff0b6",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 160,
      "y": 740,
      "wires": []
    },
    {
      "id": "e292af68.41fab",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(6) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 130,
      "y": 940,
      "wires": [
        [
          "31397f03.19501"
        ]
      ]
    },
    {
      "id": "31397f03.19501",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 160,
      "y": 980,
      "wires": []
    },
    {
      "id": "979f4d09.e5adf",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"Common parameters error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1540,
      "y": 100,
      "wires": [
        [
          "d2a31c3d.439de"
        ]
      ]
    },
    {
      "id": "d2a31c3d.439de",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 1720,
      "y": 100,
      "wires": []
    },
    {
      "id": "cc1f73ac.0274e",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(3) invalid parameter error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1780,
      "y": 200,
      "wires": [
        [
          "2ee5aff5.c460f"
        ]
      ]
    },
    {
      "id": "2ee5aff5.c460f",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 1960,
      "y": 200,
      "wires": []
    },
    {
      "id": "e7d152c1.d3baa",
      "type": "http response",
      "z": "c08d8bce.292a98",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 1510,
      "y": 60,
      "wires": []
    },
    {
      "id": "1020316f.c547af",
      "type": "http response",
      "z": "c08d8bce.292a98",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2050,
      "y": 280,
      "wires": []
    },
    {
      "id": "28113e21.342c92",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(3) creating error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1720,
      "y": 380,
      "wires": [
        [
          "6b4c97f7.c57488"
        ]
      ]
    },
    {
      "id": "6b4c97f7.c57488",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 1900,
      "y": 380,
      "wires": []
    },
    {
      "id": "13af56ca.371159",
      "type": "http response",
      "z": "c08d8bce.292a98",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2050,
      "y": 360,
      "wires": []
    },
    {
      "id": "5ebe9ef8.0eeed",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(3) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2070,
      "y": 320,
      "wires": [
        [
          "3de03604.6b1aca"
        ]
      ]
    },
    {
      "id": "3de03604.6b1aca",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 2220,
      "y": 320,
      "wires": []
    },
    {
      "id": "86c20c75.460d8",
      "type": "http response",
      "z": "c08d8bce.292a98",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2650,
      "y": 620,
      "wires": []
    },
    {
      "id": "f3ec60a2.5afde",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(2) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2670,
      "y": 580,
      "wires": [
        [
          "947c00a6.f2cbc"
        ]
      ]
    },
    {
      "id": "947c00a6.f2cbc",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 2840,
      "y": 580,
      "wires": []
    },
    {
      "id": "c32f255e.c239b8",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(4) invalid parameter error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1800,
      "y": 640,
      "wires": [
        [
          "bdac10d9.6ac4b"
        ]
      ]
    },
    {
      "id": "bdac10d9.6ac4b",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 1960,
      "y": 640,
      "wires": []
    },
    {
      "id": "1586af7c.be6ad1",
      "type": "http response",
      "z": "c08d8bce.292a98",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2690,
      "y": 800,
      "wires": []
    },
    {
      "id": "38863c06.a06834",
      "type": "http response",
      "z": "c08d8bce.292a98",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2430,
      "y": 680,
      "wires": []
    },
    {
      "id": "44a7dae8.63d8b4",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(4) change error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1960,
      "y": 860,
      "wires": [
        [
          "cb3bc32c.9fa7e"
        ]
      ]
    },
    {
      "id": "cb3bc32c.9fa7e",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 2140,
      "y": 860,
      "wires": []
    },
    {
      "id": "86a0e741.0c94b8",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(4) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2710,
      "y": 760,
      "wires": [
        [
          "945d69e1.c867c8"
        ]
      ]
    },
    {
      "id": "945d69e1.c867c8",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 2860,
      "y": 760,
      "wires": []
    },
    {
      "id": "ad534f2b.eae6c",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(6) invalid parameter error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1540,
      "y": 920,
      "wires": [
        [
          "d854c9c3.c00928"
        ]
      ]
    },
    {
      "id": "d854c9c3.c00928",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 1740,
      "y": 920,
      "wires": []
    },
    {
      "id": "f1ffa575.5d1a78",
      "type": "http response",
      "z": "c08d8bce.292a98",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2570,
      "y": 1020,
      "wires": []
    },
    {
      "id": "63dbc896.755178",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(6) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2590,
      "y": 1060,
      "wires": [
        [
          "5ba29c44.411ad4"
        ]
      ]
    },
    {
      "id": "5ba29c44.411ad4",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 2740,
      "y": 1060,
      "wires": []
    },
    {
      "id": "e69d71e6.42f57",
      "type": "change",
      "z": "c08d8bce.292a98",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(6) delete error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1960,
      "y": 1120,
      "wires": [
        [
          "875edef5.49d8f"
        ]
      ]
    },
    {
      "id": "875edef5.49d8f",
      "type": "subflow:c505c6cd.aad308",
      "z": "c08d8bce.292a98",
      "x": 2120,
      "y": 1120,
      "wires": []
    },
    {
      "id": "49d80dc8.39a4d4",
      "type": "http response",
      "z": "c08d8bce.292a98",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2370,
      "y": 960,
      "wires": []
    },
    {
      "id": "4ef9efba.403a3",
      "type": "change",
      "z": "4caa9583.52322c",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(1) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 350,
      "y": 140,
      "wires": [
        [
          "7164972a.b0ab18"
        ]
      ]
    },
    {
      "id": "7164972a.b0ab18",
      "type": "subflow:c505c6cd.aad308",
      "z": "4caa9583.52322c",
      "x": 500,
      "y": 140,
      "wires": []
    },
    {
      "id": "a616b254.637d",
      "type": "change",
      "z": "4caa9583.52322c",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"Common parameters error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1580,
      "y": 200,
      "wires": [
        [
          "e16b6f14.4158b"
        ]
      ]
    },
    {
      "id": "e16b6f14.4158b",
      "type": "subflow:c505c6cd.aad308",
      "z": "4caa9583.52322c",
      "x": 1760,
      "y": 200,
      "wires": []
    },
    {
      "id": "a082b631.b338b8",
      "type": "http response",
      "z": "4caa9583.52322c",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 1550,
      "y": 240,
      "wires": []
    },
    {
      "id": "3b2ab48.d6abb4c",
      "type": "http response",
      "z": "4caa9583.52322c",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2970,
      "y": 520,
      "wires": []
    },
    {
      "id": "6a2204f5.862fec",
      "type": "change",
      "z": "4caa9583.52322c",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(1) invalid parameter error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1620,
      "y": 420,
      "wires": [
        [
          "77a4bde5.c706d4"
        ]
      ]
    },
    {
      "id": "77a4bde5.c706d4",
      "type": "subflow:c505c6cd.aad308",
      "z": "4caa9583.52322c",
      "x": 1800,
      "y": 420,
      "wires": []
    },
    {
      "id": "3c1f7ba1.3f9364",
      "type": "http response",
      "z": "4caa9583.52322c",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2970,
      "y": 620,
      "wires": []
    },
    {
      "id": "dab42f6f.6a7b8",
      "type": "change",
      "z": "4caa9583.52322c",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(1) end. loginUser=\" & common.loginUser",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2990,
      "y": 660,
      "wires": [
        [
          "7b6878cb.6e8ec8"
        ]
      ]
    },
    {
      "id": "7b6878cb.6e8ec8",
      "type": "subflow:c505c6cd.aad308",
      "z": "4caa9583.52322c",
      "x": 3140,
      "y": 660,
      "wires": []
    },
    {
      "id": "5038f17c.a8f49",
      "type": "change",
      "z": "4caa9583.52322c",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(1) Authentication error. loginUser=\" & common.loginUser",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2800,
      "y": 560,
      "wires": [
        [
          "62faf722.813fc8"
        ]
      ]
    },
    {
      "id": "62faf722.813fc8",
      "type": "subflow:c505c6cd.aad308",
      "z": "4caa9583.52322c",
      "x": 2980,
      "y": 560,
      "wires": []
    },
    {
      "id": "1b99da60.03f3f6",
      "type": "change",
      "z": "4caa9583.52322c",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(5) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 390,
      "y": 740,
      "wires": [
        [
          "7bad7354.ef410c"
        ]
      ]
    },
    {
      "id": "7bad7354.ef410c",
      "type": "subflow:c505c6cd.aad308",
      "z": "4caa9583.52322c",
      "x": 540,
      "y": 740,
      "wires": []
    },
    {
      "id": "56377b0f.2f7a34",
      "type": "change",
      "z": "4caa9583.52322c",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(5) invalid parameter error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1720,
      "y": 840,
      "wires": [
        [
          "134dfaaa.2e9f25"
        ]
      ]
    },
    {
      "id": "134dfaaa.2e9f25",
      "type": "subflow:c505c6cd.aad308",
      "z": "4caa9583.52322c",
      "x": 1900,
      "y": 840,
      "wires": []
    },
    {
      "id": "158f912f.8721ff",
      "type": "http response",
      "z": "4caa9583.52322c",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2450,
      "y": 940,
      "wires": []
    },
    {
      "id": "f079cc4f.ef90c",
      "type": "http response",
      "z": "4caa9583.52322c",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 3630,
      "y": 780,
      "wires": []
    },
    {
      "id": "ab7ef17b.29c9e",
      "type": "change",
      "z": "4caa9583.52322c",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(5) end. passwordChangedUser=\" & common.passwordChangedUser",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 3650,
      "y": 820,
      "wires": [
        [
          "80930884.1db418"
        ]
      ]
    },
    {
      "id": "80930884.1db418",
      "type": "subflow:c505c6cd.aad308",
      "z": "4caa9583.52322c",
      "x": 3800,
      "y": 820,
      "wires": []
    },
    {
      "id": "47c5139e.8f287c",
      "type": "change",
      "z": "4caa9583.52322c",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(5) change password error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 3100,
      "y": 1140,
      "wires": [
        [
          "3e995931.d45196"
        ]
      ]
    },
    {
      "id": "3e995931.d45196",
      "type": "subflow:c505c6cd.aad308",
      "z": "4caa9583.52322c",
      "x": 3280,
      "y": 1140,
      "wires": []
    },
    {
      "id": "1e70d6d.ddbec29",
      "type": "change",
      "z": "ab8060fa.504b3",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(4) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 350,
      "y": 84,
      "wires": [
        [
          "37e66226.d6dc0e"
        ]
      ]
    },
    {
      "id": "37e66226.d6dc0e",
      "type": "subflow:c505c6cd.aad308",
      "z": "ab8060fa.504b3",
      "x": 500,
      "y": 84,
      "wires": []
    },
    {
      "id": "b8d98587.7959e8",
      "type": "change",
      "z": "ab8060fa.504b3",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(3) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 310,
      "y": 900,
      "wires": [
        [
          "bf353a43.642cd8"
        ]
      ]
    },
    {
      "id": "bf353a43.642cd8",
      "type": "subflow:c505c6cd.aad308",
      "z": "ab8060fa.504b3",
      "x": 480,
      "y": 900,
      "wires": []
    },
    {
      "id": "c027d9ff.d73498",
      "type": "http response",
      "z": "ab8060fa.504b3",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 1350,
      "y": 160,
      "wires": []
    },
    {
      "id": "37abf650.5451ca",
      "type": "change",
      "z": "ab8060fa.504b3",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(3/4) Common parameters error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1380,
      "y": 120,
      "wires": [
        [
          "70d2f7a1.ebf118"
        ]
      ]
    },
    {
      "id": "70d2f7a1.ebf118",
      "type": "subflow:c505c6cd.aad308",
      "z": "ab8060fa.504b3",
      "x": 1560,
      "y": 120,
      "wires": []
    },
    {
      "id": "85ecd64d.1231c8",
      "type": "change",
      "z": "ab8060fa.504b3",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(4) unknown csv header error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2260,
      "y": 500,
      "wires": [
        [
          "b42582be.564d5"
        ]
      ]
    },
    {
      "id": "b42582be.564d5",
      "type": "subflow:c505c6cd.aad308",
      "z": "ab8060fa.504b3",
      "x": 2440,
      "y": 500,
      "wires": []
    },
    {
      "id": "dc4d43b9.72d4f",
      "type": "change",
      "z": "ab8060fa.504b3",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(4) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2390,
      "y": 180,
      "wires": [
        [
          "cf328348.81e25"
        ]
      ]
    },
    {
      "id": "cf328348.81e25",
      "type": "subflow:c505c6cd.aad308",
      "z": "ab8060fa.504b3",
      "x": 2560,
      "y": 180,
      "wires": []
    },
    {
      "id": "42d67c49.525744",
      "type": "change",
      "z": "ab8060fa.504b3",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(3) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1830,
      "y": 700,
      "wires": [
        [
          "92edc18c.f96f3"
        ]
      ]
    },
    {
      "id": "92edc18c.f96f3",
      "type": "subflow:c505c6cd.aad308",
      "z": "ab8060fa.504b3",
      "x": 2000,
      "y": 700,
      "wires": []
    },
    {
      "id": "c0c1df4c.a457e",
      "type": "http response",
      "z": "ab8060fa.504b3",
      "name": "",
      "x": 1690,
      "y": 780,
      "wires": []
    },
    {
      "id": "99c6e524.78f488",
      "type": "change",
      "z": "ab8060fa.504b3",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(4) Cloudant bulk insert error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4660,
      "y": 780,
      "wires": [
        [
          "14d5c07f.5a985"
        ]
      ]
    },
    {
      "id": "14d5c07f.5a985",
      "type": "subflow:c505c6cd.aad308",
      "z": "ab8060fa.504b3",
      "x": 4840,
      "y": 780,
      "wires": []
    },
    {
      "id": "a30194e0.373168",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(10) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 170,
      "y": 360,
      "wires": [
        [
          "e6655a1b.b15c18"
        ]
      ]
    },
    {
      "id": "e6655a1b.b15c18",
      "type": "subflow:c505c6cd.aad308",
      "z": "f88d33bb.e0bc5",
      "x": 180,
      "y": 400,
      "wires": []
    },
    {
      "id": "b97faec1.8417",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(11) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 170,
      "y": 540,
      "wires": [
        [
          "9bcf5d9c.fa0fb"
        ]
      ]
    },
    {
      "id": "9bcf5d9c.fa0fb",
      "type": "subflow:c505c6cd.aad308",
      "z": "f88d33bb.e0bc5",
      "x": 180,
      "y": 580,
      "wires": []
    },
    {
      "id": "bf7efbb2.ab9c28",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(9) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 170,
      "y": 720,
      "wires": [
        [
          "f40c8c2a.0295c"
        ]
      ]
    },
    {
      "id": "f40c8c2a.0295c",
      "type": "subflow:c505c6cd.aad308",
      "z": "f88d33bb.e0bc5",
      "x": 180,
      "y": 760,
      "wires": []
    },
    {
      "id": "9a9e00e7.90dc2",
      "type": "http response",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 1410,
      "y": 100,
      "wires": []
    },
    {
      "id": "d1017e61.be0fd",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(9/10/11) Common parameters error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1440,
      "y": 60,
      "wires": [
        [
          "9d0b887.2400778"
        ]
      ]
    },
    {
      "id": "9d0b887.2400778",
      "type": "subflow:c505c6cd.aad308",
      "z": "f88d33bb.e0bc5",
      "x": 1620,
      "y": 60,
      "wires": []
    },
    {
      "id": "eb6ccc82.d6c94",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(10) unknown csv header error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2380,
      "y": 480,
      "wires": [
        [
          "25d3d740.4b5c98"
        ]
      ]
    },
    {
      "id": "25d3d740.4b5c98",
      "type": "subflow:c505c6cd.aad308",
      "z": "f88d33bb.e0bc5",
      "x": 2560,
      "y": 480,
      "wires": []
    },
    {
      "id": "cf1d9b13.1bbb18",
      "type": "debug",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "headerLine",
      "x": 1840,
      "y": 420,
      "wires": []
    },
    {
      "id": "b49103e.0c5ef",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(10/12) Cloudantデータ取得error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1660,
      "y": 780,
      "wires": [
        [
          "267267ad.03cba8"
        ]
      ]
    },
    {
      "id": "267267ad.03cba8",
      "type": "subflow:c505c6cd.aad308",
      "z": "f88d33bb.e0bc5",
      "x": 1840,
      "y": 780,
      "wires": []
    },
    {
      "id": "eddbf3e9.d06e9",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(10/12) Cloudant bulk insert error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2580,
      "y": 1000,
      "wires": [
        [
          "1ab6870d.042739"
        ]
      ]
    },
    {
      "id": "1ab6870d.042739",
      "type": "subflow:c505c6cd.aad308",
      "z": "f88d33bb.e0bc5",
      "x": 2760,
      "y": 1000,
      "wires": []
    },
    {
      "id": "27472c48.d122a4",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(9) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4230,
      "y": 640,
      "wires": [
        [
          "9184fa24.c80ac8"
        ]
      ]
    },
    {
      "id": "9184fa24.c80ac8",
      "type": "subflow:c505c6cd.aad308",
      "z": "f88d33bb.e0bc5",
      "x": 4400,
      "y": 640,
      "wires": []
    },
    {
      "id": "24bf2a57.bcdf66",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(10) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4330,
      "y": 1060,
      "wires": [
        [
          "6e454bd6.bcd994"
        ]
      ]
    },
    {
      "id": "6e454bd6.bcd994",
      "type": "subflow:c505c6cd.aad308",
      "z": "f88d33bb.e0bc5",
      "x": 4500,
      "y": 1060,
      "wires": []
    },
    {
      "id": "c2225e1.e895aa",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(10) Cloudant bulk insert error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4740,
      "y": 1600,
      "wires": [
        [
          "99413945.39d258"
        ]
      ]
    },
    {
      "id": "99413945.39d258",
      "type": "subflow:c505c6cd.aad308",
      "z": "f88d33bb.e0bc5",
      "x": 4900,
      "y": 1600,
      "wires": []
    },
    {
      "id": "7598d73f.9d1a08",
      "type": "http response",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2050,
      "y": 1760,
      "wires": []
    },
    {
      "id": "10100d0d.f6b2e3",
      "type": "http response",
      "z": "f88d33bb.e0bc5",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2050,
      "y": 1920,
      "wires": []
    },
    {
      "id": "71da72a2.cb9e1c",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(11) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2070,
      "y": 1720,
      "wires": [
        [
          "faa6ee8e.4ea76"
        ]
      ]
    },
    {
      "id": "faa6ee8e.4ea76",
      "type": "subflow:c505c6cd.aad308",
      "z": "f88d33bb.e0bc5",
      "x": 2240,
      "y": 1720,
      "wires": []
    },
    {
      "id": "ffc3b6f5.459e18",
      "type": "change",
      "z": "f88d33bb.e0bc5",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(11) Cloudantデータ取得error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2080,
      "y": 1880,
      "wires": [
        [
          "eb7521aa.7d6e2"
        ]
      ]
    },
    {
      "id": "eb7521aa.7d6e2",
      "type": "subflow:c505c6cd.aad308",
      "z": "f88d33bb.e0bc5",
      "x": 2240,
      "y": 1880,
      "wires": []
    },
    {
      "id": "101ed69b.f4e069",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(6) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 230,
      "y": 300,
      "wires": [
        [
          "685e506.d4eeeb"
        ]
      ]
    },
    {
      "id": "685e506.d4eeeb",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 240,
      "y": 340,
      "wires": []
    },
    {
      "id": "a2c0d992.e68c38",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(5) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 230,
      "y": 720,
      "wires": [
        [
          "fdca0623.ec1e48"
        ]
      ]
    },
    {
      "id": "fdca0623.ec1e48",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 240,
      "y": 760,
      "wires": []
    },
    {
      "id": "28459b8e.c14014",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(7) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 230,
      "y": 1060,
      "wires": [
        [
          "4b78da86.669f54"
        ]
      ]
    },
    {
      "id": "4b78da86.669f54",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 240,
      "y": 1100,
      "wires": []
    },
    {
      "id": "921daa51.16b6e8",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(8) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 230,
      "y": 1360,
      "wires": [
        [
          "22b4978a.8c6c18"
        ]
      ]
    },
    {
      "id": "22b4978a.8c6c18",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 240,
      "y": 1400,
      "wires": []
    },
    {
      "id": "c3fde260.32ad2",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(12) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 230,
      "y": 1640,
      "wires": [
        [
          "9ecf493b.a143d8"
        ]
      ]
    },
    {
      "id": "9ecf493b.a143d8",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 240,
      "y": 1680,
      "wires": []
    },
    {
      "id": "814402ec.c19b6",
      "type": "http response",
      "z": "e4d10f14.d558b",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 1790,
      "y": 140,
      "wires": []
    },
    {
      "id": "662cc340.f102ec",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(5/6/7/8/12) Common parameters error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1820,
      "y": 100,
      "wires": [
        [
          "7a0ec554.1b7edc"
        ]
      ]
    },
    {
      "id": "7a0ec554.1b7edc",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 2000,
      "y": 100,
      "wires": []
    },
    {
      "id": "7a2bd1ba.6a31f",
      "type": "http response",
      "z": "e4d10f14.d558b",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2750,
      "y": 200,
      "wires": []
    },
    {
      "id": "f469fbcf.2845e8",
      "type": "http response",
      "z": "e4d10f14.d558b",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2970,
      "y": 380,
      "wires": []
    },
    {
      "id": "368c607e.8d363",
      "type": "http response",
      "z": "e4d10f14.d558b",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2970,
      "y": 300,
      "wires": []
    },
    {
      "id": "7a9b83f8.bbcc3c",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(5) 必須パラメータerror\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2780,
      "y": 140,
      "wires": [
        [
          "66bbf3bf.d5a9ac"
        ]
      ]
    },
    {
      "id": "66bbf3bf.d5a9ac",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 2960,
      "y": 140,
      "wires": []
    },
    {
      "id": "39ab68d4.149c48",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(5) creating error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 3000,
      "y": 340,
      "wires": [
        [
          "601dc949.ef27f8"
        ]
      ]
    },
    {
      "id": "601dc949.ef27f8",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 3180,
      "y": 340,
      "wires": []
    },
    {
      "id": "43b3349.5504ccc",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(5) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2990,
      "y": 260,
      "wires": [
        [
          "101c7acf.214b75"
        ]
      ]
    },
    {
      "id": "101c7acf.214b75",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 3140,
      "y": 260,
      "wires": []
    },
    {
      "id": "4f8d3e6b.13071",
      "type": "http response",
      "z": "e4d10f14.d558b",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2810,
      "y": 520,
      "wires": []
    },
    {
      "id": "c5697e71.c9625",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(6) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2830,
      "y": 480,
      "wires": [
        [
          "fedb84c5.faf168"
        ]
      ]
    },
    {
      "id": "fedb84c5.faf168",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 2980,
      "y": 480,
      "wires": []
    },
    {
      "id": "ad2af62a.afdd18",
      "type": "http response",
      "z": "e4d10f14.d558b",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2690,
      "y": 640,
      "wires": []
    },
    {
      "id": "969cc9e4.6e9fb8",
      "type": "http response",
      "z": "e4d10f14.d558b",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2510,
      "y": 740,
      "wires": []
    },
    {
      "id": "4106428f.2f1f1c",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(7) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2710,
      "y": 600,
      "wires": [
        [
          "ade96aa4.54d678"
        ]
      ]
    },
    {
      "id": "ade96aa4.54d678",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 2860,
      "y": 600,
      "wires": []
    },
    {
      "id": "961fd2ae.fd9ae",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(7) change error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2540,
      "y": 700,
      "wires": [
        [
          "b938c132.6e5cf"
        ]
      ]
    },
    {
      "id": "b938c132.6e5cf",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 2720,
      "y": 700,
      "wires": []
    },
    {
      "id": "edaabdf2.535b3",
      "type": "http response",
      "z": "e4d10f14.d558b",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2770,
      "y": 940,
      "wires": []
    },
    {
      "id": "c810229a.1aa14",
      "type": "http response",
      "z": "e4d10f14.d558b",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2770,
      "y": 1040,
      "wires": []
    },
    {
      "id": "927d2f49.3b377",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(8) DEL_DOC Error.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 3380,
      "y": 860,
      "wires": [
        [
          "ded5f437.326468"
        ]
      ]
    },
    {
      "id": "ded5f437.326468",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 3540,
      "y": 860,
      "wires": []
    },
    {
      "id": "bab5597f.a156d8",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(8) delete error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2800,
      "y": 1000,
      "wires": [
        [
          "2ac5db19.571a84"
        ]
      ]
    },
    {
      "id": "2ac5db19.571a84",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 2960,
      "y": 1000,
      "wires": []
    },
    {
      "id": "79a9394e.87c428",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(8) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2790,
      "y": 900,
      "wires": [
        [
          "835e5283.8d24"
        ]
      ]
    },
    {
      "id": "835e5283.8d24",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 2940,
      "y": 900,
      "wires": []
    },
    {
      "id": "4ee40852.598698",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(12) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2530,
      "y": 1220,
      "wires": [
        [
          "4c630c20.83afb4"
        ]
      ]
    },
    {
      "id": "4c630c20.83afb4",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 2680,
      "y": 1220,
      "wires": []
    },
    {
      "id": "4dbfc8f6.f33ce8",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(12) Cloudantデータ取得error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2620,
      "y": 1720,
      "wires": [
        [
          "3ce2b67e.3d3afa"
        ]
      ]
    },
    {
      "id": "3ce2b67e.3d3afa",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 2780,
      "y": 1720,
      "wires": []
    },
    {
      "id": "52f1d1aa.acc81",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(12) ADD_DOC Error.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 3860,
      "y": 1600,
      "wires": [
        [
          "7d5a6d67.18d664"
        ]
      ]
    },
    {
      "id": "7d5a6d67.18d664",
      "type": "subflow:c505c6cd.aad308",
      "z": "e4d10f14.d558b",
      "x": 4020,
      "y": 1600,
      "wires": []
    },
    {
      "id": "9b9a3187.d209a",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(18) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 130,
      "y": 119,
      "wires": [
        [
          "7915d79e.5c0538"
        ]
      ]
    },
    {
      "id": "7915d79e.5c0538",
      "type": "subflow:c505c6cd.aad308",
      "z": "f06e3ca3.ed0a6",
      "x": 140,
      "y": 159,
      "wires": []
    },
    {
      "id": "488742e1.4f21ac",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(19) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 130,
      "y": 680,
      "wires": [
        [
          "d9f37714.3b27b8"
        ]
      ]
    },
    {
      "id": "d9f37714.3b27b8",
      "type": "subflow:c505c6cd.aad308",
      "z": "f06e3ca3.ed0a6",
      "x": 140,
      "y": 720,
      "wires": []
    },
    {
      "id": "78837882.1e93e8",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(17) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 150,
      "y": 1280,
      "wires": [
        [
          "20851bb8.918454"
        ]
      ]
    },
    {
      "id": "20851bb8.918454",
      "type": "subflow:c505c6cd.aad308",
      "z": "f06e3ca3.ed0a6",
      "x": 160,
      "y": 1320,
      "wires": []
    },
    {
      "id": "1bcf9f13.e06211",
      "type": "http response",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 1430,
      "y": 80,
      "wires": []
    },
    {
      "id": "236461a9.7cfa1e",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(17/18/19) Common parameters error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1460,
      "y": 40,
      "wires": [
        [
          "d09d723f.d0873"
        ]
      ]
    },
    {
      "id": "d09d723f.d0873",
      "type": "subflow:c505c6cd.aad308",
      "z": "f06e3ca3.ed0a6",
      "x": 1640,
      "y": 40,
      "wires": []
    },
    {
      "id": "add1b6ca.621e08",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(18) CSV header error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2380,
      "y": 180,
      "wires": [
        [
          "dce8e14f.e8b66"
        ]
      ]
    },
    {
      "id": "dce8e14f.e8b66",
      "type": "subflow:c505c6cd.aad308",
      "z": "f06e3ca3.ed0a6",
      "x": 2560,
      "y": 180,
      "wires": []
    },
    {
      "id": "d5e82313.2c0ed",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(17/18) DEL_ALL_QUERY Error.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 3380,
      "y": 460,
      "wires": [
        [
          "cb3a7f59.b740a"
        ]
      ]
    },
    {
      "id": "cb3a7f59.b740a",
      "type": "subflow:c505c6cd.aad308",
      "z": "f06e3ca3.ed0a6",
      "x": 3560,
      "y": 460,
      "wires": []
    },
    {
      "id": "a450c620.c49ca8",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(17/18) Cloudant bulk insert error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2600,
      "y": 740,
      "wires": [
        [
          "bae96416.20d7e8"
        ]
      ]
    },
    {
      "id": "bae96416.20d7e8",
      "type": "subflow:c505c6cd.aad308",
      "z": "f06e3ca3.ed0a6",
      "x": 2780,
      "y": 740,
      "wires": []
    },
    {
      "id": "26439ae0.e0d0c6",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(17) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2710,
      "y": 620,
      "wires": [
        [
          "78cf5343.ef8edc"
        ]
      ]
    },
    {
      "id": "78cf5343.ef8edc",
      "type": "subflow:c505c6cd.aad308",
      "z": "f06e3ca3.ed0a6",
      "x": 2860,
      "y": 620,
      "wires": []
    },
    {
      "id": "a63b4cd.1709cb",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(18) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2830,
      "y": 980,
      "wires": [
        [
          "6efc2118.41cee"
        ]
      ]
    },
    {
      "id": "6efc2118.41cee",
      "type": "subflow:c505c6cd.aad308",
      "z": "f06e3ca3.ed0a6",
      "x": 2980,
      "y": 980,
      "wires": []
    },
    {
      "id": "a70013f2.e5b3c",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(18) Cloudant bulk insert error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4700,
      "y": 1460,
      "wires": [
        [
          "e9ddff0b.d2da6"
        ]
      ]
    },
    {
      "id": "e9ddff0b.d2da6",
      "type": "subflow:c505c6cd.aad308",
      "z": "f06e3ca3.ed0a6",
      "x": 4880,
      "y": 1460,
      "wires": []
    },
    {
      "id": "81fa60dc.e1954",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(19) Cloudant data select error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2220,
      "y": 1640,
      "wires": [
        [
          "1b143293.6ee16d"
        ]
      ]
    },
    {
      "id": "1b143293.6ee16d",
      "type": "subflow:c505c6cd.aad308",
      "z": "f06e3ca3.ed0a6",
      "x": 2420,
      "y": 1640,
      "wires": []
    },
    {
      "id": "bbc44784.11ee18",
      "type": "http response",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2190,
      "y": 1680,
      "wires": []
    },
    {
      "id": "a7bd2a13.697ae8",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(19) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2210,
      "y": 1500,
      "wires": [
        [
          "e116391b.14b6e8"
        ]
      ]
    },
    {
      "id": "e116391b.14b6e8",
      "type": "subflow:c505c6cd.aad308",
      "z": "f06e3ca3.ed0a6",
      "x": 2360,
      "y": 1500,
      "wires": []
    },
    {
      "id": "54b6e050.95e12",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(14) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 270,
      "y": 120,
      "wires": [
        [
          "873255a2.f71fd8"
        ]
      ]
    },
    {
      "id": "873255a2.f71fd8",
      "type": "subflow:c505c6cd.aad308",
      "z": "8baa0034.d9587",
      "x": 420,
      "y": 120,
      "wires": []
    },
    {
      "id": "f700300a.a738b",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(13) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 350,
      "y": 480,
      "wires": [
        [
          "81fe85d5.4294f8"
        ]
      ]
    },
    {
      "id": "81fe85d5.4294f8",
      "type": "subflow:c505c6cd.aad308",
      "z": "8baa0034.d9587",
      "x": 500,
      "y": 480,
      "wires": []
    },
    {
      "id": "bbc5863f.a3ccf8",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(15) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 130,
      "y": 920,
      "wires": [
        [
          "9da966ca.bb60e8"
        ]
      ]
    },
    {
      "id": "9da966ca.bb60e8",
      "type": "subflow:c505c6cd.aad308",
      "z": "8baa0034.d9587",
      "x": 160,
      "y": 960,
      "wires": []
    },
    {
      "id": "7be6f4b.bab430c",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(16) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 290,
      "y": 1220,
      "wires": [
        [
          "89531506.28e848"
        ]
      ]
    },
    {
      "id": "89531506.28e848",
      "type": "subflow:c505c6cd.aad308",
      "z": "8baa0034.d9587",
      "x": 440,
      "y": 1220,
      "wires": []
    },
    {
      "id": "a4d16203.9b4eb",
      "type": "http response",
      "z": "8baa0034.d9587",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 1430,
      "y": 280,
      "wires": []
    },
    {
      "id": "893a1706.b7aec8",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(13/14/15/16) Common parameters error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1460,
      "y": 240,
      "wires": [
        [
          "bbe247c1.440dd8"
        ]
      ]
    },
    {
      "id": "bbe247c1.440dd8",
      "type": "subflow:c505c6cd.aad308",
      "z": "8baa0034.d9587",
      "x": 1640,
      "y": 240,
      "wires": []
    },
    {
      "id": "31c84581.cee3ca",
      "type": "http response",
      "z": "8baa0034.d9587",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 1810,
      "y": 360,
      "wires": []
    },
    {
      "id": "182751b3.10a4ae",
      "type": "http response",
      "z": "8baa0034.d9587",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 1990,
      "y": 420,
      "wires": []
    },
    {
      "id": "d144f2cf.bd5ec",
      "type": "http response",
      "z": "8baa0034.d9587",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2050,
      "y": 520,
      "wires": []
    },
    {
      "id": "50c155ff.46827c",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(13) 必須パラメータerror\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1840,
      "y": 320,
      "wires": [
        [
          "c9612ba4.f23cd8"
        ]
      ]
    },
    {
      "id": "c9612ba4.f23cd8",
      "type": "subflow:c505c6cd.aad308",
      "z": "8baa0034.d9587",
      "x": 2020,
      "y": 320,
      "wires": []
    },
    {
      "id": "44dfa82a.c882d8",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(14) creating error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2080,
      "y": 480,
      "wires": [
        [
          "a3447be5.e16f48"
        ]
      ]
    },
    {
      "id": "a3447be5.e16f48",
      "type": "subflow:c505c6cd.aad308",
      "z": "8baa0034.d9587",
      "x": 2260,
      "y": 480,
      "wires": []
    },
    {
      "id": "dc72186e.5b3718",
      "type": "http response",
      "z": "8baa0034.d9587",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2410,
      "y": 760,
      "wires": []
    },
    {
      "id": "2bb36276.86da5e",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(13) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2010,
      "y": 380,
      "wires": [
        [
          "2323aec1.6eae42"
        ]
      ]
    },
    {
      "id": "2323aec1.6eae42",
      "type": "subflow:c505c6cd.aad308",
      "z": "8baa0034.d9587",
      "x": 2160,
      "y": 380,
      "wires": []
    },
    {
      "id": "c054ff5d.9e236",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(14) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2430,
      "y": 720,
      "wires": [
        [
          "7b0fd750.74a938"
        ]
      ]
    },
    {
      "id": "7b0fd750.74a938",
      "type": "subflow:c505c6cd.aad308",
      "z": "8baa0034.d9587",
      "x": 2580,
      "y": 720,
      "wires": []
    },
    {
      "id": "d830104d.8df5f",
      "type": "http response",
      "z": "8baa0034.d9587",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2430,
      "y": 900,
      "wires": []
    },
    {
      "id": "d934332.6b9ebd",
      "type": "http response",
      "z": "8baa0034.d9587",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2430,
      "y": 960,
      "wires": []
    },
    {
      "id": "48316e11.bcffe",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(15) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2450,
      "y": 860,
      "wires": [
        [
          "5e9ae187.91735"
        ]
      ]
    },
    {
      "id": "5e9ae187.91735",
      "type": "subflow:c505c6cd.aad308",
      "z": "8baa0034.d9587",
      "x": 2600,
      "y": 860,
      "wires": []
    },
    {
      "id": "8ed015c4.c4da68",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(15) change error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2460,
      "y": 1000,
      "wires": [
        [
          "91c4c9ba.21b5b8"
        ]
      ]
    },
    {
      "id": "91c4c9ba.21b5b8",
      "type": "subflow:c505c6cd.aad308",
      "z": "8baa0034.d9587",
      "x": 2640,
      "y": 1000,
      "wires": []
    },
    {
      "id": "c0a10926.67df88",
      "type": "http response",
      "z": "8baa0034.d9587",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2310,
      "y": 1260,
      "wires": []
    },
    {
      "id": "d019ed61.45036",
      "type": "http response",
      "z": "8baa0034.d9587",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 2310,
      "y": 1180,
      "wires": []
    },
    {
      "id": "23017ea9.7e6ba2",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(16) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2330,
      "y": 1140,
      "wires": [
        [
          "18f4aae9.024e75"
        ]
      ]
    },
    {
      "id": "18f4aae9.024e75",
      "type": "subflow:c505c6cd.aad308",
      "z": "8baa0034.d9587",
      "x": 2480,
      "y": 1140,
      "wires": []
    },
    {
      "id": "e48a6a7e.393fe8",
      "type": "change",
      "z": "8baa0034.d9587",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(16) delete error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2340,
      "y": 1300,
      "wires": [
        [
          "3de2a98e.f85be6"
        ]
      ]
    },
    {
      "id": "3de2a98e.f85be6",
      "type": "subflow:c505c6cd.aad308",
      "z": "8baa0034.d9587",
      "x": 2500,
      "y": 1300,
      "wires": []
    },
    {
      "id": "b29761aa.f823a",
      "type": "http in",
      "z": "3c319ef6.6e76e2",
      "name": "作成要求",
      "url": "/api/v1/train",
      "method": "post",
      "upload": false,
      "swaggerDoc": "",
      "x": 80,
      "y": 100,
      "wires": [
        [
          "34c440a5.18804",
          "bd272f12.2cde1"
        ]
      ]
    },
    {
      "id": "43ef3ceb.55fc04",
      "type": "function",
      "z": "3c319ef6.6e76e2",
      "name": "共通パラメータチェック",
      "func": "\ncontext.global.Util.checkAPIKeyAndUser(msg);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 490,
      "y": 280,
      "wires": [
        [
          "c6aee9ad.708b68"
        ]
      ]
    },
    {
      "id": "c6aee9ad.708b68",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "ERROR",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "DELETE",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 3,
      "x": 700,
      "y": 280,
      "wires": [
        [
          "cac6ea8f.5c9b68"
        ],
        [
          "f948665b.1b28a8",
          "aefe386f.e1d878"
        ],
        [
          "5a468a26.5bc004",
          "4293c6c.f0fa538"
        ]
      ]
    },
    {
      "id": "cac6ea8f.5c9b68",
      "type": "function",
      "z": "3c319ef6.6e76e2",
      "name": "共通パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: msg.common.errorMessage };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1030,
      "y": 60,
      "wires": [
        [
          "7c08a709.71ed78",
          "9d73f198.0b022"
        ]
      ]
    },
    {
      "id": "34c440a5.18804",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "メソッド設定",
      "rules": [
        {
          "t": "set",
          "p": "common.method",
          "pt": "msg",
          "to": "req.method",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 280,
      "y": 280,
      "wires": [
        [
          "43ef3ceb.55fc04"
        ]
      ]
    },
    {
      "id": "aefe386f.e1d878",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "VIEW_FB_RANKERSEARCH",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.VIEW_FB_RANKERSEARCH",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 990,
      "y": 280,
      "wires": [
        [
          "6d062fe3.010d5"
        ]
      ]
    },
    {
      "id": "6d062fe3.010d5",
      "type": "http request",
      "z": "3c319ef6.6e76e2",
      "name": "Cloudantデータ取得要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1250,
      "y": 280,
      "wires": [
        [
          "aceb51e8.8a465"
        ]
      ]
    },
    {
      "id": "aceb51e8.8a465",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "neq",
          "v": "200",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "200",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1450,
      "y": 280,
      "wires": [
        [
          "c01df01b.ab79d"
        ],
        [
          "7b18207e.3fb74",
          "d429212e.d7775",
          "2a1f013b.36369e"
        ]
      ]
    },
    {
      "id": "7b18207e.3fb74",
      "type": "function",
      "z": "3c319ef6.6e76e2",
      "name": "登録件数セット",
      "func": "//context.global.totalRow = msg.payload.rows.length;\nmsg.payload = msg.payload.rows.length;\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 1660,
      "y": 320,
      "wires": [
        []
      ]
    },
    {
      "id": "c01df01b.ab79d",
      "type": "function",
      "z": "3c319ef6.6e76e2",
      "name": "Cloudantデータ取得エラー",
      "func": "msg.payload = {\n    \"result\": \"failure\",\n    \"message\": {\n        status: msg.statusCode,\n        action: \"Cloudantデータ取得エラー\"\n    }\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1700,
      "y": 180,
      "wires": [
        [
          "7d8d4ba3.f533c4",
          "ef4bba6e.dd6838",
          "697b478c.046228"
        ]
      ]
    },
    {
      "id": "bedcaf09.39c11",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "true",
      "x": 1850,
      "y": 400,
      "wires": []
    },
    {
      "id": "d429212e.d7775",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "rules": [
        {
          "t": "set",
          "p": "data",
          "pt": "msg",
          "to": "msg.payload.rows.value",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "i",
          "pt": "msg",
          "to": "0",
          "tot": "str"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1660,
      "y": 360,
      "wires": [
        [
          "bedcaf09.39c11",
          "8d5b8ad7.dc8568"
        ]
      ]
    },
    {
      "id": "8d5b8ad7.dc8568",
      "type": "function",
      "z": "3c319ef6.6e76e2",
      "name": "divide array per ADD_QUERY_MULTIPLICITY",
      "func": "if (!msg.data) {\n    msg.data = null;\n    \n} else {\n    \n    //配列判定\n    if (!(Object.prototype.toString.call(msg.data) === \"[object Array]\")) {\n        msg.data = [ msg.data ];\n    }\n\n    const PAGE_SIZE = context.global.Const.ADD_QUERY_MULTIPLICITY;\n    var rowsLength = msg.data.length;\n    var rows = msg.data;\n    \n    var list = [];\n    var pageCount = Math.floor(rowsLength / PAGE_SIZE);\n    var remainder = rowsLength % PAGE_SIZE;\n    \n    for (var p=0; p < pageCount; p++) {\n        var docs = [];\n        for (var i=p*PAGE_SIZE; i < p*PAGE_SIZE+PAGE_SIZE; i++) {\n            docs.push(rows[i]);\n        }\n        list[p] = docs;\n    }\n    if (remainder > 0) {\n        var docs = [];\n        for (var i=pageCount*PAGE_SIZE; i < pageCount*PAGE_SIZE+remainder; i++) {\n            docs.push(rows[i]);\n        }\n        list[pageCount] = docs;\n    }\n    \n    msg.data = list;\n}\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1980,
      "y": 360,
      "wires": [
        [
          "4293c6c.f0fa538"
        ]
      ]
    },
    {
      "id": "8d7834a3.2ce688",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "msg.data is null?",
      "property": "data",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1950,
      "y": 780,
      "wires": [
        [
          "16ca394a.fe13d7"
        ],
        [
          "c2b0a07c.d1995"
        ]
      ]
    },
    {
      "id": "c2b0a07c.d1995",
      "type": "function",
      "z": "3c319ef6.6e76e2",
      "name": "msg.data[msg.i++]",
      "func": "\nmsg.payload = msg.data[msg.i++];\nmsg.target = msg.payload;\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2110,
      "y": 920,
      "wires": [
        [
          "38ed163b.d435ca",
          "8b8affc6.fa537"
        ]
      ]
    },
    {
      "id": "a85ff713.d53d78",
      "type": "delay",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "pauseType": "delay",
      "timeout": "500",
      "timeoutUnits": "milliseconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 2230,
      "y": 1060,
      "wires": [
        [
          "85bbdd4a.e42cb"
        ]
      ]
    },
    {
      "id": "85bbdd4a.e42cb",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "property": "body",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2210,
      "y": 1120,
      "wires": [
        [
          "a85ff713.d53d78"
        ],
        [
          "dfa93ce0.cebe5",
          "eb7792bd.9b141",
          "686c7080.b6a81",
          "b20ba3bb.17ab"
        ]
      ]
    },
    {
      "id": "e84bf215.7b7df",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "property": "i",
      "propertyType": "msg",
      "rules": [
        {
          "t": "lt",
          "v": "data.length",
          "vt": "msg"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2610,
      "y": 1060,
      "wires": [
        [
          "3e16dfc9.77427",
          "c2b0a07c.d1995"
        ],
        [
          "8ab1599b.301688",
          "16ca394a.fe13d7"
        ]
      ]
    },
    {
      "id": "3e16dfc9.77427",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "i",
      "x": 2810,
      "y": 1020,
      "wires": []
    },
    {
      "id": "8ab1599b.301688",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "i",
      "x": 2810,
      "y": 1060,
      "wires": []
    },
    {
      "id": "38ed163b.d435ca",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "payload",
      "x": 2330,
      "y": 880,
      "wires": []
    },
    {
      "id": "8b8affc6.fa537",
      "type": "delay",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "pauseType": "delay",
      "timeout": "3",
      "timeoutUnits": "seconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 2320,
      "y": 920,
      "wires": [
        [
          "2613545c.bcc4dc"
        ]
      ]
    },
    {
      "id": "dfa93ce0.cebe5",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "errorCount",
      "x": 2400,
      "y": 1220,
      "wires": []
    },
    {
      "id": "2613545c.bcc4dc",
      "type": "function",
      "z": "3c319ef6.6e76e2",
      "name": "post request ※Async",
      "func": "request = context.global.Request;\nasync = context.global.Async;\n\nconst auth = \n{\n    user: context.global.CredentialInfo.username,\n    password: context.global.CredentialInfo.password\n}\n\nfunction addQuery(data, callback) {\n\n    var bodyContent = {\n      natural_language_query: data.question,\n      examples: [\n        {\n          document_id: data.answerid,\n          relevance: data.relevance\n        }\n      ]\n    }\n\n    //オプションを定義\n    var options = {\n      url: context.global.Apis.Discovery.ADD_QUERY,\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      auth: auth,\n      json: true,\n      body: bodyContent\n    }\n    \n    // リクエスト送信\n    request.post(options, function (error, response, body) {\n        callback(error, response, body);\n    });\n\n}\n\nfunction addExample(data, query_id, callback) {\n\n    var bodyContent = {\n          document_id: data.answerid,\n          relevance: data.relevance\n    }\n\n    var url = context.global.Apis.Discovery.ADD_EXAMPLE;\n    url = url.replace(/\\{QUERY_ID\\}/, query_id);\n\n    //オプションを定義\n    var options = {\n      url: url,\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      auth: auth,\n      json: true,\n      body: bodyContent\n    }\n    \n    // リクエスト送信\n    request.post(options, function (error, response, body) {\n        callback(error, response, body);\n    });\n\n}\n\nmsg.body = null;\nmsg.errorCount = 0;\nvar count = 0;\n\nasync.each(msg.target, function(data, next) {\n    addQuery(data, function (error, response, body) {\n        if (error) {\n            msg.errorCount++;\n            next();\n        } else {\n            if (body.code === 409) {\n                \n                query_id = body.error.match(/\\|\\|'\\sid\\s(.*)\\salready\\sexists\\sin/)[1];\n                \n                addExample(data, query_id, function(error, response, body) {\n                    if (error) {\n                        msg.errorCount++;\n                        next();\n                    } else {\n                        count++;\n                        next();\n                    }\n                });\n                \n            } else {\n                count++;\n                next();\n            }\n        }\n    });\n    \n}, function complete(err) {\n    if (err) {\n        msg.body = \"ERROR \"+count;\n    } else {\n        msg.body = \"OK \"+count;\n    }\n});\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 2000,
      "y": 1120,
      "wires": [
        [
          "85bbdd4a.e42cb"
        ]
      ]
    },
    {
      "id": "ff836f6f.a558b",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "DEL_ALL_QUERY",
      "rules": [
        {
          "t": "set",
          "p": "CredentialInfo",
          "pt": "msg",
          "to": "CredentialInfo",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "DELETE",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.DEL_ALL_QUERY",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1050,
      "y": 660,
      "wires": [
        [
          "e02d64b0.434d18"
        ]
      ]
    },
    {
      "id": "532a7ab6.c7e054",
      "type": "http request",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "method": "use",
      "ret": "txt",
      "url": "",
      "tls": "",
      "x": 950,
      "y": 840,
      "wires": [
        [
          "1f826d00.7535d3",
          "c1a7f73c.6f1778"
        ]
      ]
    },
    {
      "id": "1f826d00.7535d3",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "statusCode",
      "x": 1140,
      "y": 880,
      "wires": []
    },
    {
      "id": "2a1f013b.36369e",
      "type": "function",
      "z": "3c319ef6.6e76e2",
      "name": "FBDOC登録応答",
      "func": "msg.payload = {\n    \"result\": \"success\",\n    \"message\": {\n        status: msg.statusCode,\n        action: \"Discovery Query登録処理を受け付けました。\"\n    }\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1670,
      "y": 280,
      "wires": [
        [
          "af96a5b2.770b78",
          "df1ad55b.b2e848"
        ]
      ]
    },
    {
      "id": "aeb2a638.bb1898",
      "type": "comment",
      "z": "3c319ef6.6e76e2",
      "name": "QueryAdd, ExampleAdd",
      "info": "",
      "x": 2020,
      "y": 1080,
      "wires": []
    },
    {
      "id": "f948665b.1b28a8",
      "type": "subflow:664cefa1.09a55",
      "z": "3c319ef6.6e76e2",
      "x": 1000,
      "y": 200,
      "wires": []
    },
    {
      "id": "7d8d4ba3.f533c4",
      "type": "subflow:84c49712.df4df8",
      "z": "3c319ef6.6e76e2",
      "x": 1960,
      "y": 100,
      "wires": []
    },
    {
      "id": "dd119340.50d14",
      "type": "subflow:84c49712.df4df8",
      "z": "3c319ef6.6e76e2",
      "x": 4660,
      "y": 1340,
      "wires": []
    },
    {
      "id": "8d027819.acd3f8",
      "type": "subflow:60894a16.3cd484",
      "z": "3c319ef6.6e76e2",
      "x": 4800,
      "y": 1380,
      "wires": []
    },
    {
      "id": "72a3b06d.7687",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "train",
      "rules": [
        {
          "t": "set",
          "p": "apiType",
          "pt": "msg",
          "to": "train",
          "tot": "str"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4630,
      "y": 1380,
      "wires": [
        [
          "8d027819.acd3f8"
        ]
      ]
    },
    {
      "id": "e5ddb5f8.26c4d8",
      "type": "comment",
      "z": "3c319ef6.6e76e2",
      "name": "FB0件の時はFAQデータの登録処理へ",
      "info": "",
      "x": 2010,
      "y": 740,
      "wires": []
    },
    {
      "id": "16ca394a.fe13d7",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "VIEW_FAQ_FLAGSEARCH",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.VIEW_FAQ_FLAGSEARCH",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2520,
      "y": 780,
      "wires": [
        [
          "eca7bae7.44d2d8"
        ]
      ]
    },
    {
      "id": "be6fd519.05d5d8",
      "type": "http request",
      "z": "3c319ef6.6e76e2",
      "name": "Cloudantデータ取得要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 2950,
      "y": 780,
      "wires": [
        [
          "ae4a43c.22a94c"
        ]
      ]
    },
    {
      "id": "ae4a43c.22a94c",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "neq",
          "v": "200",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "200",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3190,
      "y": 780,
      "wires": [
        [
          "f03bd815.0023b8"
        ],
        [
          "42d0c73.c937438",
          "56a7e236.d6f18c"
        ]
      ]
    },
    {
      "id": "42d0c73.c937438",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "payload.rows.length",
      "x": 3510,
      "y": 820,
      "wires": []
    },
    {
      "id": "f03bd815.0023b8",
      "type": "function",
      "z": "3c319ef6.6e76e2",
      "name": "Cloudantデータ取得エラー",
      "func": "msg.payload = {\n    \"result\": \"failure\",\n    \"message\": {\n        status: msg.statusCode,\n        action: \"Cloudantデータ取得エラー\"\n    }\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3580,
      "y": 760,
      "wires": [
        [
          "63ded30d.99a9ec",
          "bebc0141.8078a"
        ]
      ]
    },
    {
      "id": "63ded30d.99a9ec",
      "type": "subflow:84c49712.df4df8",
      "z": "3c319ef6.6e76e2",
      "x": 3820,
      "y": 760,
      "wires": []
    },
    {
      "id": "56a7e236.d6f18c",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "rules": [
        {
          "t": "set",
          "p": "data",
          "pt": "msg",
          "to": "msg.payload.rows.value",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "i",
          "pt": "msg",
          "to": "0",
          "tot": "str"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 3500,
      "y": 880,
      "wires": [
        [
          "40fb03e4.0d5aec",
          "c4cfdc4f.35955"
        ]
      ]
    },
    {
      "id": "40fb03e4.0d5aec",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "true",
      "x": 3710,
      "y": 880,
      "wires": []
    },
    {
      "id": "c4cfdc4f.35955",
      "type": "function",
      "z": "3c319ef6.6e76e2",
      "name": "divide array per ADD_QUERY_MULTIPLICITY",
      "func": "if (!msg.data) {\n    msg.data = null;\n    \n} else {\n    \n    //配列判定\n    if (!(Object.prototype.toString.call(msg.data) === \"[object Array]\")) {\n        msg.data = [ msg.data ];\n    }\n\n    const PAGE_SIZE = context.global.Const.ADD_QUERY_MULTIPLICITY;\n    var rowsLength = msg.data.length;\n    var rows = msg.data;\n    \n    var list = [];\n    var pageCount = Math.floor(rowsLength / PAGE_SIZE);\n    var remainder = rowsLength % PAGE_SIZE;\n    \n    for (var p=0; p < pageCount; p++) {\n        var docs = [];\n        for (var i=p*PAGE_SIZE; i < p*PAGE_SIZE+PAGE_SIZE; i++) {\n            docs.push(rows[i]);\n        }\n        list[p] = docs;\n    }\n    if (remainder > 0) {\n        var docs = [];\n        for (var i=pageCount*PAGE_SIZE; i < pageCount*PAGE_SIZE+remainder; i++) {\n            docs.push(rows[i]);\n        }\n        list[pageCount] = docs;\n    }\n    \n    msg.data = list;\n}\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3620,
      "y": 940,
      "wires": [
        [
          "b7b18ca8.4b888"
        ]
      ]
    },
    {
      "id": "b7b18ca8.4b888",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "msg.data is null?",
      "property": "data",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3930,
      "y": 940,
      "wires": [
        [
          "ff8dbac2.90c398",
          "fddc231a.0204e"
        ],
        [
          "d6d513d3.f2dfa"
        ]
      ]
    },
    {
      "id": "d6d513d3.f2dfa",
      "type": "function",
      "z": "3c319ef6.6e76e2",
      "name": "msg.data[msg.i++]",
      "func": "\nmsg.payload = msg.data[msg.i++];\nmsg.target = msg.payload;\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3990,
      "y": 1040,
      "wires": [
        [
          "75038336.41e42c",
          "4e4c7ee3.7f70f"
        ]
      ]
    },
    {
      "id": "4e4c7ee3.7f70f",
      "type": "delay",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "pauseType": "delay",
      "timeout": "3",
      "timeoutUnits": "seconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 4220,
      "y": 1040,
      "wires": [
        [
          "5d3bdef5.30a57"
        ]
      ]
    },
    {
      "id": "324a1fcc.1c297",
      "type": "comment",
      "z": "3c319ef6.6e76e2",
      "name": "QueryAdd, ExampleAdd",
      "info": "",
      "x": 3620,
      "y": 1220,
      "wires": []
    },
    {
      "id": "5d3bdef5.30a57",
      "type": "function",
      "z": "3c319ef6.6e76e2",
      "name": "post request ※Async",
      "func": "request = context.global.Request;\nasync = context.global.Async;\n\nconst auth = \n{\n    user: context.global.CredentialInfo.username,\n    password: context.global.CredentialInfo.password\n}\n\nfunction addQuery(data, callback) {\n\n    var bodyContent = {\n      natural_language_query: data.question,\n      examples: [\n        {\n          document_id: data.id,\n          relevance: 10//data.relevance\n        }\n      ]\n    }\n\n    //オプションを定義\n    var options = {\n      url: context.global.Apis.Discovery.ADD_QUERY,\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      auth: auth,\n      json: true,\n      body: bodyContent\n    }\n    \n    // リクエスト送信\n    request.post(options, function (error, response, body) {\n        callback(error, response, body);\n    });\n\n}\n\nfunction addExample(data, query_id, callback) {\n\n    var bodyContent = {\n          document_id: data.id,\n          relevance: 10///data.relevance\n    }\n\n    var url = context.global.Apis.Discovery.ADD_EXAMPLE;\n    url = url.replace(/\\{QUERY_ID\\}/, query_id);\n\n    //オプションを定義\n    var options = {\n      url: url,\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      auth: auth,\n      json: true,\n      body: bodyContent\n    }\n    \n    // リクエスト送信\n    request.post(options, function (error, response, body) {\n        callback(error, response, body);\n    });\n\n}\n\nmsg.body = null;\nmsg.errorCount = 0;\nvar count = 0;\n\nasync.each(msg.target, function(data, next) {\n    addQuery(data, function (error, response, body) {\n        if (error) {\n            msg.errorCount++;\n            next();\n        } else {\n            if (body.code === 409) {\n                \n                query_id = body.error.match(/\\|\\|'\\sid\\s(.*)\\salready\\sexists\\sin/)[1];\n                \n                addExample(data, query_id, function(error, response, body) {\n                    if (error) {\n                        msg.errorCount++;\n                        next();\n                    } else {\n                        count++;\n                        next();\n                    }\n                });\n                \n            } else {\n                count++;\n                next();\n            }\n        }\n    });\n    \n}, function complete(err) {\n    if (err) {\n        msg.body = \"ERROR \"+count;\n    } else {\n        msg.body = \"OK \"+count;\n    }\n});\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 3620,
      "y": 1260,
      "wires": [
        [
          "3dd20bde.759214"
        ]
      ]
    },
    {
      "id": "3dd20bde.759214",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "property": "body",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 3850,
      "y": 1260,
      "wires": [
        [
          "25c83dc9.012242"
        ],
        [
          "c3f5564a.d80708",
          "c1685fa1.79fbd",
          "6dff6e7b.8f855",
          "4729cb21.7ad934"
        ]
      ]
    },
    {
      "id": "c3f5564a.d80708",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "errorCount",
      "x": 4060,
      "y": 1340,
      "wires": []
    },
    {
      "id": "25c83dc9.012242",
      "type": "delay",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "pauseType": "delay",
      "timeout": "500",
      "timeoutUnits": "milliseconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 3870,
      "y": 1200,
      "wires": [
        [
          "3dd20bde.759214"
        ]
      ]
    },
    {
      "id": "220a8588.f4afba",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "property": "i",
      "propertyType": "msg",
      "rules": [
        {
          "t": "lt",
          "v": "data.length",
          "vt": "msg"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 4430,
      "y": 1300,
      "wires": [
        [
          "163a80fe.59323f",
          "d6d513d3.f2dfa"
        ],
        [
          "b3d12792.72b548",
          "dd119340.50d14",
          "72a3b06d.7687"
        ]
      ]
    },
    {
      "id": "b3d12792.72b548",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "i",
      "x": 4630,
      "y": 1300,
      "wires": []
    },
    {
      "id": "163a80fe.59323f",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "i",
      "x": 4630,
      "y": 1260,
      "wires": []
    },
    {
      "id": "75038336.41e42c",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "payload",
      "x": 4230,
      "y": 1000,
      "wires": []
    },
    {
      "id": "ff8dbac2.90c398",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "train",
      "rules": [
        {
          "t": "set",
          "p": "apiType",
          "pt": "msg",
          "to": "train",
          "tot": "str"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4170,
      "y": 920,
      "wires": [
        [
          "71e31a2e.c2c5b4"
        ]
      ]
    },
    {
      "id": "71e31a2e.c2c5b4",
      "type": "subflow:60894a16.3cd484",
      "z": "3c319ef6.6e76e2",
      "x": 4340,
      "y": 920,
      "wires": []
    },
    {
      "id": "fddc231a.0204e",
      "type": "subflow:84c49712.df4df8",
      "z": "3c319ef6.6e76e2",
      "x": 4200,
      "y": 880,
      "wires": []
    },
    {
      "id": "c1685fa1.79fbd",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "body",
      "x": 4040,
      "y": 1380,
      "wires": []
    },
    {
      "id": "eb7792bd.9b141",
      "type": "debug",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "body",
      "x": 2380,
      "y": 1260,
      "wires": []
    },
    {
      "id": "c1a7f73c.6f1778",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "statusCode is 200-204?",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "204",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1170,
      "y": 840,
      "wires": [
        [
          "8971d6f.ce6e828"
        ],
        [
          "495901b1.72333",
          "956271aa.5d236"
        ]
      ]
    },
    {
      "id": "609267f5.ab9d08",
      "type": "http in",
      "z": "3c319ef6.6e76e2",
      "name": "削除要求",
      "url": "/api/v1/train",
      "method": "delete",
      "upload": false,
      "swaggerDoc": "",
      "x": 80,
      "y": 480,
      "wires": [
        [
          "34c440a5.18804",
          "bef2ceea.c1452"
        ]
      ]
    },
    {
      "id": "a1a30ffb.780f6",
      "type": "function",
      "z": "3c319ef6.6e76e2",
      "name": "DSC Query削除応答",
      "func": "msg.payload = {\n    \"result\": \"success\",\n    \"message\": {\n        status: msg.statusCode,\n        action: \"Discovery Query削除処理を受け付けました。\"\n    }\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 1460,
      "y": 620,
      "wires": [
        [
          "527f5ef.a1bcea",
          "3fbefe0e.709882"
        ]
      ]
    },
    {
      "id": "8971d6f.ce6e828",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "POST ?",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "DELETE",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1420,
      "y": 820,
      "wires": [
        [
          "ac6b405f.38507"
        ],
        [
          "43ac412d.59d5f"
        ]
      ]
    },
    {
      "id": "1c5efc71.ccf304",
      "type": "comment",
      "z": "3c319ef6.6e76e2",
      "name": "Discovery学習データ削除",
      "info": "",
      "x": 990,
      "y": 480,
      "wires": []
    },
    {
      "id": "8cf55490.bf5b88",
      "type": "comment",
      "z": "3c319ef6.6e76e2",
      "name": "エラー発生時処理",
      "info": "",
      "x": 2410,
      "y": 1100,
      "wires": []
    },
    {
      "id": "bc29d720.3e2c88",
      "type": "comment",
      "z": "3c319ef6.6e76e2",
      "name": "エラー発生時処理",
      "info": "",
      "x": 4070,
      "y": 1220,
      "wires": []
    },
    {
      "id": "686c7080.b6a81",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "msg.errorCount = 0 ?",
      "property": "errorCount",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "0",
          "vt": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2420,
      "y": 1180,
      "wires": [
        [
          "e84bf215.7b7df"
        ],
        [
          "e34e1b4a.8c93c8"
        ]
      ]
    },
    {
      "id": "6dff6e7b.8f855",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "msg.errorCount = 0 ?",
      "property": "errorCount",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "0",
          "vt": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 4080,
      "y": 1300,
      "wires": [
        [
          "220a8588.f4afba"
        ],
        [
          "3b9aec5e.49a944"
        ]
      ]
    },
    {
      "id": "4729cb21.7ad934",
      "type": "subflow:84c49712.df4df8",
      "z": "3c319ef6.6e76e2",
      "x": 4060,
      "y": 1260,
      "wires": []
    },
    {
      "id": "b20ba3bb.17ab",
      "type": "subflow:84c49712.df4df8",
      "z": "3c319ef6.6e76e2",
      "x": 2400,
      "y": 1140,
      "wires": []
    },
    {
      "id": "5a468a26.5bc004",
      "type": "subflow:664cefa1.09a55",
      "z": "3c319ef6.6e76e2",
      "x": 960,
      "y": 520,
      "wires": []
    },
    {
      "id": "7d7b68d9.789348",
      "type": "comment",
      "z": "3c319ef6.6e76e2",
      "name": "エラー発生時処理",
      "info": "",
      "x": 1470,
      "y": 940,
      "wires": []
    },
    {
      "id": "495901b1.72333",
      "type": "subflow:84c49712.df4df8",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "x": 1460,
      "y": 980,
      "wires": []
    },
    {
      "id": "e02d64b0.434d18",
      "type": "switch",
      "z": "3c319ef6.6e76e2",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "DELETE",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 1200,
      "y": 720,
      "wires": [
        [
          "532a7ab6.c7e054"
        ],
        [
          "a1a30ffb.780f6",
          "532a7ab6.c7e054"
        ]
      ]
    },
    {
      "id": "43ac412d.59d5f",
      "type": "subflow:84c49712.df4df8",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "x": 1640,
      "y": 820,
      "wires": []
    },
    {
      "id": "ac6b405f.38507",
      "type": "delay",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "pauseType": "delay",
      "timeout": "20",
      "timeoutUnits": "seconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 1620,
      "y": 780,
      "wires": [
        [
          "8d7834a3.2ce688"
        ]
      ]
    },
    {
      "id": "a3775f82.d8c86",
      "type": "comment",
      "z": "3c319ef6.6e76e2",
      "name": "query全削除後のウエイトは必要",
      "info": "",
      "x": 1690,
      "y": 740,
      "wires": []
    },
    {
      "id": "eca7bae7.44d2d8",
      "type": "delay",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "pauseType": "delay",
      "timeout": "5",
      "timeoutUnits": "seconds",
      "rate": "1",
      "nbRateUnits": "1",
      "rateUnits": "second",
      "randomFirst": "1",
      "randomLast": "5",
      "randomUnits": "seconds",
      "drop": false,
      "x": 2740,
      "y": 780,
      "wires": [
        [
          "be6fd519.05d5d8"
        ]
      ]
    },
    {
      "id": "bd272f12.2cde1",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(20) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 290,
      "y": 100,
      "wires": [
        [
          "6812095.683eaf8"
        ]
      ]
    },
    {
      "id": "6812095.683eaf8",
      "type": "subflow:c505c6cd.aad308",
      "z": "3c319ef6.6e76e2",
      "x": 440,
      "y": 100,
      "wires": []
    },
    {
      "id": "bef2ceea.c1452",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(22) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 270,
      "y": 480,
      "wires": [
        [
          "b79ecfff.8564a"
        ]
      ]
    },
    {
      "id": "b79ecfff.8564a",
      "type": "subflow:c505c6cd.aad308",
      "z": "3c319ef6.6e76e2",
      "x": 420,
      "y": 480,
      "wires": []
    },
    {
      "id": "7c08a709.71ed78",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(20/22) Common parameters error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1300,
      "y": 20,
      "wires": [
        [
          "a0279dc3.3ad3a"
        ]
      ]
    },
    {
      "id": "a0279dc3.3ad3a",
      "type": "subflow:c505c6cd.aad308",
      "z": "3c319ef6.6e76e2",
      "x": 1480,
      "y": 20,
      "wires": []
    },
    {
      "id": "ef4bba6e.dd6838",
      "type": "http response",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 1930,
      "y": 180,
      "wires": []
    },
    {
      "id": "9d73f198.0b022",
      "type": "http response",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 1270,
      "y": 60,
      "wires": []
    },
    {
      "id": "697b478c.046228",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(20) Cloudant fb_doc data select error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1960,
      "y": 140,
      "wires": [
        [
          "58663ce.b5173c4"
        ]
      ]
    },
    {
      "id": "58663ce.b5173c4",
      "type": "subflow:c505c6cd.aad308",
      "z": "3c319ef6.6e76e2",
      "x": 2140,
      "y": 140,
      "wires": []
    },
    {
      "id": "af96a5b2.770b78",
      "type": "http response",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 1850,
      "y": 280,
      "wires": []
    },
    {
      "id": "df1ad55b.b2e848",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(20) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1870,
      "y": 240,
      "wires": [
        [
          "4629f5dc.0b777c"
        ]
      ]
    },
    {
      "id": "4629f5dc.0b777c",
      "type": "subflow:c505c6cd.aad308",
      "z": "3c319ef6.6e76e2",
      "x": 2020,
      "y": 240,
      "wires": []
    },
    {
      "id": "956271aa.5d236",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(20/22) DEL_ALL_QUERY Error.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1460,
      "y": 1020,
      "wires": [
        [
          "227aaa24.b0d156"
        ]
      ]
    },
    {
      "id": "227aaa24.b0d156",
      "type": "subflow:c505c6cd.aad308",
      "z": "3c319ef6.6e76e2",
      "x": 1640,
      "y": 1020,
      "wires": []
    },
    {
      "id": "3fbefe0e.709882",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(22) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1670,
      "y": 580,
      "wires": [
        [
          "3d2775bb.5d96ca"
        ]
      ]
    },
    {
      "id": "3d2775bb.5d96ca",
      "type": "subflow:c505c6cd.aad308",
      "z": "3c319ef6.6e76e2",
      "x": 1820,
      "y": 580,
      "wires": []
    },
    {
      "id": "527f5ef.a1bcea",
      "type": "http response",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "statusCode": "",
      "headers": {},
      "x": 1650,
      "y": 620,
      "wires": []
    },
    {
      "id": "e34e1b4a.8c93c8",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(20) ADD_QUERY(FB) Error.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2640,
      "y": 1180,
      "wires": [
        [
          "6273152.d01b1ec"
        ]
      ]
    },
    {
      "id": "6273152.d01b1ec",
      "type": "subflow:c505c6cd.aad308",
      "z": "3c319ef6.6e76e2",
      "x": 2820,
      "y": 1180,
      "wires": []
    },
    {
      "id": "bebc0141.8078a",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(20) Cloudantデータ取得error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 3820,
      "y": 720,
      "wires": [
        [
          "ccd55ad6.bb9b08"
        ]
      ]
    },
    {
      "id": "ccd55ad6.bb9b08",
      "type": "subflow:c505c6cd.aad308",
      "z": "3c319ef6.6e76e2",
      "x": 4000,
      "y": 720,
      "wires": []
    },
    {
      "id": "3b9aec5e.49a944",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(20) ADD_QUERY(FAQ) Error.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 4280,
      "y": 1360,
      "wires": [
        [
          "8f79c7bf.4755a8"
        ]
      ]
    },
    {
      "id": "8f79c7bf.4755a8",
      "type": "subflow:c505c6cd.aad308",
      "z": "3c319ef6.6e76e2",
      "x": 4440,
      "y": 1360,
      "wires": []
    },
    {
      "id": "171caac2.710dc5",
      "type": "change",
      "z": "60894a16.3cd484",
      "name": "LOG_API",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "api",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "apiType",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 840,
      "y": 280,
      "wires": [
        [
          "1d7db65f.f56f3a"
        ]
      ]
    },
    {
      "id": "1d7db65f.f56f3a",
      "type": "subflow:c505c6cd.aad308",
      "z": "60894a16.3cd484",
      "x": 1000,
      "y": 280,
      "wires": []
    },
    {
      "id": "86cc2d59.4509f",
      "type": "change",
      "z": "ecf7cb7a.f7b568",
      "name": "LIST_QUERY_NOTICES",
      "rules": [
        {
          "t": "set",
          "p": "CredentialInfo",
          "pt": "msg",
          "to": "CredentialInfo",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.LIST_QUERY_NOTICES",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 370,
      "y": 386,
      "wires": [
        [
          "2260c90a.38b766"
        ]
      ]
    },
    {
      "id": "220d7bc3.027364",
      "type": "inject",
      "z": "ecf7cb7a.f7b568",
      "name": "学習データNotices確認",
      "topic": "",
      "payload": "",
      "payloadType": "date",
      "repeat": "",
      "crontab": "",
      "once": false,
      "x": 140,
      "y": 386,
      "wires": [
        [
          "86cc2d59.4509f"
        ]
      ]
    },
    {
      "id": "2260c90a.38b766",
      "type": "http request",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 610,
      "y": 386,
      "wires": [
        [
          "dfbb534b.09129"
        ]
      ]
    },
    {
      "id": "c0d38e8.0b6397",
      "type": "debug",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "payload",
      "x": 970,
      "y": 382,
      "wires": []
    },
    {
      "id": "dfbb534b.09129",
      "type": "change",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "rules": [
        {
          "t": "set",
          "p": "payload",
          "pt": "msg",
          "to": "payload.results.notices",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 800,
      "y": 382,
      "wires": [
        [
          "c0d38e8.0b6397"
        ]
      ]
    },
    {
      "id": "1f665966.10eb57",
      "type": "http in",
      "z": "b6daf329.b5ff58",
      "name": "トレーニングステータス",
      "url": "/api/v1/train",
      "method": "get",
      "upload": false,
      "swaggerDoc": "",
      "x": 150,
      "y": 71,
      "wires": [
        [
          "80ab8ba9.561c68",
          "b309f39c.9d53b"
        ]
      ]
    },
    {
      "id": "80ab8ba9.561c68",
      "type": "change",
      "z": "b6daf329.b5ff58",
      "name": "メソッド設定",
      "rules": [
        {
          "t": "set",
          "p": "common.method",
          "pt": "msg",
          "to": "req.method",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 120,
      "y": 131,
      "wires": [
        [
          "6071e406.8553cc"
        ]
      ]
    },
    {
      "id": "6071e406.8553cc",
      "type": "function",
      "z": "b6daf329.b5ff58",
      "name": "共通パラメータチェック",
      "func": "/*\nvar errorFlag = true;\n\nif (errorFlag) {\n    //CHECK APIKEY\n    errorFlag = context.global.commonFunction.checkAPIKey();\n    // errorFlag = context.global.commonFunction.checkAPIKey(msg, context);\n}\n\nif (errorFlag) {\n    //CHECK USER\n    errorFlag = context.global.commonFunction.checkUser();\n    // errorFlag = context.global.commonFunction.checkUser(msg, context);\n}\n*/\n\ncontext.global.Util.checkAPIKeyAndUser(msg);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 150,
      "y": 191,
      "wires": [
        [
          "e304460a.ce30b8"
        ]
      ]
    },
    {
      "id": "e304460a.ce30b8",
      "type": "switch",
      "z": "b6daf329.b5ff58",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "ERROR",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "GET",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 120,
      "y": 271,
      "wires": [
        [
          "6053b3c2.2ea94c",
          "ab71741e.a8a328"
        ],
        [
          "e5d3300f.610b2"
        ]
      ]
    },
    {
      "id": "6053b3c2.2ea94c",
      "type": "function",
      "z": "b6daf329.b5ff58",
      "name": "共通パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: msg.common.errorMessage };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 430,
      "y": 271,
      "wires": [
        [
          "785bc80b.307408"
        ]
      ]
    },
    {
      "id": "785bc80b.307408",
      "type": "http response",
      "z": "b6daf329.b5ff58",
      "name": "応答",
      "x": 650,
      "y": 271,
      "wires": []
    },
    {
      "id": "f994863d.9d2fd8",
      "type": "http request",
      "z": "b6daf329.b5ff58",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 110,
      "y": 411,
      "wires": [
        [
          "ccf75b1a.3e6528",
          "4378bed4.05613"
        ]
      ]
    },
    {
      "id": "ccf75b1a.3e6528",
      "type": "debug",
      "z": "b6daf329.b5ff58",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "true",
      "x": 290,
      "y": 411,
      "wires": []
    },
    {
      "id": "4378bed4.05613",
      "type": "switch",
      "z": "b6daf329.b5ff58",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 110,
      "y": 491,
      "wires": [
        [
          "7b2a9a04.ebb2d4"
        ],
        [
          "30b2d1c.289552e"
        ]
      ]
    },
    {
      "id": "30b2d1c.289552e",
      "type": "function",
      "z": "b6daf329.b5ff58",
      "name": "エラー応答",
      "func": "msg.payload = {\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 290,
      "y": 511,
      "wires": [
        [
          "7d3eaa83.574a94",
          "2fcecee8.c805d2"
        ]
      ]
    },
    {
      "id": "7d3eaa83.574a94",
      "type": "http response",
      "z": "b6daf329.b5ff58",
      "name": "応答",
      "x": 490,
      "y": 511,
      "wires": []
    },
    {
      "id": "7b2a9a04.ebb2d4",
      "type": "function",
      "z": "b6daf329.b5ff58",
      "name": "作成応答",
      "func": "msg.statusCode = '200';\nmsg.tmp = msg.payload;\nmsg.payload = {\n    result: \"success\",\n    message: {\n        document_counts: msg.payload.document_counts,\n        training_status: msg.payload.training_status\n    }\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 100,
      "y": 611,
      "wires": [
        [
          "24f64f5b.0e036",
          "76f2ff1.cb88a"
        ]
      ]
    },
    {
      "id": "24f64f5b.0e036",
      "type": "http response",
      "z": "b6daf329.b5ff58",
      "name": "応答",
      "x": 250,
      "y": 611,
      "wires": []
    },
    {
      "id": "e5d3300f.610b2",
      "type": "change",
      "z": "b6daf329.b5ff58",
      "name": "変数設定",
      "rules": [
        {
          "t": "set",
          "p": "CredentialInfo",
          "pt": "msg",
          "to": "CredentialInfo",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.LIST_COLLECTION_DETAIL",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 100,
      "y": 331,
      "wires": [
        [
          "f994863d.9d2fd8"
        ]
      ]
    },
    {
      "id": "b309f39c.9d53b",
      "type": "change",
      "z": "b6daf329.b5ff58",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(21) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 403,
      "y": 72,
      "wires": [
        [
          "480a730f.88e79c"
        ]
      ]
    },
    {
      "id": "480a730f.88e79c",
      "type": "subflow:c505c6cd.aad308",
      "z": "b6daf329.b5ff58",
      "x": 553,
      "y": 72,
      "wires": []
    },
    {
      "id": "ab71741e.a8a328",
      "type": "change",
      "z": "b6daf329.b5ff58",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(21) Common parameters error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 360,
      "y": 235,
      "wires": [
        [
          "6ad38013.ab7d6"
        ]
      ]
    },
    {
      "id": "6ad38013.ab7d6",
      "type": "subflow:c505c6cd.aad308",
      "z": "b6daf329.b5ff58",
      "x": 540,
      "y": 235,
      "wires": []
    },
    {
      "id": "2fcecee8.c805d2",
      "type": "change",
      "z": "b6daf329.b5ff58",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(21) change error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 520,
      "y": 470,
      "wires": [
        [
          "125623b3.c7fc5c"
        ]
      ]
    },
    {
      "id": "125623b3.c7fc5c",
      "type": "subflow:c505c6cd.aad308",
      "z": "b6daf329.b5ff58",
      "x": 700,
      "y": 470,
      "wires": []
    },
    {
      "id": "76f2ff1.cb88a",
      "type": "change",
      "z": "b6daf329.b5ff58",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(21) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 270,
      "y": 654,
      "wires": [
        [
          "b462034.fe49b"
        ]
      ]
    },
    {
      "id": "b462034.fe49b",
      "type": "subflow:c505c6cd.aad308",
      "z": "b6daf329.b5ff58",
      "x": 420,
      "y": 654,
      "wires": []
    },
    {
      "id": "38e57b5d.fc3cf4",
      "type": "http in",
      "z": "f290c459.175828",
      "name": "検索",
      "url": "/api/v1/faq",
      "method": "post",
      "upload": false,
      "swaggerDoc": "",
      "x": 90,
      "y": 72,
      "wires": [
        [
          "60a714c0.7be52c",
          "559fc9b9.e80898"
        ]
      ]
    },
    {
      "id": "fb31712c.f48e",
      "type": "function",
      "z": "f290c459.175828",
      "name": "共通パラメータチェック",
      "func": "/*\nvar errorFlag = true;\n\nif (errorFlag) {\n    //CHECK APIKEY\n    errorFlag = context.global.commonFunction.checkAPIKey();\n}\n\nif (errorFlag) {\n    //CHECK USER\n    errorFlag = context.global.commonFunction.checkUser();\n}\n*/\n\ncontext.global.Util.checkAPIKeyAndUser(msg);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 150,
      "y": 192,
      "wires": [
        [
          "76f92682.3bddb8"
        ]
      ]
    },
    {
      "id": "60a714c0.7be52c",
      "type": "change",
      "z": "f290c459.175828",
      "name": "メソッド設定",
      "rules": [
        {
          "t": "set",
          "p": "common.method",
          "pt": "msg",
          "to": "req.method",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 120,
      "y": 132,
      "wires": [
        [
          "fb31712c.f48e"
        ]
      ]
    },
    {
      "id": "1392b722.f39da9",
      "type": "function",
      "z": "f290c459.175828",
      "name": "共通パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: msg.common.errorMessage };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 410,
      "y": 272,
      "wires": [
        [
          "c07f358.bbaa8c8"
        ]
      ]
    },
    {
      "id": "76f92682.3bddb8",
      "type": "switch",
      "z": "f290c459.175828",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "ERROR",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 120,
      "y": 292,
      "wires": [
        [
          "1392b722.f39da9",
          "2e233c68.f3c434"
        ],
        [
          "f50b7f48.3620a"
        ]
      ]
    },
    {
      "id": "c07f358.bbaa8c8",
      "type": "http response",
      "z": "f290c459.175828",
      "name": "応答",
      "x": 630,
      "y": 272,
      "wires": []
    },
    {
      "id": "f50b7f48.3620a",
      "type": "switch",
      "z": "f290c459.175828",
      "name": "初回アクセス判定",
      "property": "payload.talk",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "first",
          "vt": "str"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 130,
      "y": 372,
      "wires": [
        [
          "3afb6bac.927c64"
        ],
        [
          "84476441.ae5ee8"
        ]
      ]
    },
    {
      "id": "3afb6bac.927c64",
      "type": "function",
      "z": "f290c459.175828",
      "name": "初回返信",
      "func": "//初期返信MSGの設定\nmsg.statusCode = '200';\nvar result = {\n    'result' : 'success',\n    'message' :{\n        'resCategory' : 'START',\n        'resMessage' : 'なにかお困りでしょうか？',\n        'body' : ''\n    }\n};\n\n\nmsg.payload = result;\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 320,
      "y": 352,
      "wires": [
        [
          "ca0e2907.40ba68",
          "31132fbd.68d46"
        ]
      ]
    },
    {
      "id": "ca0e2907.40ba68",
      "type": "debug",
      "z": "f290c459.175828",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "payload",
      "x": 510,
      "y": 392,
      "wires": []
    },
    {
      "id": "31132fbd.68d46",
      "type": "http response",
      "z": "f290c459.175828",
      "name": "応答",
      "statusCode": "",
      "headers": {},
      "x": 490,
      "y": 352,
      "wires": []
    },
    {
      "id": "84476441.ae5ee8",
      "type": "change",
      "z": "f290c459.175828",
      "name": "変数設定",
      "rules": [
        {
          "t": "set",
          "p": "CredentialInfo",
          "pt": "msg",
          "to": "CredentialInfo",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.SEARCH",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 100,
      "y": 432,
      "wires": [
        [
          "3f5a2a11.78a106",
          "ab92b143.2dc39"
        ]
      ]
    },
    {
      "id": "3f5a2a11.78a106",
      "type": "debug",
      "z": "f290c459.175828",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "payload",
      "x": 410,
      "y": 432,
      "wires": []
    },
    {
      "id": "b1726211.b8661",
      "type": "switch",
      "z": "f290c459.175828",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 110,
      "y": 772,
      "wires": [
        [
          "9d59c72a.e13408"
        ],
        [
          "2cce9088.40a31"
        ]
      ]
    },
    {
      "id": "16845732.b44829",
      "type": "http request",
      "z": "f290c459.175828",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 110,
      "y": 552,
      "wires": [
        [
          "b1726211.b8661",
          "3212f7fe.396398",
          "d3178a2f.1bdb68"
        ]
      ]
    },
    {
      "id": "2cce9088.40a31",
      "type": "function",
      "z": "f290c459.175828",
      "name": "Discovery接続エラー",
      "func": "msg.payload = {\n    \"result\": \"failure\",\n    \"message\": {\n        status: msg.statusCode,\n        action: \"Discovery connection error\"\n    }\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 340,
      "y": 832,
      "wires": [
        [
          "75c9b8ba.c512a8",
          "5867d649.156ff8"
        ]
      ]
    },
    {
      "id": "75c9b8ba.c512a8",
      "type": "http response",
      "z": "f290c459.175828",
      "name": "応答",
      "x": 530,
      "y": 832,
      "wires": []
    },
    {
      "id": "ab92b143.2dc39",
      "type": "function",
      "z": "f290c459.175828",
      "name": "URLへ検索文章",
      "func": "msg.url = msg.url +  encodeURIComponent(msg.payload.talk)\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 120,
      "y": 492,
      "wires": [
        [
          "16845732.b44829"
        ]
      ]
    },
    {
      "id": "3212f7fe.396398",
      "type": "debug",
      "z": "f290c459.175828",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "payload",
      "x": 330,
      "y": 512,
      "wires": []
    },
    {
      "id": "704ec1e9.a5156",
      "type": "function",
      "z": "f290c459.175828",
      "name": "回答なし",
      "func": "// 返信MSG設定\nmsg.statusCode = '200';\nvar result = {\n    'result' : 'success',\n    'message' :{\n        'resCategory' : 'NO_ANSWER',\n        'resMessage' : 'すみません、回答がみつかりませんでした。',\n        'body' : ''\n    }\n};\n\n\nmsg.payload = result;\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 500,
      "y": 672,
      "wires": [
        [
          "ba665e8f.82867",
          "5a6606f4.6ec338"
        ]
      ]
    },
    {
      "id": "9918294d.b4fa88",
      "type": "function",
      "z": "f290c459.175828",
      "name": "回答あり",
      "func": "// 返信MSG設定\nmsg.statusCode = '200';\nmsg.tmp = msg.payload;\nmsg.payload = {\n    'result' : 'success',\n    'message' :{\n        'resCategory' : 'ANSWER',\n        'resMessage' : '回答有り',\n        'body' : {\n           'docs': msg.tmp.results\n        }\n    }\n};\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 500,
      "y": 752,
      "wires": [
        [
          "9698b914.5c73b8",
          "5a6606f4.6ec338"
        ]
      ]
    },
    {
      "id": "9d59c72a.e13408",
      "type": "switch",
      "z": "f290c459.175828",
      "name": "回答有無判定",
      "property": "payload.matching_results",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "0",
          "vt": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 320,
      "y": 732,
      "wires": [
        [
          "704ec1e9.a5156"
        ],
        [
          "9918294d.b4fa88"
        ]
      ]
    },
    {
      "id": "ba665e8f.82867",
      "type": "http response",
      "z": "f290c459.175828",
      "name": "応答",
      "x": 650,
      "y": 672,
      "wires": []
    },
    {
      "id": "9698b914.5c73b8",
      "type": "http response",
      "z": "f290c459.175828",
      "name": "応答",
      "x": 650,
      "y": 752,
      "wires": []
    },
    {
      "id": "d3178a2f.1bdb68",
      "type": "change",
      "z": "f290c459.175828",
      "name": "search",
      "rules": [
        {
          "t": "set",
          "p": "apiType",
          "pt": "msg",
          "to": "search",
          "tot": "str"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 530,
      "y": 552,
      "wires": [
        [
          "ff7c5abe.f94238"
        ]
      ]
    },
    {
      "id": "559fc9b9.e80898",
      "type": "change",
      "z": "f290c459.175828",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(1) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 328,
      "y": 73,
      "wires": [
        [
          "25c9c81d.cda928"
        ]
      ]
    },
    {
      "id": "25c9c81d.cda928",
      "type": "subflow:c505c6cd.aad308",
      "z": "f290c459.175828",
      "x": 478,
      "y": 73,
      "wires": []
    },
    {
      "id": "5a6606f4.6ec338",
      "type": "change",
      "z": "f290c459.175828",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(1) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 670,
      "y": 710,
      "wires": [
        [
          "4b4411e4.552c3"
        ]
      ]
    },
    {
      "id": "4b4411e4.552c3",
      "type": "subflow:c505c6cd.aad308",
      "z": "f290c459.175828",
      "x": 820,
      "y": 710,
      "wires": []
    },
    {
      "id": "2e233c68.f3c434",
      "type": "change",
      "z": "f290c459.175828",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(1) Common parameters error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 340,
      "y": 237,
      "wires": [
        [
          "66a8f4fe.9bc8dc"
        ]
      ]
    },
    {
      "id": "66a8f4fe.9bc8dc",
      "type": "subflow:c505c6cd.aad308",
      "z": "f290c459.175828",
      "x": 500,
      "y": 238,
      "wires": []
    },
    {
      "id": "5867d649.156ff8",
      "type": "change",
      "z": "f290c459.175828",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(1) 検索error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 559,
      "y": 874,
      "wires": [
        [
          "2b17425.b07c2be"
        ]
      ]
    },
    {
      "id": "2b17425.b07c2be",
      "type": "subflow:c505c6cd.aad308",
      "z": "f290c459.175828",
      "x": 739,
      "y": 874,
      "wires": []
    },
    {
      "id": "ff7c5abe.f94238",
      "type": "subflow:60894a16.3cd484",
      "z": "f290c459.175828",
      "x": 700,
      "y": 552,
      "wires": []
    },
    {
      "id": "79973ffd.92a94",
      "type": "http in",
      "z": "a2571d82.682d6",
      "name": "フィードバック",
      "url": "/api/v1/feedback",
      "method": "post",
      "upload": false,
      "swaggerDoc": "",
      "x": 120,
      "y": 80,
      "wires": [
        [
          "e2f5f134.a4d0e",
          "db0a8203.cb351"
        ]
      ]
    },
    {
      "id": "e2f5f134.a4d0e",
      "type": "change",
      "z": "a2571d82.682d6",
      "name": "メソッド設定",
      "rules": [
        {
          "t": "set",
          "p": "common.method",
          "pt": "msg",
          "to": "req.method",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 120,
      "y": 140,
      "wires": [
        [
          "2688e77a.cc6658"
        ]
      ]
    },
    {
      "id": "2688e77a.cc6658",
      "type": "function",
      "z": "a2571d82.682d6",
      "name": "共通パラメータチェック",
      "func": "/*\nvar errorFlag = true;\n\nif (errorFlag) {\n    //CHECK APIKEY\n    errorFlag = context.global.commonFunction.checkAPIKey();\n}\n\nif (errorFlag) {\n    //CHECK USER\n    errorFlag = context.global.commonFunction.checkUser();\n}\n*/\n\ncontext.global.Util.checkAPIKeyAndUser(msg);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 150,
      "y": 200,
      "wires": [
        [
          "5b1f3c27.776344"
        ]
      ]
    },
    {
      "id": "5b1f3c27.776344",
      "type": "switch",
      "z": "a2571d82.682d6",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "ERROR",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "POST",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 120,
      "y": 300,
      "wires": [
        [
          "afd53a06.794108",
          "c765577b.d87808"
        ],
        [
          "33da37d2.13ca28"
        ]
      ]
    },
    {
      "id": "afd53a06.794108",
      "type": "function",
      "z": "a2571d82.682d6",
      "name": "共通パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: msg.common.errorMessage };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 410,
      "y": 280,
      "wires": [
        [
          "e4c8321.9af68d"
        ]
      ]
    },
    {
      "id": "e4c8321.9af68d",
      "type": "http response",
      "z": "a2571d82.682d6",
      "name": "応答",
      "x": 630,
      "y": 280,
      "wires": []
    },
    {
      "id": "b4621f2f.6e5b3",
      "type": "change",
      "z": "a2571d82.682d6",
      "name": "変数設定",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "POST",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.DOC_FB",
          "tot": "global"
        },
        {
          "t": "set",
          "p": "payload",
          "pt": "msg",
          "to": "postData",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 100,
      "y": 460,
      "wires": [
        [
          "b37491e4.5d2dd"
        ]
      ]
    },
    {
      "id": "b37491e4.5d2dd",
      "type": "http request",
      "z": "a2571d82.682d6",
      "name": "Cloudantデータ取得要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 150,
      "y": 520,
      "wires": [
        [
          "53e5cdd2.e72504",
          "f4d69f19.d9941"
        ]
      ]
    },
    {
      "id": "432f9679.9cc5a8",
      "type": "function",
      "z": "a2571d82.682d6",
      "name": "回答なし情報生成",
      "func": "var currentTimestampMili = context.global.Util.currentTimestampMili();\n\nmsg.postData = {\n  '_id' : currentTimestampMili+\"\",\n  'id' : currentTimestampMili+\"\",\n  'question' : msg.payload.qtext,\n    'answer': [{id: \"NoAnswer\", relevance: \"\"}],\n  'create_date' : context.global.Util.formatTimestamp(currentTimestampMili),\n  'modify_date' : context.global.Util.formatTimestamp(currentTimestampMili),\n  'flag' : 99,\n  'user' : msg.payload.user\n};\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 350,
      "y": 400,
      "wires": [
        [
          "b4621f2f.6e5b3",
          "6c50ae42.a0a0e"
        ]
      ]
    },
    {
      "id": "5d41bd61.6f6744",
      "type": "function",
      "z": "a2571d82.682d6",
      "name": "いいね情報生成",
      "func": "var currentTimestampMili = context.global.Util.currentTimestampMili();\n    \nmsg.postData = {\n    '_id': currentTimestampMili+\"\",\n    'id': currentTimestampMili+\"\",\n    'question': msg.payload.qtext,\n    'answer': [{id: msg.payload.docid, relevance: \"\"}],\n    'user': msg.payload.user,\n    'create_date': context.global.Util.formatTimestamp(currentTimestampMili),\n    'modify_date' : context.global.Util.formatTimestamp(currentTimestampMili),\n    'flag': 99\n};\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 340,
      "y": 360,
      "wires": [
        [
          "b4621f2f.6e5b3",
          "9200317e.7723b"
        ]
      ]
    },
    {
      "id": "33da37d2.13ca28",
      "type": "switch",
      "z": "a2571d82.682d6",
      "name": "フィード情報分岐",
      "property": "payload.emotion",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "Like",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "Sad",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 130,
      "y": 380,
      "wires": [
        [
          "5d41bd61.6f6744"
        ],
        [
          "432f9679.9cc5a8"
        ]
      ]
    },
    {
      "id": "7e5ec255.51984c",
      "type": "function",
      "z": "a2571d82.682d6",
      "name": "作成応答",
      "func": "msg.statusCode = '200';\nmsg.payload = {\n    result: \"success\",\n    message: msg.payload\n};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 300,
      "y": 580,
      "wires": [
        [
          "9515b7ea.8e9a78",
          "589979c7.6a4478"
        ]
      ]
    },
    {
      "id": "a7e40d49.77be5",
      "type": "function",
      "z": "a2571d82.682d6",
      "name": "作成エラー応答",
      "func": "msg.payload = {\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 320,
      "y": 700,
      "wires": [
        [
          "1940cace.4d5855",
          "3516d711.abef28"
        ]
      ]
    },
    {
      "id": "53e5cdd2.e72504",
      "type": "switch",
      "z": "a2571d82.682d6",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 110,
      "y": 640,
      "wires": [
        [
          "7e5ec255.51984c"
        ],
        [
          "a7e40d49.77be5"
        ]
      ]
    },
    {
      "id": "9515b7ea.8e9a78",
      "type": "http response",
      "z": "a2571d82.682d6",
      "name": "応答",
      "x": 450,
      "y": 580,
      "wires": []
    },
    {
      "id": "1940cace.4d5855",
      "type": "http response",
      "z": "a2571d82.682d6",
      "name": "応答",
      "x": 490,
      "y": 700,
      "wires": []
    },
    {
      "id": "f4d69f19.d9941",
      "type": "debug",
      "z": "a2571d82.682d6",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "true",
      "x": 390,
      "y": 520,
      "wires": []
    },
    {
      "id": "9200317e.7723b",
      "type": "change",
      "z": "a2571d82.682d6",
      "name": "answer",
      "rules": [
        {
          "t": "set",
          "p": "apiType",
          "pt": "msg",
          "to": "answer",
          "tot": "str"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 700,
      "y": 360,
      "wires": [
        [
          "a2bd092e.e6d3a8"
        ]
      ]
    },
    {
      "id": "6c50ae42.a0a0e",
      "type": "change",
      "z": "a2571d82.682d6",
      "name": "noanswer",
      "rules": [
        {
          "t": "set",
          "p": "apiType",
          "pt": "msg",
          "to": "noanswer",
          "tot": "str"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 700,
      "y": 400,
      "wires": [
        [
          "a2bd092e.e6d3a8"
        ]
      ]
    },
    {
      "id": "db0a8203.cb351",
      "type": "change",
      "z": "a2571d82.682d6",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(2) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 331,
      "y": 79,
      "wires": [
        [
          "fb44fc9.4af0e"
        ]
      ]
    },
    {
      "id": "fb44fc9.4af0e",
      "type": "subflow:c505c6cd.aad308",
      "z": "a2571d82.682d6",
      "x": 488,
      "y": 79,
      "wires": []
    },
    {
      "id": "589979c7.6a4478",
      "type": "change",
      "z": "a2571d82.682d6",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(2) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 469,
      "y": 620,
      "wires": [
        [
          "e8366f49.2368"
        ]
      ]
    },
    {
      "id": "e8366f49.2368",
      "type": "subflow:c505c6cd.aad308",
      "z": "a2571d82.682d6",
      "x": 626,
      "y": 620,
      "wires": []
    },
    {
      "id": "c765577b.d87808",
      "type": "change",
      "z": "a2571d82.682d6",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(2) Common parameters error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 341,
      "y": 246,
      "wires": [
        [
          "960ce978.1fb908"
        ]
      ]
    },
    {
      "id": "960ce978.1fb908",
      "type": "subflow:c505c6cd.aad308",
      "z": "a2571d82.682d6",
      "x": 501,
      "y": 247,
      "wires": []
    },
    {
      "id": "3516d711.abef28",
      "type": "change",
      "z": "a2571d82.682d6",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(2) creating error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 521,
      "y": 742,
      "wires": [
        [
          "872cbe0e.f6c13"
        ]
      ]
    },
    {
      "id": "872cbe0e.f6c13",
      "type": "subflow:c505c6cd.aad308",
      "z": "a2571d82.682d6",
      "x": 681,
      "y": 743,
      "wires": []
    },
    {
      "id": "a2bd092e.e6d3a8",
      "type": "subflow:60894a16.3cd484",
      "z": "a2571d82.682d6",
      "x": 878.75,
      "y": 375,
      "wires": []
    },
    {
      "id": "f1c63f82.d1cff",
      "type": "http in",
      "z": "c46ab181.bede",
      "name": "分析",
      "url": "/api/v1/analytics",
      "method": "get",
      "upload": false,
      "swaggerDoc": "",
      "x": 90,
      "y": 80,
      "wires": [
        [
          "223c67ab.0b1a88",
          "9dffa9ea.874b18"
        ]
      ]
    },
    {
      "id": "223c67ab.0b1a88",
      "type": "change",
      "z": "c46ab181.bede",
      "name": "メソッド設定",
      "rules": [
        {
          "t": "set",
          "p": "common.method",
          "pt": "msg",
          "to": "req.method",
          "tot": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 120,
      "y": 140,
      "wires": [
        [
          "9efb8a97.d07ad8"
        ]
      ]
    },
    {
      "id": "9efb8a97.d07ad8",
      "type": "function",
      "z": "c46ab181.bede",
      "name": "共通パラメータチェック",
      "func": "/*\nvar errorFlag = true;\n\nif (errorFlag) {\n    //CHECK APIKEY\n    errorFlag = context.global.commonFunction.checkAPIKey();\n}\n\nif (errorFlag) {\n    //CHECK USER\n    errorFlag = context.global.commonFunction.checkUser();\n}\n*/\n\ncontext.global.Util.checkAPIKeyAndUser(msg);\n\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 150,
      "y": 200,
      "wires": [
        [
          "15de4aca.a19b05"
        ]
      ]
    },
    {
      "id": "15de4aca.a19b05",
      "type": "switch",
      "z": "c46ab181.bede",
      "name": "メソッド分岐",
      "property": "common.method",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "ERROR",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "GET",
          "vt": "str"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 120,
      "y": 300,
      "wires": [
        [
          "dd9fd8c9.2740d8",
          "17b0b8fd.56dd77"
        ],
        [
          "777bdcac.a89354"
        ]
      ]
    },
    {
      "id": "dd9fd8c9.2740d8",
      "type": "function",
      "z": "c46ab181.bede",
      "name": "共通パラメータチェックエラー応答",
      "func": "msg.payload={ result: \"failure\", message: msg.common.errorMessage };\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 410,
      "y": 280,
      "wires": [
        [
          "a97269ae.118a98"
        ]
      ]
    },
    {
      "id": "a97269ae.118a98",
      "type": "http response",
      "z": "c46ab181.bede",
      "name": "応答",
      "x": 630,
      "y": 280,
      "wires": []
    },
    {
      "id": "777bdcac.a89354",
      "type": "change",
      "z": "c46ab181.bede",
      "name": "変数設定",
      "rules": [
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "GET",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Cloudant.VIEW_API_COUNT",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 100,
      "y": 380,
      "wires": [
        [
          "e438eff1.93f55"
        ]
      ]
    },
    {
      "id": "964a120e.673a7",
      "type": "http request",
      "z": "c46ab181.bede",
      "name": "Cloudant APIカウント取得要求",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 170,
      "y": 440,
      "wires": [
        [
          "aed2c224.834c6",
          "4aef01f2.23482"
        ]
      ]
    },
    {
      "id": "aed2c224.834c6",
      "type": "debug",
      "z": "c46ab181.bede",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "false",
      "x": 430,
      "y": 440,
      "wires": []
    },
    {
      "id": "59be3c7c.f82284",
      "type": "inject",
      "z": "c46ab181.bede",
      "name": "",
      "topic": "",
      "payload": "",
      "payloadType": "date",
      "repeat": "",
      "crontab": "",
      "once": false,
      "x": 324,
      "y": 360,
      "wires": [
        [
          "777bdcac.a89354"
        ]
      ]
    },
    {
      "id": "6b635ac.03fb6a4",
      "type": "function",
      "z": "c46ab181.bede",
      "name": "結果応答",
      "func": "var data = {};\ndata.search = [];\ndata.answer = [];\ndata.noanswer = [];\ndata.train = [];\nfor (var i=0; i < msg.payload.rows.length; i++) {\n    if (msg.payload.rows[i].key[0] === \"search\") {\n        data.search.push(msg.payload.rows[i]);\n        continue;\n        \n    }else if (msg.payload.rows[i].key[0] === \"answer\") {\n        data.answer.push(msg.payload.rows[i]);\n        continue;\n        \n    } else if(msg.payload.rows[i].key[0] === \"noanswer\"){\n        data.noanswer.push(msg.payload.rows[i]);\n        continue;\n        \n    } else if(msg.payload.rows[i].key[0] === \"train\"){\n        data.train.push(msg.payload.rows[i]);\n        \n    }\n}\n\nmsg.statusCode = '200';\nmsg.payload = {\n    result: \"success\",\n    message: data\n}\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 280,
      "y": 500,
      "wires": [
        [
          "5bffc24c.51c33c",
          "669d8089.85f68"
        ]
      ]
    },
    {
      "id": "5bffc24c.51c33c",
      "type": "http response",
      "z": "c46ab181.bede",
      "name": "応答",
      "x": 450,
      "y": 500,
      "wires": []
    },
    {
      "id": "4aef01f2.23482",
      "type": "switch",
      "z": "c46ab181.bede",
      "name": "エラー判定",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "btwn",
          "v": "200",
          "vt": "num",
          "v2": "202",
          "v2t": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 110,
      "y": 540,
      "wires": [
        [
          "6b635ac.03fb6a4"
        ],
        [
          "1dbf225e.49901e"
        ]
      ]
    },
    {
      "id": "1dbf225e.49901e",
      "type": "function",
      "z": "c46ab181.bede",
      "name": "エラー応答",
      "func": "msg.payload = {\n    result: \"failure\",\n    message: msg.payload\n};\nreturn msg;\n",
      "outputs": 1,
      "noerr": 0,
      "x": 310,
      "y": 620,
      "wires": [
        [
          "12661a3.51fe1e6",
          "3374eb32.1acc24"
        ]
      ]
    },
    {
      "id": "12661a3.51fe1e6",
      "type": "http response",
      "z": "c46ab181.bede",
      "name": "応答",
      "x": 490,
      "y": 620,
      "wires": []
    },
    {
      "id": "e438eff1.93f55",
      "type": "function",
      "z": "c46ab181.bede",
      "name": "type設定",
      "func": "msg.type = msg.payload.type;\n\nif (msg.type) {\n    if (msg.type === \"dayly\") {\n        msg.url += \"?reduce=true&group_level=4\";\n    } else if (msg.type === \"monthly\") {\n        msg.url += \"?reduce=true&group_level=3\";\n    } else {\n        //デフォルトは monthly\n        msg.url += \"?reduce=true&group_level=3\";\n    }\n} else {\n    //デフォルトは monthly\n    msg.url += \"?reduce=true&group_level=3\";\n}\n\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 260,
      "y": 400,
      "wires": [
        [
          "964a120e.673a7",
          "88779d24.afc42"
        ]
      ]
    },
    {
      "id": "88779d24.afc42",
      "type": "debug",
      "z": "c46ab181.bede",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "true",
      "x": 470,
      "y": 400,
      "wires": []
    },
    {
      "id": "9dffa9ea.874b18",
      "type": "change",
      "z": "c46ab181.bede",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(23) start.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 330,
      "y": 79,
      "wires": [
        [
          "c215a431.9d7d68"
        ]
      ]
    },
    {
      "id": "c215a431.9d7d68",
      "type": "subflow:c505c6cd.aad308",
      "z": "c46ab181.bede",
      "x": 487,
      "y": 79,
      "wires": []
    },
    {
      "id": "669d8089.85f68",
      "type": "change",
      "z": "c46ab181.bede",
      "name": "LOG_INFO",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "info",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(23) end.\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 470,
      "y": 542,
      "wires": [
        [
          "fd1799d6.5406e8"
        ]
      ]
    },
    {
      "id": "fd1799d6.5406e8",
      "type": "subflow:c505c6cd.aad308",
      "z": "c46ab181.bede",
      "x": 627,
      "y": 542,
      "wires": []
    },
    {
      "id": "17b0b8fd.56dd77",
      "type": "change",
      "z": "c46ab181.bede",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(23) Common parameters error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 341,
      "y": 243,
      "wires": [
        [
          "e08a6c78.7d6f9"
        ]
      ]
    },
    {
      "id": "e08a6c78.7d6f9",
      "type": "subflow:c505c6cd.aad308",
      "z": "c46ab181.bede",
      "x": 501,
      "y": 244,
      "wires": []
    },
    {
      "id": "3374eb32.1acc24",
      "type": "change",
      "z": "c46ab181.bede",
      "name": "LOG_ERROR",
      "rules": [
        {
          "t": "set",
          "p": "LogType",
          "pt": "msg",
          "to": "error",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "LogStr",
          "pt": "msg",
          "to": "\"API(23) creating error\"",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 519,
      "y": 664,
      "wires": [
        [
          "325ba341.f2debc"
        ]
      ]
    },
    {
      "id": "325ba341.f2debc",
      "type": "subflow:c505c6cd.aad308",
      "z": "c46ab181.bede",
      "x": 679,
      "y": 665,
      "wires": []
    },
    {
      "id": "2ac05945.553d36",
      "type": "comment",
      "z": "ecf7cb7a.f7b568",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "85db8a83.fe07e8",
      "type": "comment",
      "z": "b85ebbb8.71d748",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "4a3fd559.d7c4fc",
      "type": "comment",
      "z": "c08d8bce.292a98",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "be50353c.db2788",
      "type": "comment",
      "z": "4caa9583.52322c",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "4d76fc14.43d994",
      "type": "comment",
      "z": "ab8060fa.504b3",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "3ea93c06.8c1fd4",
      "type": "comment",
      "z": "f88d33bb.e0bc5",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "84d4664.9238998",
      "type": "comment",
      "z": "e4d10f14.d558b",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "3b9f34dc.31d36c",
      "type": "comment",
      "z": "f06e3ca3.ed0a6",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "fc91b6a4.435ff8",
      "type": "comment",
      "z": "8baa0034.d9587",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "127c3811.9f8828",
      "type": "comment",
      "z": "3c319ef6.6e76e2",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "cded26b1.166e38",
      "type": "comment",
      "z": "b6daf329.b5ff58",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "30031ebd.20ee32",
      "type": "comment",
      "z": "f290c459.175828",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "4754c8b9.33e278",
      "type": "comment",
      "z": "a2571d82.682d6",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "eb054d1f.975e5",
      "type": "comment",
      "z": "c46ab181.bede",
      "name": "Copyright 2018 Nippon Information and Communication. All Rights Reserved.",
      "info": "/**\n * Copyright 2018 Nippon Information and Communication. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n",
      "x": 270,
      "y": 20,
      "wires": []
    },
    {
      "id": "84d018d3.63b1a8",
      "type": "comment",
      "z": "b85ebbb8.71d748",
      "name": "name='faq_environment'",
      "info": "",
      "x": 1210,
      "y": 160,
      "wires": []
    },
    {
      "id": "2b14ec13.49e684",
      "type": "template",
      "z": "b85ebbb8.71d748",
      "name": "作成Environment JSON",
      "field": "payload",
      "fieldType": "msg",
      "format": "handlebars",
      "syntax": "mustache",
      "template": "{\n    \"name\": \"faq_environment\",\n    \"description\": \"My faq environment\"\n}",
      "output": "json",
      "x": 1210,
      "y": 200,
      "wires": [
        [
          "29193e57.1e0f22"
        ]
      ]
    },
    {
      "id": "531c523b.77871c",
      "type": "change",
      "z": "b85ebbb8.71d748",
      "name": "CREATE_ENV",
      "rules": [
        {
          "t": "set",
          "p": "headers.Authorization",
          "pt": "msg",
          "to": "'Basic ' & $base64encode(CredentialInfo.username & ':' & CredentialInfo.password)\t",
          "tot": "jsonata"
        },
        {
          "t": "set",
          "p": "method",
          "pt": "msg",
          "to": "POST",
          "tot": "str"
        },
        {
          "t": "set",
          "p": "url",
          "pt": "msg",
          "to": "Apis.Discovery.CREATE_ENV",
          "tot": "global"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1620,
      "y": 200,
      "wires": [
        [
          "2cdd1613.9c3c5a"
        ]
      ]
    },
    {
      "id": "2cdd1613.9c3c5a",
      "type": "http request",
      "z": "b85ebbb8.71d748",
      "name": "",
      "method": "use",
      "ret": "obj",
      "url": "",
      "tls": "",
      "x": 1810,
      "y": 200,
      "wires": [
        [
          "1c0ae877.f8e328",
          "1e83be72.86b132"
        ]
      ]
    },
    {
      "id": "1c0ae877.f8e328",
      "type": "switch",
      "z": "b85ebbb8.71d748",
      "name": "statusCode = 201",
      "property": "statusCode",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "201",
          "vt": "num"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 2010,
      "y": 200,
      "wires": [
        [
          "2a1a3988.6a8846"
        ],
        [
          "76bc36e9.b15f28"
        ]
      ]
    },
    {
      "id": "2a1a3988.6a8846",
      "type": "change",
      "z": "b85ebbb8.71d748",
      "name": "environment_id",
      "rules": [
        {
          "t": "set",
          "p": "environment_id",
          "pt": "msg",
          "to": "payload.environment_id",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2227,
      "y": 200,
      "wires": [
        [
          "bd3385e9.ce4f58"
        ]
      ]
    },
    {
      "id": "76bc36e9.b15f28",
      "type": "template",
      "z": "b85ebbb8.71d748",
      "name": "エラー",
      "field": "payload",
      "fieldType": "msg",
      "format": "handlebars",
      "syntax": "mustache",
      "template": "[error]ENVIRONMENTの作成に失敗しました。\n",
      "output": "str",
      "x": 2197,
      "y": 240,
      "wires": [
        [
          "b5ba174f.4bd108",
          "bd3385e9.ce4f58"
        ]
      ]
    },
    {
      "id": "b5ba174f.4bd108",
      "type": "debug",
      "z": "b85ebbb8.71d748",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "false",
      "x": 2357,
      "y": 240,
      "wires": []
    },
    {
      "id": "616cc4ba.62f16c",
      "type": "debug",
      "z": "b85ebbb8.71d748",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "payload",
      "x": 1403.9999999999998,
      "y": 125.99999999999997,
      "wires": []
    },
    {
      "id": "1e83be72.86b132",
      "type": "debug",
      "z": "b85ebbb8.71d748",
      "name": "",
      "active": false,
      "console": "false",
      "complete": "true",
      "x": 1970,
      "y": 160,
      "wires": []
    },
    {
      "id": "fbe61faa.0db75",
      "type": "change",
      "z": "b85ebbb8.71d748",
      "name": "environment_id",
      "rules": [
        {
          "t": "set",
          "p": "environment_id",
          "pt": "msg",
          "to": "payload.environments[environment_id!='system'].environment_id",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 700,
      "y": 200,
      "wires": [
        [
          "5b91bc52.a49a64"
        ]
      ]
    },
    {
      "id": "a97f9d2a.7e43a",
      "type": "comment",
      "z": "b85ebbb8.71d748",
      "name": "environment_id != 'system'",
      "info": "",
      "x": 690,
      "y": 160,
      "wires": []
    },
    {
      "id": "5b91bc52.a49a64",
      "type": "switch",
      "z": "b85ebbb8.71d748",
      "name": "environment_id is null ?",
      "property": "environment_id",
      "propertyType": "msg",
      "rules": [
        {
          "t": "null"
        },
        {
          "t": "else"
        }
      ],
      "checkall": "true",
      "outputs": 2,
      "x": 930,
      "y": 200,
      "wires": [
        [
          "2b14ec13.49e684"
        ],
        [
          "bd3385e9.ce4f58"
        ]
      ]
    },
    {
      "id": "c4566722.5c74a8",
      "type": "change",
      "z": "ecf7cb7a.f7b568",
      "name": "environment_id",
      "rules": [
        {
          "t": "set",
          "p": "environment_id",
          "pt": "msg",
          "to": "payload.environments[environment_id!='system'].environment_id",
          "tot": "jsonata"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1080,
      "y": 660,
      "wires": [
        [
          "627c694e.ca06a8"
        ]
      ]
    },
    {
      "id": "ff39942.0d22168",
      "type": "comment",
      "z": "ecf7cb7a.f7b568",
      "name": "environment_id != 'system'",
      "info": "",
      "x": 1110,
      "y": 620,
      "wires": []
    },
    {
      "id": "fd80d204.9037e",
      "type": "comment",
      "z": "60894a16.3cd484",
      "name": "msg.payload.user or msg.common.user が設定されていること",
      "info": "",
      "x": 505,
      "y": 143,
      "wires": []
    },
    {
      "id": "29193e57.1e0f22",
      "type": "change",
      "z": "b85ebbb8.71d748",
      "name": "",
      "rules": [
        {
          "t": "delete",
          "p": "headers",
          "pt": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 1430,
      "y": 200,
      "wires": [
        [
          "531c523b.77871c"
        ]
      ]
    },
    {
      "id": "30637d8c.ac1792",
      "type": "change",
      "z": "ecf7cb7a.f7b568",
      "name": "",
      "rules": [
        {
          "t": "delete",
          "p": "headers",
          "pt": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2210,
      "y": 660,
      "wires": [
        [
          "27d26924.79a026"
        ]
      ]
    },
    {
      "id": "c22addee.80f0e",
      "type": "change",
      "z": "e4d10f14.d558b",
      "name": "",
      "rules": [
        {
          "t": "delete",
          "p": "headers",
          "pt": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2230,
      "y": 860,
      "wires": [
        [
          "d7139aea.5e9588"
        ]
      ]
    },
    {
      "id": "f6e2c3c4.607dc",
      "type": "change",
      "z": "f06e3ca3.ed0a6",
      "name": "",
      "rules": [
        {
          "t": "delete",
          "p": "headers",
          "pt": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 2490,
      "y": 460,
      "wires": [
        [
          "e999e588.ac18a8"
        ]
      ]
    },
    {
      "id": "4293c6c.f0fa538",
      "type": "change",
      "z": "3c319ef6.6e76e2",
      "name": "",
      "rules": [
        {
          "t": "delete",
          "p": "headers",
          "pt": "msg"
        }
      ],
      "action": "",
      "property": "",
      "from": "",
      "to": "",
      "reg": false,
      "x": 970,
      "y": 600,
      "wires": [
        [
          "ff836f6f.a558b"
        ]
      ]
    }
  ]
